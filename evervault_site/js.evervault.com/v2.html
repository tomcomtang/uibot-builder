(function(v,b){typeof exports=="object"&&typeof module<"u"?module.exports=b():typeof define=="function"&&define.amd?define(b):(v=typeof globalThis<"u"?globalThis:v||self,v.Evervault=b())})(this,function(){"use strict";var Ys=Object.defineProperty;var Wn=v=>{throw TypeError(v)};var Ws=(v,b,N)=>b in v?Ys(v,b,{enumerable:!0,configurable:!0,writable:!0,value:N}):v[b]=N;var S=(v,b,N)=>Ws(v,typeof b!="symbol"?b+"":b,N),jt=(v,b,N)=>b.has(v)||Wn("Cannot "+N);var o=(v,b,N)=>(jt(v,b,"read from private field"),N?N.call(v):b.get(v)),g=(v,b,N)=>b.has(v)?Wn("Cannot add the same private member more than once"):b instanceof WeakSet?b.add(v):b.set(v,N),m=(v,b,N,Et)=>(jt(v,b,"write to private field"),Et?Et.call(v,N):b.set(v,N),N),y=(v,b,N)=>(jt(v,b,"access private method"),N);var Be,ue,Re,K,he,I,Zn,Xn,Qn,Gt,yt,ei,ot,Te,Ze,Oe,_e,bt,re,ne,Ae,Xe,Qe,De,ti,ri,C,V,O,W,Z,fe,j,X,de,et,ge,tt,rt,ke,Se,Me,F,J,He,ie,ni,ii,Kt,Pe,$e,$,je,U,pe,q,si,at,oi,nt,_,D,se,R,w,oe,xe,Q,ai,li,ci,ui,it,st;const v="https://keys.evervault.com",b="https://inputs.evervault.com",N="https://api.evervault.com",Bt={keysUrl:v,inputsOrigin:b,componentsUrl:"https://ui-components.evervault.com"},Jt=25,hi={cipherAlgorithm:"aes-256-gcm",keyLength:32,ivLength:12,authTagLength:128,publicHash:"sha256",versions:{NOC:"NOC",BFS:"QkTC"},header:{iss:"evervault",version:1},maxFileSizeInMB:Jt,maxFileSizeInBytes:Jt*1024*1024},fi=i=>({...hi,publicKey:i}),di={ecdhP256KeyUncompressed:"BF1/Mo85D7t/XvC3I+YYpJvP+OsSyxIbSrhtDhg1SClQ2xdoyGpXYrplO/f8AZ+7cGkUnMF3tzSfLC5Io8BuNyw=",ecdhP256Key:"Al1/Mo85D7t/XvC3I+YYpJvP+OsSyxIbSrhtDhg1SClQ",isDebugMode:!0};function qt(i,e,t,r){return{teamId:i,appId:e,encryption:fi(r),http:{keysUrl:lt(t==null?void 0:t.keysUrl,Bt.keysUrl),apiUrl:lt(t==null?void 0:t.apiUrl,N)},components:{url:lt(t==null?void 0:t.componentsUrl,Bt.componentsUrl)},input:{inputsOrigin:lt(t==null?void 0:t.inputsOrigin,Bt.inputsOrigin)},debugKey:di}}function lt(i,e){return typeof i>"u"||i===null||typeof i!="string"&&!(i instanceof String)||i.length===0?e:i instanceof String?i.toString():i}const At=i=>typeof i<"u"&&i!==null,ct=i=>i!=null&&typeof i=="object"&&i instanceof Array,gi=i=>typeof ArrayBuffer=="function"&&(i instanceof ArrayBuffer||Object.prototype.toString.call(i)==="[object ArrayBuffer]"),pi=i=>typeof i=="object",zt=i=>At(i)&&pi(i)&&!ct(i)&&!gi(i),me=i=>typeof i=="string",mi=i=>i!=null&&me(i)&&i.length===0,Yt=i=>typeof i=="number",Wt=i=>typeof i=="boolean",yi=i=>i instanceof File||i instanceof Blob,Zt=i=>At(i)&&(me(i)||Yt(i)||Wt(i)),Xt=i=>ct(i)?i.constructor.name:typeof i,Qt=i=>{if(me(i))return i;if(Yt(i)||Wt(i)||typeof i=="bigint"||typeof i=="function")return i.toString();throw new Error(`Cannot ensure string for ${typeof i}`)};class Ce extends Error{constructor(t,r){var e=(...Xs)=>(super(...Xs),S(this,"type"),this);t!=null&&r!=null?e(t,r):e(t),this.type=this.constructor.name}}class Ne extends Ce{}class vi extends Ce{}class wi extends Ce{}class bi extends Ce{}class Ei extends Ce{}class Bi extends Ce{}function er(i){let e,t=i.trim().match(/^(?:https?:\/\/)?(?:[^@\n]+@)?(?:www\.)?([^:/\n?=]+)/im);return t&&([,e]=t,t=e.match(/^[^.]+\.(.+\..+)$/),t&&([,e]=t)),e}function Ai(i,e=!1){if(i!=null){if(i.height)return i.height;if(e)return"80px";if(i.theme==="minimal"||i.theme==="material")return"145px"}return"180px"}const ki="/v2/index.html",Si="/v2/reveal.html";function xi(i,e,t){let r="";t&&Object.keys(t).filter(c=>c!=="customStyles").forEach(c=>{const u=t[c];u!==void 0&&(r+=`&${c}=${encodeURIComponent(u)}`)});const{inputsOrigin:n}=i.input,{teamId:s,appId:a}=i;let l=n+ki;return e&&(l=n+Si),`${l}?team=${s}&app=${a}${r}&mode=${e?"reveal":"inputs"}`}function Ge(i){const e=i.reduce((n,s)=>n+s.length,0),t=new Uint8Array(e);let r=0;for(const n of i)t.set(n,r),r+=n.length;return t}function ut(i){const e=new Uint8Array(i),t=e.byteLength,r=e.slice(0,1+t>>>1);return r[0]=2|e[t-1]&1,r}function Ci(i){return new TextEncoder().encode(i)}function z(i){const e=i.match(/../g);if(e===null)return new Uint8Array;const t=e.map(r=>parseInt(r,16));return new Uint8Array(t)}function Ni(i){return Array.from(i).map(e=>e.toString(16).padStart(2,"0")).join("")}function ht(i){const e=window.atob(i),{length:t}=e,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.charCodeAt(n);return r}function Ke(i){const e=Array.from(i).map(t=>String.fromCharCode(t)).join("");return window.btoa(e)}function Vi(i){const e=ut(ht(i)),t=Ke(new Uint8Array(e));return{ecdhP256KeyUncompressed:i,ecdhP256Key:t,isDebugMode:!1}}/*!
 * MIT License
 * 
 * Copyright (c) 2017-2024 Peculiar Ventures, LLC
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const Li="[object ArrayBuffer]";class A{static isArrayBuffer(e){return Object.prototype.toString.call(e)===Li}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){const r=A.toUint8Array(e),n=A.toUint8Array(t);if(r.length!==n.byteLength)return!1;for(let s=0;s<r.length;s++)if(r[s]!==n[s])return!1;return!0}static concat(...e){let t;Array.isArray(e[0])&&!(e[1]instanceof Function)||Array.isArray(e[0])&&e[1]instanceof Function?t=e[0]:e[e.length-1]instanceof Function?t=e.slice(0,e.length-1):t=e;let r=0;for(const a of t)r+=a.byteLength;const n=new Uint8Array(r);let s=0;for(const a of t){const l=this.toUint8Array(a);n.set(l,s),s+=l.length}return e[e.length-1]instanceof Function?this.toView(n,e[e.length-1]):n.buffer}}const kt="string",Ui=/^[0-9a-f\s]+$/i,Ii=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,Fi=/^[a-zA-Z0-9-_]+$/;class tr{static fromString(e){const t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length);for(let n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r.buffer}static toString(e){const t=A.toUint8Array(e);let r="";for(let s=0;s<t.length;s++)r+=String.fromCharCode(t[s]);return decodeURIComponent(escape(r))}}class Y{static toString(e,t=!1){const r=A.toArrayBuffer(e),n=new DataView(r);let s="";for(let a=0;a<r.byteLength;a+=2){const l=n.getUint16(a,t);s+=String.fromCharCode(l)}return s}static fromString(e,t=!1){const r=new ArrayBuffer(e.length*2),n=new DataView(r);for(let s=0;s<e.length;s++)n.setUint16(s*2,e.charCodeAt(s),t);return r}}class x{static isHex(e){return typeof e===kt&&Ui.test(e)}static isBase64(e){return typeof e===kt&&Ii.test(e)}static isBase64Url(e){return typeof e===kt&&Fi.test(e)}static ToString(e,t="utf8"){const r=A.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);case"utf16le":return Y.toString(r,!0);case"utf16":case"utf16be":return Y.toString(r);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return Y.fromString(e,!0);case"utf16":case"utf16be":return Y.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){const t=A.toUint8Array(e);if(typeof btoa<"u"){const r=this.ToString(t,"binary");return btoa(r)}else return Buffer.from(t).toString("base64")}static FromBase64(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!x.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(t)):new Uint8Array(Buffer.from(t,"base64")).buffer}static FromBase64Url(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!x.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=x.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return tr.fromString(e);case"utf16":case"utf16be":return Y.fromString(e);case"utf16le":case"usc2":return Y.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=x.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return tr.toString(e);case"utf16":case"utf16be":return Y.toString(e);case"utf16le":case"usc2":return Y.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){const t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.charCodeAt(n);return r.buffer}static ToBinary(e){const t=A.toUint8Array(e);let r="";for(let n=0;n<t.length;n++)r+=String.fromCharCode(t[n]);return r}static ToHex(e){const t=A.toUint8Array(e);let r="";const n=t.length;for(let s=0;s<n;s++){const a=t[s];a<16&&(r+="0"),r+=a.toString(16)}return r}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!x.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);const r=new Uint8Array(t.length/2);for(let n=0;n<t.length;n=n+2){const s=t.slice(n,n+2);r[n/2]=parseInt(s,16)}return r.buffer}static ToUtf16String(e,t=!1){return Y.toString(e,t)}static FromUtf16String(e,t=!1){return Y.fromString(e,t)}static Base64Padding(e){const t=4-e.length%4;if(t<4)for(let r=0;r<t;r++)e+="=";return e}static formatString(e){return(e==null?void 0:e.replace(/[\n\r\t ]/g,""))||""}}x.DEFAULT_UTF8_ENCODING="utf8";/*!
 Copyright (c) Peculiar Ventures, LLC
*/function Ve(i,e){let t=0;if(i.length===1)return i[0];for(let r=i.length-1;r>=0;r--)t+=i[i.length-1-r]*Math.pow(2,e*r);return t}function ye(i,e,t=-1){const r=t;let n=i,s=0,a=Math.pow(2,e);for(let l=1;l<8;l++){if(i<a){let c;if(r<0)c=new ArrayBuffer(l),s=l;else{if(r<l)return new ArrayBuffer(0);c=new ArrayBuffer(r),s=r}const u=new Uint8Array(c);for(let d=l-1;d>=0;d--){const h=Math.pow(2,d*e);u[s-d-1]=Math.floor(n/h),n-=u[s-d-1]*h}return c}a*=Math.pow(2,e)}return new ArrayBuffer(0)}function St(...i){let e=0,t=0;for(const s of i)e+=s.length;const r=new ArrayBuffer(e),n=new Uint8Array(r);for(const s of i)n.set(s,t),t+=s.length;return n}function rr(){const i=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const l=i[0]===255&&i[1]&128,c=i[0]===0&&(i[1]&128)===0;(l||c)&&this.warnings.push("Needlessly long format")}const e=new ArrayBuffer(this.valueHex.byteLength),t=new Uint8Array(e);for(let l=0;l<this.valueHex.byteLength;l++)t[l]=0;t[0]=i[0]&128;const r=Ve(t,8),n=new ArrayBuffer(this.valueHex.byteLength),s=new Uint8Array(n);for(let l=0;l<this.valueHex.byteLength;l++)s[l]=i[l];return s[0]&=127,Ve(s,8)-r}function Ri(i){const e=i<0?i*-1:i;let t=128;for(let r=1;r<8;r++){if(e<=t){if(i<0){const a=t-e,l=ye(a,8,r),c=new Uint8Array(l);return c[0]|=128,l}let n=ye(e,8,r),s=new Uint8Array(n);if(s[0]&128){const a=n.slice(0),l=new Uint8Array(a);n=new ArrayBuffer(n.byteLength+1),s=new Uint8Array(n);for(let c=0;c<a.byteLength;c++)s[c+1]=l[c];s[0]=0}return n}t*=Math.pow(2,8)}return new ArrayBuffer(0)}function Ti(i,e){if(i.byteLength!==e.byteLength)return!1;const t=new Uint8Array(i),r=new Uint8Array(e);for(let n=0;n<t.length;n++)if(t[n]!==r[n])return!1;return!0}function M(i,e){const t=i.toString(10);if(e<t.length)return"";const r=e-t.length,n=new Array(r);for(let a=0;a<r;a++)n[a]="0";return n.join("").concat(t)}/*!
 * Copyright (c) 2014, GMO GlobalSign
 * Copyright (c) 2015-2022, Peculiar Ventures
 * All rights reserved.
 * 
 * Author 2014-2019, Yury Strozhevsky
 * 
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 * 
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 * 
 * * Redistributions in binary form must reproduce the above copyright notice, this
 *   list of conditions and the following disclaimer in the documentation and/or
 *   other materials provided with the distribution.
 * 
 * * Neither the name of the copyright holder nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 * 
 */function ft(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function xt(i){let e=0,t=0;for(let n=0;n<i.length;n++){const s=i[n];e+=s.byteLength}const r=new Uint8Array(e);for(let n=0;n<i.length;n++){const s=i[n];r.set(new Uint8Array(s),t),t+=s.byteLength}return r.buffer}function ee(i,e,t,r){return e instanceof Uint8Array?e.byteLength?t<0?(i.error="Wrong parameter: inputOffset less than zero",!1):r<0?(i.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-t-r<0?(i.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(i.error="Wrong parameter: inputBuffer has zero length",!1):(i.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class Ct{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return xt(this.items)}}const Je=[new Uint8Array([1])],nr="0123456789",Le="",G=new ArrayBuffer(0),Nt=new Uint8Array(0),qe="EndOfContent",ir="OCTET STRING",sr="BIT STRING";function te(i){var e;return e=class extends i{get valueHex(){return this.valueHexView.slice().buffer}set valueHex(r){this.valueHexView=new Uint8Array(r)}constructor(...r){var n;super(...r);const s=r[0]||{};this.isHexOnly=(n=s.isHexOnly)!==null&&n!==void 0?n:!1,this.valueHexView=s.valueHex?A.toUint8Array(s.valueHex):Nt}fromBER(r,n,s){const a=r instanceof ArrayBuffer?new Uint8Array(r):r;if(!ee(this,a,n,s))return-1;const l=n+s;return this.valueHexView=a.subarray(n,l),this.valueHexView.length?(this.blockLength=s,l):(this.warnings.push("Zero buffer length"),n)}toBER(r=!1){return this.isHexOnly?r?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",G)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:x.ToHex(this.valueHexView)}}},e.NAME="hexBlock",e}class ve{static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}constructor({blockLength:e=0,error:t=Le,warnings:r=[],valueBeforeDecode:n=Nt}={}){this.blockLength=e,this.error=t,this.warnings=r,this.valueBeforeDecodeView=A.toUint8Array(n)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:x.ToHex(this.valueBeforeDecodeView)}}}ve.NAME="baseBlock";class H extends ve{fromBER(e,t,r){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}H.NAME="valueBlock";class or extends te(ve){constructor({idBlock:e={}}={}){var t,r,n,s;super(),e?(this.isHexOnly=(t=e.isHexOnly)!==null&&t!==void 0?t:!1,this.valueHexView=e.valueHex?A.toUint8Array(e.valueHex):Nt,this.tagClass=(r=e.tagClass)!==null&&r!==void 0?r:-1,this.tagNumber=(n=e.tagNumber)!==null&&n!==void 0?n:-1,this.isConstructed=(s=e.isConstructed)!==null&&s!==void 0?s:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",G}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){const n=new Uint8Array(1);if(!e){let s=this.tagNumber;s&=31,t|=s,n[0]=t}return n.buffer}if(!this.isHexOnly){const n=ye(this.tagNumber,7),s=new Uint8Array(n),a=n.byteLength,l=new Uint8Array(a+1);if(l[0]=t|31,!e){for(let c=0;c<a-1;c++)l[c+1]=s[c]|128;l[a]=s[a-1]}return l.buffer}const r=new Uint8Array(this.valueHexView.byteLength+1);if(r[0]=t|31,!e){const n=this.valueHexView;for(let s=0;s<n.length-1;s++)r[s+1]=n[s]|128;r[this.valueHexView.byteLength]=n[n.length-1]}return r.buffer}fromBER(e,t,r){const n=A.toUint8Array(e);if(!ee(this,n,t,r))return-1;const s=n.subarray(t,t+r);if(s.length===0)return this.error="Zero buffer length",-1;switch(s[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(s[0]&32)===32,this.isHexOnly=!1;const l=s[0]&31;if(l!==31)this.tagNumber=l,this.blockLength=1;else{let c=1,u=this.valueHexView=new Uint8Array(255),d=255;for(;s[c]&128;){if(u[c-1]=s[c]&127,c++,c>=s.length)return this.error="End of input reached before message was fully decoded",-1;if(c===d){d+=255;const p=new Uint8Array(d);for(let B=0;B<u.length;B++)p[B]=u[B];u=this.valueHexView=new Uint8Array(d)}}this.blockLength=c+1,u[c-1]=s[c]&127;const h=new Uint8Array(c);for(let p=0;p<c;p++)h[p]=u[p];u=this.valueHexView=new Uint8Array(c),u.set(h),this.blockLength<=9?this.tagNumber=Ve(u,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}or.NAME="identificationBlock";class ar extends ve{constructor({lenBlock:e={}}={}){var t,r,n;super(),this.isIndefiniteForm=(t=e.isIndefiniteForm)!==null&&t!==void 0?t:!1,this.longFormUsed=(r=e.longFormUsed)!==null&&r!==void 0?r:!1,this.length=(n=e.length)!==null&&n!==void 0?n:0}fromBER(e,t,r){const n=A.toUint8Array(e);if(!ee(this,n,t,r))return-1;const s=n.subarray(t,t+r);if(s.length===0)return this.error="Zero buffer length",-1;if(s[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=s[0]===128,this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(s[0]&128),this.longFormUsed===!1)return this.length=s[0],this.blockLength=1,t+this.blockLength;const a=s[0]&127;if(a>8)return this.error="Too big integer",-1;if(a+1>s.length)return this.error="End of input reached before message was fully decoded",-1;const l=t+1,c=n.subarray(l,l+a);return c[a-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=Ve(c,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=a+1,t+this.blockLength}toBER(e=!1){let t,r;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),e===!1&&(r=new Uint8Array(t),r[0]=128),t;if(this.longFormUsed){const n=ye(this.length,8);if(n.byteLength>127)return this.error="Too big length",G;if(t=new ArrayBuffer(n.byteLength+1),e)return t;const s=new Uint8Array(n);r=new Uint8Array(t),r[0]=n.byteLength|128;for(let a=0;a<n.byteLength;a++)r[a+1]=s[a];return t}return t=new ArrayBuffer(1),e===!1&&(r=new Uint8Array(t),r[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}ar.NAME="lengthBlock";const f={};class T extends ve{constructor({name:e=Le,optional:t=!1,primitiveSchema:r,...n}={},s){super(n),this.name=e,this.optional=t,r&&(this.primitiveSchema=r),this.idBlock=new or(n),this.lenBlock=new ar(n),this.valueBlock=s?new s(n):new H(n)}fromBER(e,t,r){const n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return n===-1?(this.error=this.valueBlock.error,n):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),n)}toBER(e,t){const r=t||new Ct;t||lr(this);const n=this.idBlock.toBER(e);if(r.write(n),this.lenBlock.isIndefiniteForm)r.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,r),r.write(new ArrayBuffer(2));else{const s=this.valueBlock.toBER(e);this.lenBlock.length=s.byteLength;const a=this.lenBlock.toBER(e);r.write(a),r.write(s)}return t?G:r.final()}toJSON(){const e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return e==="ascii"?this.onAsciiEncoding():x.ToHex(this.toBER())}onAsciiEncoding(){const e=this.constructor.NAME,t=x.ToHex(this.valueBlock.valueBeforeDecodeView);return`${e} : ${t}`}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;const t=this.toBER(),r=e.toBER();return Ti(t,r)}}T.NAME="BaseBlock";function lr(i){var e;if(i instanceof f.Constructed)for(const t of i.valueBlock.value)lr(t)&&(i.lenBlock.isIndefiniteForm=!0);return!!(!((e=i.lenBlock)===null||e===void 0)&&e.isIndefiniteForm)}class cr extends T{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor({value:e=Le,...t}={},r){super(t,r),e&&this.fromString(e)}fromBER(e,t,r){const n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return n===-1?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),n)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}cr.NAME="BaseStringBlock";class ur extends te(H){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}}ur.NAME="PrimitiveValueBlock";var hr;class fr extends T{constructor(e={}){super(e,ur),this.idBlock.isConstructed=!1}}hr=fr,f.Primitive=hr,fr.NAME="PRIMITIVE";function Oi(i,e){if(i instanceof e)return i;const t=new e;return t.idBlock=i.idBlock,t.lenBlock=i.lenBlock,t.warnings=i.warnings,t.valueBeforeDecodeView=i.valueBeforeDecodeView,t}function Vt(i,e=0,t=i.length){const r=e;let n=new T({},H);const s=new ve;if(!ee(s,i,e,t))return n.error=s.error,{offset:-1,result:n};if(!i.subarray(e,e+t).length)return n.error="Zero buffer length",{offset:-1,result:n};let l=n.idBlock.fromBER(i,e,t);if(n.idBlock.warnings.length&&n.warnings.concat(n.idBlock.warnings),l===-1)return n.error=n.idBlock.error,{offset:-1,result:n};if(e=l,t-=n.idBlock.blockLength,l=n.lenBlock.fromBER(i,e,t),n.lenBlock.warnings.length&&n.warnings.concat(n.lenBlock.warnings),l===-1)return n.error=n.lenBlock.error,{offset:-1,result:n};if(e=l,t-=n.lenBlock.blockLength,!n.idBlock.isConstructed&&n.lenBlock.isIndefiniteForm)return n.error="Indefinite length form used for primitive encoding form",{offset:-1,result:n};let c=T;switch(n.idBlock.tagClass){case 1:if(n.idBlock.tagNumber>=37&&n.idBlock.isHexOnly===!1)return n.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:n};switch(n.idBlock.tagNumber){case 0:if(n.idBlock.isConstructed&&n.lenBlock.length>0)return n.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:n};c=f.EndOfContent;break;case 1:c=f.Boolean;break;case 2:c=f.Integer;break;case 3:c=f.BitString;break;case 4:c=f.OctetString;break;case 5:c=f.Null;break;case 6:c=f.ObjectIdentifier;break;case 10:c=f.Enumerated;break;case 12:c=f.Utf8String;break;case 13:c=f.RelativeObjectIdentifier;break;case 14:c=f.TIME;break;case 15:return n.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:n};case 16:c=f.Sequence;break;case 17:c=f.Set;break;case 18:c=f.NumericString;break;case 19:c=f.PrintableString;break;case 20:c=f.TeletexString;break;case 21:c=f.VideotexString;break;case 22:c=f.IA5String;break;case 23:c=f.UTCTime;break;case 24:c=f.GeneralizedTime;break;case 25:c=f.GraphicString;break;case 26:c=f.VisibleString;break;case 27:c=f.GeneralString;break;case 28:c=f.UniversalString;break;case 29:c=f.CharacterString;break;case 30:c=f.BmpString;break;case 31:c=f.DATE;break;case 32:c=f.TimeOfDay;break;case 33:c=f.DateTime;break;case 34:c=f.Duration;break;default:{const u=n.idBlock.isConstructed?new f.Constructed:new f.Primitive;u.idBlock=n.idBlock,u.lenBlock=n.lenBlock,u.warnings=n.warnings,n=u}}break;case 2:case 3:case 4:default:c=n.idBlock.isConstructed?f.Constructed:f.Primitive}return n=Oi(n,c),l=n.fromBER(i,e,n.lenBlock.isIndefiniteForm?t:n.lenBlock.length),n.valueBeforeDecodeView=i.subarray(r,r+n.blockLength),{offset:l,result:n}}function _i(i,e){return i?1:e}class ae extends H{constructor({value:e=[],isIndefiniteForm:t=!1,...r}={}){super(r),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,r){const n=A.toUint8Array(e);if(!ee(this,n,t,r))return-1;if(this.valueBeforeDecodeView=n.subarray(t,t+r),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),t;let s=t;for(;_i(this.isIndefiniteForm,r)>0;){const a=Vt(n,s,r);if(a.offset===-1)return this.error=a.result.error,this.warnings.concat(a.result.warnings),-1;if(s=a.offset,this.blockLength+=a.result.blockLength,r-=a.result.blockLength,this.value.push(a.result),this.isIndefiniteForm&&a.result.constructor.NAME===qe)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===qe?this.value.pop():this.warnings.push("No EndOfContent block encoded")),s}toBER(e,t){const r=t||new Ct;for(let n=0;n<this.value.length;n++)this.value[n].toBER(e,r);return t?G:r.final()}toJSON(){const e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(const t of this.value)e.value.push(t.toJSON());return e}}ae.NAME="ConstructedValueBlock";var dr;class Ue extends T{constructor(e={}){super(e,ae),this.idBlock.isConstructed=!0}fromBER(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return n===-1?(this.error=this.valueBlock.error,n):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),n)}onAsciiEncoding(){const e=[];for(const r of this.valueBlock.value)e.push(r.toString("ascii").split(`
`).map(n=>`  ${n}`).join(`
`));const t=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :
${e.join(`
`)}`:`${t} :`}}dr=Ue,f.Constructed=dr,Ue.NAME="CONSTRUCTED";class gr extends H{fromBER(e,t,r){return t}toBER(e){return G}}gr.override="EndOfContentValueBlock";var pr;class mr extends T{constructor(e={}){super(e,gr),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}pr=mr,f.EndOfContent=pr,mr.NAME=qe;var yr;class vr extends T{constructor(e={}){super(e,H),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,r){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,t+r>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+r}toBER(e,t){const r=new ArrayBuffer(2);if(!e){const n=new Uint8Array(r);n[0]=5,n[1]=0}return t&&t.write(r),r}onAsciiEncoding(){return`${this.constructor.NAME}`}}yr=vr,f.Null=yr,vr.NAME="NULL";class wr extends te(H){get value(){for(const e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=A.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}fromBER(e,t,r){const n=A.toUint8Array(e);return ee(this,n,t,r)?(this.valueHexView=n.subarray(t,t+r),r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,rr.call(this),this.blockLength=r,t+r):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}wr.NAME="BooleanValueBlock";var br;let Er=class extends T{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor(e={}){super(e,wr),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}};br=Er,f.Boolean=br,Er.NAME="BOOLEAN";class Br extends te(ae){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,r){let n=0;if(this.isConstructed){if(this.isHexOnly=!1,n=ae.prototype.fromBER.call(this,e,t,r),n===-1)return n;for(let s=0;s<this.value.length;s++){const a=this.value[s].constructor.NAME;if(a===qe){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(a!==ir)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,n=super.fromBER(e,t,r),this.blockLength=r;return n}toBER(e,t){return this.isConstructed?ae.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}Br.NAME="OctetStringValueBlock";var Lt;class ze extends T{constructor({idBlock:e={},lenBlock:t={},...r}={}){var n,s;(n=r.isConstructed)!==null&&n!==void 0||(r.isConstructed=!!(!((s=r.value)===null||s===void 0)&&s.length)),super({idBlock:{isConstructed:r.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!r.isIndefiniteForm},...r},Br),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,r){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,r===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){const s=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+r);try{if(s.byteLength){const a=Vt(s,0,s.byteLength);a.offset!==-1&&a.offset===r&&(this.valueBlock.value=[a.result])}}catch{}}return super.fromBER(e,t,r)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return Ue.prototype.onAsciiEncoding.call(this);const e=this.constructor.NAME,t=x.ToHex(this.valueBlock.valueHexView);return`${e} : ${t}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;const e=[];for(const t of this.valueBlock.value)t instanceof Lt&&e.push(t.valueBlock.valueHexView);return A.concat(e)}}Lt=ze,f.OctetString=Lt,ze.NAME=ir;class Ar extends te(ae){constructor({unusedBits:e=0,isConstructed:t=!1,...r}={}){super(r),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,r){if(!r)return t;let n=-1;if(this.isConstructed){if(n=ae.prototype.fromBER.call(this,e,t,r),n===-1)return n;for(const l of this.value){const c=l.constructor.NAME;if(c===qe){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(c!==sr)return this.error="BIT STRING may consists of BIT STRINGs only",-1;const u=l.valueBlock;if(this.unusedBits>0&&u.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=u.unusedBits}return n}const s=A.toUint8Array(e);if(!ee(this,s,t,r))return-1;const a=s.subarray(t,t+r);if(this.unusedBits=a[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const l=a.subarray(1);try{if(l.byteLength){const c=Vt(l,0,l.byteLength);c.offset!==-1&&c.offset===r-1&&(this.value=[c.result])}}catch{}}return this.valueHexView=a.subarray(1),this.blockLength=a.length,t+r}toBER(e,t){if(this.isConstructed)return ae.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return G;const r=new Uint8Array(this.valueHexView.length+1);return r[0]=this.unusedBits,r.set(this.valueHexView,1),r.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}Ar.NAME="BitStringValueBlock";var kr;class dt extends T{constructor({idBlock:e={},lenBlock:t={},...r}={}){var n,s;(n=r.isConstructed)!==null&&n!==void 0||(r.isConstructed=!!(!((s=r.value)===null||s===void 0)&&s.length)),super({idBlock:{isConstructed:r.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!r.isIndefiniteForm},...r},Ar),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,r){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,r)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return Ue.prototype.onAsciiEncoding.call(this);{const e=[],t=this.valueBlock.valueHexView;for(const a of t)e.push(a.toString(2).padStart(8,"0"));const r=e.join(""),n=this.constructor.NAME,s=r.substring(0,r.length-this.valueBlock.unusedBits);return`${n} : ${s}`}}}kr=dt,f.BitString=kr,dt.NAME=sr;var Sr;function Di(i,e){const t=new Uint8Array([0]),r=new Uint8Array(i),n=new Uint8Array(e);let s=r.slice(0);const a=s.length-1,l=n.slice(0),c=l.length-1;let u=0;const d=c<a?a:c;let h=0;for(let p=d;p>=0;p--,h++){switch(!0){case h<l.length:u=s[a-h]+l[c-h]+t[0];break;default:u=s[a-h]+t[0]}switch(t[0]=u/10,!0){case h>=s.length:s=St(new Uint8Array([u%10]),s);break;default:s[a-h]=u%10}}return t[0]>0&&(s=St(t,s)),s}function xr(i){if(i>=Je.length)for(let e=Je.length;e<=i;e++){const t=new Uint8Array([0]);let r=Je[e-1].slice(0);for(let n=r.length-1;n>=0;n--){const s=new Uint8Array([(r[n]<<1)+t[0]]);t[0]=s[0]/10,r[n]=s[0]%10}t[0]>0&&(r=St(t,r)),Je.push(r)}return Je[i]}function Mi(i,e){let t=0;const r=new Uint8Array(i),n=new Uint8Array(e),s=r.slice(0),a=s.length-1,l=n.slice(0),c=l.length-1;let u,d=0;for(let h=c;h>=0;h--,d++)switch(u=s[a-d]-l[c-d]-t,!0){case u<0:t=1,s[a-d]=u+10;break;default:t=0,s[a-d]=u}if(t>0)for(let h=a-c+1;h>=0;h--,d++)if(u=s[a-d]-t,u<0)t=1,s[a-d]=u+10;else{t=0,s[a-d]=u;break}return s.slice()}class Ut extends te(H){setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=rr.call(this)))}constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),e!==void 0&&(this.valueDec=e)}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(Ri(e))}get valueDec(){return this._valueDec}fromDER(e,t,r,n=0){const s=this.fromBER(e,t,r);if(s===-1)return s;const a=this.valueHexView;return a[0]===0&&a[1]&128?this.valueHexView=a.subarray(1):n!==0&&a.length<n&&(n-a.length>1&&(n=a.length+1),this.valueHexView=a.subarray(n-a.length)),s}toDER(e=!1){const t=this.valueHexView;switch(!0){case(t[0]&128)!==0:{const r=new Uint8Array(this.valueHexView.length+1);r[0]=0,r.set(t,1),this.valueHexView=r}break;case(t[0]===0&&(t[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(e)}fromBER(e,t,r){const n=super.fromBER(e,t,r);return n===-1||this.setValueHex(),n}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){const e=this.valueHexView.length*8-1;let t=new Uint8Array(this.valueHexView.length*8/3),r=0,n;const s=this.valueHexView;let a="",l=!1;for(let c=s.byteLength-1;c>=0;c--){n=s[c];for(let u=0;u<8;u++){if((n&1)===1)switch(r){case e:t=Mi(xr(r),t),a="-";break;default:t=Di(t,xr(r))}r++,n>>=1}}for(let c=0;c<t.length;c++)t[c]&&(l=!0),l&&(a+=nr.charAt(t[c]));return l===!1&&(a+=nr.charAt(0)),a}}Sr=Ut,Ut.NAME="IntegerValueBlock",Object.defineProperty(Sr.prototype,"valueHex",{set:function(i){this.valueHexView=new Uint8Array(i),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var Ye;class we extends T{constructor(e={}){super(e,Ut),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return ft(),BigInt(this.valueBlock.toString())}static fromBigInt(e){ft();const t=BigInt(e),r=new Ct,n=t.toString(16).replace(/^-/,""),s=new Uint8Array(x.FromHex(n));if(t<0){const l=new Uint8Array(s.length+(s[0]&128?1:0));l[0]|=128;const u=BigInt(`0x${x.ToHex(l)}`)+t,d=A.toUint8Array(x.FromHex(u.toString(16)));d[0]|=128,r.write(d)}else s[0]&128&&r.write(new Uint8Array([0])),r.write(s);return new Ye({valueHex:r.final()})}convertToDER(){const e=new Ye({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new Ye({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}Ye=we,f.Integer=Ye,we.NAME="INTEGER";var Cr;class Nr extends we{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}Cr=Nr,f.Enumerated=Cr,Nr.NAME="ENUMERATED";class It extends te(H){constructor({valueDec:e=-1,isFirstSid:t=!1,...r}={}){super(r),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,r){if(!r)return t;const n=A.toUint8Array(e);if(!ee(this,n,t,r))return-1;const s=n.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(let l=0;l<r&&(this.valueHexView[l]=s[l]&127,this.blockLength++,!!(s[l]&128));l++);const a=new Uint8Array(this.blockLength);for(let l=0;l<this.blockLength;l++)a[l]=this.valueHexView[l];return this.valueHexView=a,s[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Ve(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){ft();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;const r=new Uint8Array(t.length/7);for(let n=0;n<r.length;n++)r[n]=parseInt(t.slice(n*7,n*7+7),2)+(n+1<r.length?128:0);this.fromBER(r.buffer,0,r.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const n=this.valueHexView,s=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength-1;a++)s[a]=n[a]|128;return s[this.blockLength-1]=n[this.blockLength-1],s.buffer}const t=ye(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",G;const r=new Uint8Array(t.byteLength);if(!e){const n=new Uint8Array(t),s=t.byteLength-1;for(let a=0;a<s;a++)r[a]=n[a]|128;r[s]=n[s]}return r}toString(){let e="";if(this.isHexOnly)e=x.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}It.NAME="sidBlock";class Vr extends H{constructor({value:e=Le,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,r){let n=t;for(;r>0;){const s=new It;if(n=s.fromBER(e,n,r),n===-1)return this.blockLength=0,this.error=s.error,n;this.value.length===0&&(s.isFirstSid=!0),this.blockLength+=s.blockLength,r-=s.blockLength,this.value.push(s)}return n}toBER(e){const t=[];for(let r=0;r<this.value.length;r++){const n=this.value[r].toBER(e);if(n.byteLength===0)return this.error=this.value[r].error,G;t.push(n)}return xt(t)}fromString(e){this.value=[];let t=0,r=0,n="",s=!1;do if(r=e.indexOf(".",t),r===-1?n=e.substring(t):n=e.substring(t,r),t=r+1,s){const a=this.value[0];let l=0;switch(a.valueDec){case 0:break;case 1:l=40;break;case 2:l=80;break;default:this.value=[];return}const c=parseInt(n,10);if(isNaN(c))return;a.valueDec=c+l,s=!1}else{const a=new It;if(n>Number.MAX_SAFE_INTEGER){ft();const l=BigInt(n);a.valueBigInt=l}else if(a.valueDec=parseInt(n,10),isNaN(a.valueDec))return;this.value.length||(a.isFirstSid=!0,s=!0),this.value.push(a)}while(r!==-1)}toString(){let e="",t=!1;for(let r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;let n=this.value[r].toString();r!==0&&(e=`${e}.`),t?(n=`{${n}}`,this.value[r].isFirstSid?e=`2.{${n} - 80}`:e+=n):e+=n}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}Vr.NAME="ObjectIdentifierValueBlock";var Lr;class gt extends T{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,Vr),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}Lr=gt,f.ObjectIdentifier=Lr,gt.NAME="OBJECT IDENTIFIER";class Ft extends te(ve){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,r){if(r===0)return t;const n=A.toUint8Array(e);if(!ee(this,n,t,r))return-1;const s=n.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(let l=0;l<r&&(this.valueHexView[l]=s[l]&127,this.blockLength++,!!(s[l]&128));l++);const a=new Uint8Array(this.blockLength);for(let l=0;l<this.blockLength;l++)a[l]=this.valueHexView[l];return this.valueHexView=a,s[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Ve(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const n=this.valueHexView,s=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength-1;a++)s[a]=n[a]|128;return s[this.blockLength-1]=n[this.blockLength-1],s.buffer}const t=ye(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",G;const r=new Uint8Array(t.byteLength);if(!e){const n=new Uint8Array(t),s=t.byteLength-1;for(let a=0;a<s;a++)r[a]=n[a]|128;r[s]=n[s]}return r.buffer}toString(){let e="";return this.isHexOnly?e=x.ToHex(this.valueHexView):e=this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}Ft.NAME="relativeSidBlock";class Ur extends H{constructor({value:e=Le,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,r){let n=t;for(;r>0;){const s=new Ft;if(n=s.fromBER(e,n,r),n===-1)return this.blockLength=0,this.error=s.error,n;this.blockLength+=s.blockLength,r-=s.blockLength,this.value.push(s)}return n}toBER(e,t){const r=[];for(let n=0;n<this.value.length;n++){const s=this.value[n].toBER(e);if(s.byteLength===0)return this.error=this.value[n].error,G;r.push(s)}return xt(r)}fromString(e){this.value=[];let t=0,r=0,n="";do{r=e.indexOf(".",t),r===-1?n=e.substring(t):n=e.substring(t,r),t=r+1;const s=new Ft;if(s.valueDec=parseInt(n,10),isNaN(s.valueDec))return!0;this.value.push(s)}while(r!==-1);return!0}toString(){let e="",t=!1;for(let r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;let n=this.value[r].toString();r!==0&&(e=`${e}.`),t&&(n=`{${n}}`),e+=n}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}Ur.NAME="RelativeObjectIdentifierValueBlock";var Ir;class Fr extends T{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,Ur),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}Ir=Fr,f.RelativeObjectIdentifier=Ir,Fr.NAME="RelativeObjectIdentifier";var Rr;class be extends Ue{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}Rr=be,f.Sequence=Rr,be.NAME="SEQUENCE";var Tr;class Or extends Ue{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}}Tr=Or,f.Set=Tr,Or.NAME="SET";class _r extends te(H){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=Le}toJSON(){return{...super.toJSON(),value:this.value}}}_r.NAME="StringValueBlock";class Dr extends _r{}Dr.NAME="SimpleStringValueBlock";class P extends cr{constructor({...e}={}){super(e,Dr)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,A.toUint8Array(e))}fromString(e){const t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.charCodeAt(n);this.valueBlock.value=e}}P.NAME="SIMPLE STRING";class Mr extends P{fromBuffer(e){this.valueBlock.valueHexView=A.toUint8Array(e);try{this.valueBlock.value=x.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=x.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(x.FromUtf8String(e)),this.valueBlock.value=e}}Mr.NAME="Utf8StringValueBlock";var Hr;class Ee extends Mr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}Hr=Ee,f.Utf8String=Hr,Ee.NAME="UTF8String";class Pr extends P{fromBuffer(e){this.valueBlock.value=x.ToUtf16String(e),this.valueBlock.valueHexView=A.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(x.FromUtf16String(e))}}Pr.NAME="BmpStringValueBlock";var $r;class jr extends Pr{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}$r=jr,f.BmpString=$r,jr.NAME="BMPString";class Gr extends P{fromBuffer(e){const t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),r=new Uint8Array(t);for(let n=0;n<r.length;n+=4)r[n]=r[n+3],r[n+1]=r[n+2],r[n+2]=0,r[n+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){const t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(t*4);for(let n=0;n<t;n++){const s=ye(e.charCodeAt(n),8),a=new Uint8Array(s);if(a.length>4)continue;const l=4-a.length;for(let c=a.length-1;c>=0;c--)r[n*4+c+l]=a[c]}this.valueBlock.value=e}}Gr.NAME="UniversalStringValueBlock";var Kr;class Jr extends Gr{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}Kr=Jr,f.UniversalString=Kr,Jr.NAME="UniversalString";var qr;class zr extends P{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}qr=zr,f.NumericString=qr,zr.NAME="NumericString";var Yr;class Wr extends P{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}Yr=Wr,f.PrintableString=Yr,Wr.NAME="PrintableString";var Zr;class Xr extends P{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}Zr=Xr,f.TeletexString=Zr,Xr.NAME="TeletexString";var Qr;class en extends P{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}Qr=en,f.VideotexString=Qr,en.NAME="VideotexString";var tn;class rn extends P{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}tn=rn,f.IA5String=tn,rn.NAME="IA5String";var nn;class sn extends P{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}nn=sn,f.GraphicString=nn,sn.NAME="GraphicString";var on;class Rt extends P{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}on=Rt,f.VisibleString=on,Rt.NAME="VisibleString";var an;class ln extends P{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}an=ln,f.GeneralString=an,ln.NAME="GeneralString";var cn;class un extends P{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}cn=un,f.CharacterString=cn,un.NAME="CharacterString";var hn;class Tt extends Rt{constructor({value:e,valueDate:t,...r}={}){if(super(r),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let n=0;n<e.length;n++)this.valueBlock.valueHexView[n]=e.charCodeAt(n)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,A.toUint8Array(e)))}toBuffer(){const e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){const r=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(r===null){this.error="Wrong input string for conversion";return}const n=parseInt(r[1],10);n>=50?this.year=1900+n:this.year=2e3+n,this.month=parseInt(r[2],10),this.day=parseInt(r[3],10),this.hour=parseInt(r[4],10),this.minute=parseInt(r[5],10),this.second=parseInt(r[6],10)}toString(e="iso"){if(e==="iso"){const t=new Array(7);return t[0]=M(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=M(this.month,2),t[2]=M(this.day,2),t[3]=M(this.hour,2),t[4]=M(this.minute,2),t[5]=M(this.second,2),t[6]="Z",t.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}hn=Tt,f.UTCTime=hn,Tt.NAME="UTCTime";var fn;class dn extends Tt{constructor(e={}){var t;super(e),(t=this.millisecond)!==null&&t!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){const e=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond);return new Date(e)}fromString(e){let t=!1,r="",n="",s=0,a,l=0,c=0;if(e[e.length-1]==="Z")r=e.substring(0,e.length-1),t=!0;else{const h=new Number(e[e.length-1]);if(isNaN(h.valueOf()))throw new Error("Wrong input string for conversion");r=e}if(t){if(r.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(r.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let h=1,p=r.indexOf("+"),B="";if(p===-1&&(p=r.indexOf("-"),h=-1),p!==-1){if(B=r.substring(p+1),r=r.substring(0,p),B.length!==2&&B.length!==4)throw new Error("Wrong input string for conversion");let k=parseInt(B.substring(0,2),10);if(isNaN(k.valueOf()))throw new Error("Wrong input string for conversion");if(l=h*k,B.length===4){if(k=parseInt(B.substring(2,4),10),isNaN(k.valueOf()))throw new Error("Wrong input string for conversion");c=h*k}}}let u=r.indexOf(".");if(u===-1&&(u=r.indexOf(",")),u!==-1){const h=new Number(`0${r.substring(u)}`);if(isNaN(h.valueOf()))throw new Error("Wrong input string for conversion");s=h.valueOf(),n=r.substring(0,u)}else n=r;switch(!0){case n.length===8:if(a=/(\d{4})(\d{2})(\d{2})/ig,u!==-1)throw new Error("Wrong input string for conversion");break;case n.length===10:if(a=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,u!==-1){let h=60*s;this.minute=Math.floor(h),h=60*(h-this.minute),this.second=Math.floor(h),h=1e3*(h-this.second),this.millisecond=Math.floor(h)}break;case n.length===12:if(a=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,u!==-1){let h=60*s;this.second=Math.floor(h),h=1e3*(h-this.second),this.millisecond=Math.floor(h)}break;case n.length===14:if(a=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,u!==-1){const h=1e3*s;this.millisecond=Math.floor(h)}break;default:throw new Error("Wrong input string for conversion")}const d=a.exec(n);if(d===null)throw new Error("Wrong input string for conversion");for(let h=1;h<d.length;h++)switch(h){case 1:this.year=parseInt(d[h],10);break;case 2:this.month=parseInt(d[h],10);break;case 3:this.day=parseInt(d[h],10);break;case 4:this.hour=parseInt(d[h],10)+l;break;case 5:this.minute=parseInt(d[h],10)+c;break;case 6:this.second=parseInt(d[h],10);break;default:throw new Error("Wrong input string for conversion")}if(t===!1){const h=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=h.getUTCFullYear(),this.month=h.getUTCMonth(),this.day=h.getUTCDay(),this.hour=h.getUTCHours(),this.minute=h.getUTCMinutes(),this.second=h.getUTCSeconds(),this.millisecond=h.getUTCMilliseconds()}}toString(e="iso"){if(e==="iso"){const t=[];return t.push(M(this.year,4)),t.push(M(this.month,2)),t.push(M(this.day,2)),t.push(M(this.hour,2)),t.push(M(this.minute,2)),t.push(M(this.second,2)),this.millisecond!==0&&(t.push("."),t.push(M(this.millisecond,3))),t.push("Z"),t.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}fn=dn,f.GeneralizedTime=fn,dn.NAME="GeneralizedTime";var gn;class pn extends Ee{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}gn=pn,f.DATE=gn,pn.NAME="DATE";var mn;class yn extends Ee{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}mn=yn,f.TimeOfDay=mn,yn.NAME="TimeOfDay";var vn;class wn extends Ee{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}vn=wn,f.DateTime=vn,wn.NAME="DateTime";var bn;class En extends Ee{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}bn=En,f.Duration=bn,En.NAME="Duration";var Bn;class An extends Ee{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}Bn=An,f.TIME=Bn,An.NAME="TIME";const Hi="1.2.840.10045.2.1",Pi="1.2.840.10045.1.1",$i="01",ji=i=>new be({name:"fieldID",value:[new gt({name:"fieldType",value:Pi}),new we({name:"parameters",valueHex:new Uint8Array([0,...z(i.p)]).buffer})]}),Gi=i=>new be({name:"curve",value:[new ze({name:"a",valueHex:new Uint8Array(z(i.a)).buffer}),new ze({name:"b",valueHex:new Uint8Array(z(i.b)).buffer}),new dt({optional:!0,name:"seed",valueHex:i.seed?new Uint8Array(z(i.seed)).buffer:i.seed})]}),Ki=i=>new be({name:"ecParameters",value:[new we({name:"version",valueHex:new Uint8Array(z($i)).buffer}),ji(i),Gi(i),new ze({name:"base",valueHex:new Uint8Array(z(i.generator)).buffer}),new we({name:"order",valueHex:new Uint8Array([0,...z(i.n)]).buffer}),new we({optional:!0,name:"cofactor",valueHex:new Uint8Array(z(i.h)).buffer})]}),Ji=i=>new be({name:"algorithm",value:[new gt({name:"algorithm",value:Hi}),Ki(i)]}),qi=(i,e)=>new be({name:"SubjectPublicKeyInfo",value:[Ji(i),new dt({name:"subjectPublicKey",valueHex:new Uint8Array(z(e)).buffer})]});function zi(i){return e=>{const t=qi(i,e);return z(t.toString("hex"))}}function Yi(i){const e=zi(i);return t=>e(Ni(ht(t)))}const Wi=Yi({p:"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF",a:"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC",b:"5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B",seed:"C49D360886E704936A6678E1139D26B7819F7E90",generator:"046B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C2964FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",n:"FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551",h:"01"});async function Zi(i,e,t){const r=await window.crypto.subtle.importKey("raw",ht(e),{name:"ECDH",namedCurve:"P-256"},!0,[]),n=await window.crypto.subtle.deriveKey({name:"ECDH",public:r},i.privateKey,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),s=await window.crypto.subtle.exportKey("raw",t),a=await window.crypto.subtle.exportKey("raw",n),l=Ge([new Uint8Array(a),new Uint8Array([0,0,0,1]),Wi(Ke(new Uint8Array(s)))]);return await window.crypto.subtle.digest("SHA-256",l)}const kn=new Uint32Array(256);for(let i=0;i<256;i++){let e=i;for(let t=0;t<8;t++)e&1?e=3988292384^e>>>1:e>>>=1;kn[i]=e}function Xi(i){let e=4294967295;const t=i.byteLength;for(let r=0;r<t;r++)e=kn[(e^i[r])&255]^e>>>8;return e^4294967295}function Sn(i,e){return i===e?"inputs":"default"}function xn(i,e){return typeof i=="number"?`${i}px`:typeof i=="string"?i:e}function Cn(i,e,t,r){if(window==null)throw new Ne("`window` object not found. You cannot run this SDK outside of a browser environment.");if(!("fetch"in window))throw new Ne("Your browser is outdated and does not support window.fetch(). Please upgrade it.");async function n(){try{const a=new URL(`${e}/apps/${t}?context=${r}`,i.keysUrl),l=await fetch(a,{method:"GET"});if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);const c=await l.json(),{headers:u}=l;return{...c,isDebugMode:u.get("X-Evervault-Inputs-Debug-Mode")==="true"}}catch(a){throw new wi("An error occurred while retrieving the apps key",{cause:a})}}async function s(a,l){try{const c=await fetch(`${i.apiUrl}/decrypt`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Token ${a}`},body:JSON.stringify(l)});if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);return await c.json()}catch(c){throw new Ei("An error occurred while decrypting the data",{cause:c})}}return{getCageKey:n,decryptWithToken:s}}function Qi(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Ot={exports:{}},Ie=typeof Reflect=="object"?Reflect:null,Nn=Ie&&typeof Ie.apply=="function"?Ie.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)},pt;Ie&&typeof Ie.ownKeys=="function"?pt=Ie.ownKeys:Object.getOwnPropertySymbols?pt=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:pt=function(e){return Object.getOwnPropertyNames(e)};function es(i){console&&console.warn&&console.warn(i)}var Vn=Number.isNaN||function(e){return e!==e};function E(){E.init.call(this)}Ot.exports=E,Ot.exports.once=is,E.EventEmitter=E,E.prototype._events=void 0,E.prototype._eventsCount=0,E.prototype._maxListeners=void 0;var Ln=10;function mt(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}Object.defineProperty(E,"defaultMaxListeners",{enumerable:!0,get:function(){return Ln},set:function(i){if(typeof i!="number"||i<0||Vn(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");Ln=i}}),E.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},E.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Vn(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Un(i){return i._maxListeners===void 0?E.defaultMaxListeners:i._maxListeners}E.prototype.getMaxListeners=function(){return Un(this)},E.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n=e==="error",s=this._events;if(s!==void 0)n=n&&s.error===void 0;else if(!n)return!1;if(n){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var l=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw l.context=a,l}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")Nn(c,this,t);else for(var u=c.length,d=On(c,u),r=0;r<u;++r)Nn(d[r],this,t);return!0};function In(i,e,t,r){var n,s,a;if(mt(t),s=i._events,s===void 0?(s=i._events=Object.create(null),i._eventsCount=0):(s.newListener!==void 0&&(i.emit("newListener",e,t.listener?t.listener:t),s=i._events),a=s[e]),a===void 0)a=s[e]=t,++i._eventsCount;else if(typeof a=="function"?a=s[e]=r?[t,a]:[a,t]:r?a.unshift(t):a.push(t),n=Un(i),n>0&&a.length>n&&!a.warned){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=i,l.type=e,l.count=a.length,es(l)}return i}E.prototype.addListener=function(e,t){return In(this,e,t,!1)},E.prototype.on=E.prototype.addListener,E.prototype.prependListener=function(e,t){return In(this,e,t,!0)};function ts(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Fn(i,e,t){var r={fired:!1,wrapFn:void 0,target:i,type:e,listener:t},n=ts.bind(r);return n.listener=t,r.wrapFn=n,n}E.prototype.once=function(e,t){return mt(t),this.on(e,Fn(this,e,t)),this},E.prototype.prependOnceListener=function(e,t){return mt(t),this.prependListener(e,Fn(this,e,t)),this},E.prototype.removeListener=function(e,t){var r,n,s,a,l;if(mt(t),n=this._events,n===void 0)return this;if(r=n[e],r===void 0)return this;if(r===t||r.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if(typeof r!="function"){for(s=-1,a=r.length-1;a>=0;a--)if(r[a]===t||r[a].listener===t){l=r[a].listener,s=a;break}if(s<0)return this;s===0?r.shift():rs(r,s),r.length===1&&(n[e]=r[0]),n.removeListener!==void 0&&this.emit("removeListener",e,l||t)}return this},E.prototype.off=E.prototype.removeListener,E.prototype.removeAllListeners=function(e){var t,r,n;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var s=Object.keys(r),a;for(n=0;n<s.length;++n)a=s[n],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=r[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this};function Rn(i,e,t){var r=i._events;if(r===void 0)return[];var n=r[e];return n===void 0?[]:typeof n=="function"?t?[n.listener||n]:[n]:t?ns(n):On(n,n.length)}E.prototype.listeners=function(e){return Rn(this,e,!0)},E.prototype.rawListeners=function(e){return Rn(this,e,!1)},E.listenerCount=function(i,e){return typeof i.listenerCount=="function"?i.listenerCount(e):Tn.call(i,e)},E.prototype.listenerCount=Tn;function Tn(i){var e=this._events;if(e!==void 0){var t=e[i];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}E.prototype.eventNames=function(){return this._eventsCount>0?pt(this._events):[]};function On(i,e){for(var t=new Array(e),r=0;r<e;++r)t[r]=i[r];return t}function rs(i,e){for(;e+1<i.length;e++)i[e]=i[e+1];i.pop()}function ns(i){for(var e=new Array(i.length),t=0;t<e.length;++t)e[t]=i[t].listener||i[t];return e}function is(i,e){return new Promise(function(t,r){function n(a){i.removeListener(e,s),r(a)}function s(){typeof i.removeListener=="function"&&i.removeListener("error",n),t([].slice.call(arguments))}_n(i,e,s,{once:!0}),e!=="error"&&ss(i,n,{once:!0})})}function ss(i,e,t){typeof i.on=="function"&&_n(i,"error",e,t)}function _n(i,e,t,r){if(typeof i.on=="function")r.once?i.once(e,t):i.on(e,t);else if(typeof i.addEventListener=="function")i.addEventListener(e,function n(s){r.once&&i.removeEventListener(e,n),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i)}var os=Ot.exports;function as(i){const e=new os.EventEmitter;return{async handleForm(t){var a;let r;const n=t.querySelectorAll("input"),s={};for(let l=0;l<n.length;l++){r=n[l];const{id:c,name:u,value:d}=r;if(c||u)if(r.hasAttribute("data-encrypt")){const h=await i.encrypt(d),p=document.createElement("input");p.type="hidden",p.value=h,p.setAttribute("data-evervault-created","yes"),c&&(p.id=c.replace("ev-hidden-","")),u&&(p.name=u.replace("ev-hidden-","")),t.appendChild(p),(a=r.id)!=null&&a.startsWith("ev-hidden-")&&(r.id=`ev-hidden-${c}`),r.name="",t[c||u].value=h,s[c?c.replace("ev-hidden-",""):u.replace("ev-hidden-","")]=h}else t[c||u].value=d,s[c||u]=d}return s},register(){const t=document.querySelectorAll("[data-evervault-form]");let r;t.length!=0&&console.error("Evervault Forms is no longer a supported Evervault product. This feature is not to beused in production code and will be removed in a future version. Please contact Evervault support if you see this message.");for(let n=0;n<t.length;n++){r=t[n];const s=r.onsubmit;r.onsubmit=async a=>{a.preventDefault();const l=await this.handleForm(r);if(this.events.emit("form-ready",l),r.getAttribute("data-evervault-form")==="auto")s?s():r.submit();else return!1}}},events:e}}const ls=i=>{var e;return((e=i.data)==null?void 0:e.type)==="EV_FRAME_HEIGHT"},Dn=i=>{var e;return((e=i.data)==null?void 0:e.type)==="EV_REVEAL_ERROR_EVENT"};function cs(i){return{generate(e,t,r=!1,n=void 0,s=void 0){return document.getElementById(e).innerHTML=`<iframe src="${xi(i,r,t)}" id="ev-iframe" title="Payment details" frameborder="0" scrolling="0" height=${Ai(t,r)} ${r?'width="100%"':""} allowTransparency="true" allow="clipboard-write"></iframe>`,window.addEventListener("message",l=>{l.origin===i.input.inputsOrigin&&(t==null?void 0:t.height)==="auto"&&ls(l)&&(document.getElementById(e).firstChild.height=l.data.height)}),{isInputsLoaded:new Promise((l,c)=>{window.addEventListener("message",u=>{var d,h,p,B;if(u.origin===i.input.inputsOrigin){if(((d=u.data)==null?void 0:d.type)==="EV_INPUTS_LOADED")if(r){if(!n)throw new Error("Request is required for Evervault Reveal");const k={cache:n.cache,credentials:n.credentials,destination:n.destination,integrity:n.integrity,keepalive:n.keepalive,method:n.method,mode:n.mode,referrer:n.referrer,referrerPolicy:n.referrerPolicy,url:n.url};n.headers instanceof Headers?k.headers=Object.fromEntries(n.headers.entries()):n.headers instanceof Object&&(k.headers=n.headers);const L=JSON.stringify(k),{customStyles:wt}=t,zs=new MessageChannel;(h=document.getElementById("ev-iframe").contentWindow)==null||h.postMessage({type:"revealRequestConfig",request:L,customStyles:wt},"*",[zs.port2])}else l(!0);else((p=u.data)==null?void 0:p.type)==="EV_REVEAL_COPY_EVENT"&&r&&s&&s();if(Dn(u)){const k=u.data.error;if(k)try{const L=JSON.parse(k);try{const wt=window[L.type];c(new wt(L.message))}catch{c(new Error(L.message))}}catch(L){c(`Failed to parse Error: ${L.message}, Unparsed: ${k}`)}}(((B=u.data)==null?void 0:B.type)==="EV_REVEAL_LOADED"||Dn(u))&&r&&l(!0)}})}),getData:()=>new Promise(l=>{var u;const c=new MessageChannel;c.port1.onmessage=({data:d})=>(c.port1.close(),l(d)),(u=document.getElementById("ev-iframe").contentWindow)==null||u.postMessage("message","*",[c.port2])}),on:(l,c)=>{l==="change"&&window.addEventListener("message",u=>{var d,h,p,B,k,L;u.origin===i.input.inputsOrigin&&((d=u.data)==null?void 0:d.type)!=="EV_FRAME_HEIGHT"&&((h=u.data)==null?void 0:h.type)!=="EV_INPUTS_LOADED"&&((p=u.data)==null?void 0:p.type)!=="EV_FRAME_READY"&&((B=u.data)==null?void 0:B.type)!=="EV_REVEAL_COPY_EVENT"&&((k=u.data)==null?void 0:k.type)!=="EV_REVEAL_LOADED"&&((L=u.data)==null?void 0:L.type)!=="EV_REVEAL_ERROR_EVENT"&&c(u.data)},!1)},setLabels:l=>{var u;const c=new MessageChannel;(u=document.getElementById("ev-iframe").contentWindow)==null||u.postMessage(l,"*",[c.port2])}}}}}function Mn(i){const e=new Uint8Array(i);if(window.crypto)return window.crypto.getRandomValues(e),e;throw new vi("Your browser is outdated and does not support the Web Crypto API. Please upgrade it.")}function _t(i){return i.replace(/={1,2}$/,"")}async function us(i,e,t,r,n,s){const a=await window.crypto.subtle.exportKey("raw",r),l=ut(a);return`ev:${s?"debug:":""}${i}${e!=="string"?`:${e}`:""}:${_t(t)}:${_t(Ke(l))}:${_t(n)}:$`}async function Hn(i,e,t,r,n){const s=await window.crypto.subtle.exportKey("raw",e),a=ut(s),l=new Uint8Array([37,69,86,69,78,67]),c=new Uint8Array([3]),u=new Uint8Array([55,0]),d=r?new Uint8Array([1]):new Uint8Array([0]),h=Ge([l,c,u,a,i,d]),p=Ge([h,new Uint8Array(t)]),B=Xi(p),k=new Uint8Array([B&255,B>>8&255,B>>16&255,B>>24&255]),L=Ge([p,k]);return n!=null?new File([L],n,{type:"application/octet-stream"}):new Blob([L],{type:"application/octet-stream"})}const vt=class vt{constructor(e,t,r,n,s){g(this,I);g(this,Be);g(this,ue);g(this,Re);g(this,K);g(this,he);m(this,Be,e),m(this,ue,t),m(this,Re,r),m(this,he,s),m(this,K,n)}async encrypt(e,t){if(!At(e))throw new Error("Data must not be undefined");const r=/^[a-z0-9-]{1,20}$/;if(t!=null&&!r.test(t))throw new Error("The provided Data Role slug is invalid. The slug can be retrieved in the Evervault dashboard (Data Roles section).");if(yi(e))return y(this,I,Qn).call(this,e,t);if(zt(e))return y(this,I,Xn).call(this,e,t);if(ct(e))return y(this,I,ot).call(this,[...e],t);if(Zt(e))return y(this,I,Gt).call(this,Qt(e),Xt(e),t);throw new Error("The provided data to be encrypted is invalid.")}};Be=new WeakMap,ue=new WeakMap,Re=new WeakMap,K=new WeakMap,he=new WeakMap,I=new WeakSet,Zn=async function(e){let t=0;e==="number"?t=1:e==="boolean"&&(t=2);const r=1,n=await window.crypto.subtle.exportKey("raw",o(this,ue)),s=ut(n),a=1,l=a+s.byteLength+o(this,Be).length,c=new Uint8Array(l),u=o(this,he)?128:0|t<<4|r;return c[0]=u,c.set(new Uint8Array(s),a),c.set(o(this,Be),a+s.byteLength),c.buffer},Xn=async function(e,t){return y(this,I,ot).call(this,{...e},t)},Qn=async function(e,t){if(t!==void 0)throw new Bi("Data roles are not supported for files.");if(e.size>o(this,K).maxFileSizeInBytes)throw new bi(`File size must be less than ${o(this,K).maxFileSizeInMB}MB`);const r=Mn(o(this,K).ivLength),n=await window.crypto.subtle.importKey("raw",o(this,Re),{name:"AES-GCM"},!0,["encrypt"]);return new Promise((s,a)=>{const l=new window.FileReader;l.onloadend=c=>{const u=l.result;if(u==null||typeof u=="string"){a({error:"Failed to read file to be encrypted"});return}window.crypto.subtle.encrypt({name:"AES-GCM",iv:r,tagLength:o(this,K).authTagLength,additionalData:o(this,Be)},n,u).then(d=>{e instanceof File?s(Hn(r,o(this,ue),d,o(this,he),e.name)):s(Hn(r,o(this,ue),d,o(this,he)))})},l.readAsArrayBuffer(e)})},Gt=async function(e,t,r){var h;const n=Mn(o(this,K).ivLength),s=await window.crypto.subtle.importKey("raw",o(this,Re),{name:"AES-GCM"},!0,["encrypt"]),a=o(this,K).versions.BFS,l=y(h=vt,yt,ei).call(h,Math.floor(Date.now()/1e3),r),c=new Uint8Array(2);c[0]=l.length&255,c[1]=l.length>>8&255;const u=Ge([c,l,Ci(e)]),d=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:n,tagLength:o(this,K).authTagLength,additionalData:await y(this,I,Zn).call(this,t)},s,u);return us(a,t,Ke(n),o(this,ue),Ke(new Uint8Array(d)),o(this,he))},yt=new WeakSet,ei=function(e,t){const r=[];return r.push(128|(t?3:2)),t&&(r.push(162),r.push(...Array.from("dr").map(n=>n.charCodeAt(0))),r.push(160|t.length),r.push(...Array.from(t).map(n=>n.charCodeAt(0)))),r.push(162),r.push(...Array.from("eo").map(n=>n.charCodeAt(0))),r.push(5),r.push(162),r.push(...Array.from("et").map(n=>n.charCodeAt(0))),r.push(206),r.push(e>>24&255),r.push(e>>16&255),r.push(e>>8&255),r.push(e&255),new Uint8Array(r)},ot=async function(e,t){if(Zt(e))return y(this,I,Gt).call(this,Qt(e),Xt(e),t);if(zt(e)){const r={...e};for(const[n,s]of Object.entries(r))r[n]=await y(this,I,ot).call(this,s,t);return r}if(ct(e)){const r=[...e];return Promise.all(r.map(async n=>y(this,I,ot).call(this,n,t)))}return e},g(vt,yt);let Dt=vt;function hs(i){return e=>({styles:{":root":{"--icon-offset":"1.9rem"},body:{paddingBottom:2},label:{fontSize:14,marginBottom:4,display:"block",color:"#0a2540"},input:{height:40,fontSize:16,borderRadius:6,color:"#0a2540",padding:"0 12px",backgroundColor:"#fff",border:"1px solid #e6ebf1",boxShadow:"0px 1px 1px rgba(0, 0, 0, .03), 0px 3px 6px rgba(0, 0, 0, .02)","&::placeholder":{color:"#717f96"},"&:focus":{outline:"none",borderColor:"#63e"}},textarea:{height:40,fontSize:16,borderRadius:6,color:"#0a2540",padding:"6px 12px",backgroundColor:"#fff",border:"1px solid #e6ebf1",boxShadow:"0px 1px 1px rgba(0, 0, 0, .03), 0px 3px 6px rgba(0, 0, 0, .02)","&::placeholder":{color:"#717f96"},"&:focus":{outline:"none",borderColor:"#63e"}},select:{height:40,fontSize:16,borderRadius:6,color:"#0a2540",padding:"6px 12px",backgroundColor:"#fff",border:"1px solid #e6ebf1"},button:{fontSize:16,height:40,border:"1px solid #e6ebf1",padding:"0 12px"},".field[ev-valid=false] input":{color:"#df1c41",borderColor:"#df1c41"},".error":{color:"#df1c41",fontSize:"0.75rem",padding:"0.25rem 0"},"[ev-component=card]":{gap:16},"[ev-component=pin] input":{height:80,fontSize:20,caretColor:"transparent"},"[ev-component=card]:has(.icon)":{"& .field[ev-name=number]":{position:"relative"},"& .icon":{left:10,height:20,position:"absolute",top:"var(--icon-offset)"},"& .field[ev-name=number] input":{paddingLeft:48}},...i?e.extend(i):{}}})}function fs(i){return e=>({styles:{body:{paddingTop:4},".field":{position:"relative"},label:{top:10,left:8,zIndex:3,fontSize:14,lineHeight:1,height:"20px",display:"flex",color:"#717f96",padding:"0 4px",alignItems:"center",position:"absolute",pointerEvents:"none",transformOrigin:"center left",transition:"transform 150ms, background 150ms"},input:{height:40,fontSize:16,borderRadius:6,color:"#0a2540",padding:"0 12px",backgroundColor:"#fff",border:"1px solid #e6ebf1","&::placeholder":{color:"transparent"},"&:focus":{outline:"none",borderColor:"#63e"}},textarea:{height:40,fontSize:16,borderRadius:6,color:"#0a2540",padding:"6 12px",backgroundColor:"#fff",border:"1px solid #e6ebf1","&::placeholder":{color:"transparent"},"&:focus":{outline:"none",borderColor:"#63e"}},".field[ev-valid=false] input":{color:"#df1c41",borderColor:"#df1c41"},".field:focus-within label, .field:not([ev-has-value=false]) label":{background:"white",transform:"translateY(-100%) scale(0.8)"},".error":{color:"#df1c41",fontSize:"0.75rem",padding:"0.25rem 0"},".field:not([ev-valid=false]):focus-within label":{color:"#63e"},".field[ev-valid=false] label":{color:"#df1c41"},".field[ev-has-value=true][ev-valid=true]:not(:focus-within) label":{color:"#0a2540"},"[ev-component=card]":{gap:16},"[ev-component=card]:has(.icon)":{"& .icon":{left:10,height:20,position:"absolute",top:10,opacity:0},"& .field[ev-name=number]:focus-within, & .field[ev-name=number]:not([ev-has-value=false])":{"& .icon":{opacity:1},"& input":{paddingLeft:45}}},...i?e.extend(i):{}}})}function ds(i){return e=>({styles:{":root":{"--icon-offset":"34px"},body:{paddingBottom:2},label:{fontSize:14,marginBottom:"0.5rem",color:"#0a2540",display:"none"},".field:first-child label":{display:"block"},"fieldset[ev-valid=false]":{paddingBottom:"1.5rem"},input:{height:40,fontSize:16,borderRadius:0,color:"#0a2540",padding:"0 12px",backgroundColor:"#fff",border:"1px solid #e6ebf1",boxShadow:"0px 1px 1px rgba(0, 0, 0, .03), 0px 3px 6px rgba(0, 0, 0, .02)","&::placeholder":{color:"#717f96"},"&:focus":{outline:"none",borderColor:"#63e"}},textarea:{height:40,fontSize:16,borderRadius:0,color:"#0a2540",padding:"6 12px",backgroundColor:"#fff",border:"1px solid #e6ebf1",boxShadow:"0px 1px 1px rgba(0, 0, 0, .03), 0px 3px 6px rgba(0, 0, 0, .02)","&::placeholder":{color:"#717f96"},"&:focus":{outline:"none",borderColor:"#63e"}},".field[ev-valid=false] input":{color:"#df1c41",borderColor:"#df1c41"},".error":{color:"#df1c41",fontSize:"0.75rem",padding:"0.25rem 0",position:"absolute",left:0,bottom:0,display:"none"},".field[ev-valid=false]":{zIndex:4},".field:focus-within":{zIndex:5},"[ev-component=card]":{gap:0,"& .field[ev-valid=false]:nth-child(1) .error":{display:"block"},"& [ev-valid=true]:nth-child(1) + [ev-valid=false] .error":{display:"block"},"& [ev-valid=true]:nth-child(1) + [ev-valid=true]:nth-child(2) + [ev-valid=false] .error":{display:"block"},"& [ev-valid=true]:nth-child(1) + [ev-valid=true]:nth-child(2) + [ev-valid=true]:nth-child(3) + [ev-valid=false] .error":{display:"block"},"& .field:not(:last-child)":{marginBottom:"-1px"},"& .field:first-child":{"& input":{borderTopLeftRadius:6,borderTopRightRadius:6}},"& .field:last-child":{"& input":{borderBottomRightRadius:6,borderBottomLeftRadius:6}}},"[ev-component=card][ev-fields*=cvc][ev-fields*=expiry]":{"& .field[ev-name=expiry]":{"& input":{borderBottomLeftRadius:6}},"& .field[ev-name=cvc]":{marginLeft:"-1px","& input":{borderBottomLeftRadius:0}}},"[ev-component=pin]":{gap:0,"& input":{height:60},"& .field:not(:first-child)":{marginLeft:"-1px"},"& .field:first-child input":{borderTopLeftRadius:6,borderBottomLeftRadius:6},"& .field:last-child input":{borderTopRightRadius:6,borderBottomRightRadius:6}},"[ev-component=card]:has(.icon)":{"& .icon":{left:10,height:20,position:"absolute",top:"var(--icon-offset)"},"& .field[ev-name=number] input":{paddingLeft:48}},...i?e.extend(i):{}}})}const gs=Object.freeze(Object.defineProperty({__proto__:null,clean:hs,material:fs,minimal:ds},Symbol.toStringTag,{value:"Module"}));class le{constructor(){g(this,Te,new EventTarget)}on(e,t){if(typeof t!="function")throw new Error("callback must be a function");const r=n=>{t(n.detail)};return o(this,Te).addEventListener(e,r),()=>{o(this,Te).removeEventListener(e,r)}}dispatch(e,t){const r=new CustomEvent(e,{detail:t});o(this,Te).dispatchEvent(r)}}Te=new WeakMap;var ps=function(e){return ms(e)&&!ys(e)};function ms(i){return!!i&&typeof i=="object"}function ys(i){var e=Object.prototype.toString.call(i);return e==="[object RegExp]"||e==="[object Date]"||bs(i)}var vs=typeof Symbol=="function"&&Symbol.for,ws=vs?Symbol.for("react.element"):60103;function bs(i){return i.$$typeof===ws}function Es(i){return Array.isArray(i)?[]:{}}function We(i,e){return e.clone!==!1&&e.isMergeableObject(i)?Fe(Es(i),i,e):i}function Bs(i,e,t){return i.concat(e).map(function(r){return We(r,t)})}function As(i,e){if(!e.customMerge)return Fe;var t=e.customMerge(i);return typeof t=="function"?t:Fe}function ks(i){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(i).filter(function(e){return Object.propertyIsEnumerable.call(i,e)}):[]}function Pn(i){return Object.keys(i).concat(ks(i))}function $n(i,e){try{return e in i}catch{return!1}}function Ss(i,e){return $n(i,e)&&!(Object.hasOwnProperty.call(i,e)&&Object.propertyIsEnumerable.call(i,e))}function xs(i,e,t){var r={};return t.isMergeableObject(i)&&Pn(i).forEach(function(n){r[n]=We(i[n],t)}),Pn(e).forEach(function(n){Ss(i,n)||($n(i,n)&&t.isMergeableObject(e[n])?r[n]=As(n,t)(i[n],e[n],t):r[n]=We(e[n],t))}),r}function Fe(i,e,t){t=t||{},t.arrayMerge=t.arrayMerge||Bs,t.isMergeableObject=t.isMergeableObject||ps,t.cloneUnlessOtherwiseSpecified=We;var r=Array.isArray(e),n=Array.isArray(i),s=r===n;return s?r?t.arrayMerge(i,e,t):xs(i,e,t):We(e,t)}Fe.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(r,n){return Fe(r,n,t)},{})};var Cs=Fe,Ns=Cs;const Mt=Qi(Ns);class jn{constructor(e,t={}){g(this,_e);S(this,"object");S(this,"frame");g(this,Ze);g(this,Oe,{});this.object=y(this,_e,bt).call(this,t),this.frame=e}update(e){this.object=y(this,_e,bt).call(this,e)}get utilities(){return{media:this.media.bind(this),extend:this.extend.bind(this)}}extend(e){return m(this,Ze,y(this,_e,bt).call(this,e)),{}}media(e,t){const r=window.matchMedia(e),n=s=>{o(this,Oe)[e].matches=s.matches,this.frame.update()};return r.addEventListener("change",n),o(this,Oe)[e]={styles:t,matches:r.matches},{}}compile(){const e=o(this,Ze),r=Object.values(o(this,Oe)).filter(a=>a.matches).reduce((a,l)=>Mt(a,l.styles),{}),n=Mt(this.object,e??{});return{...n,styles:Mt(n.styles||{},r)}}}Ze=new WeakMap,Oe=new WeakMap,_e=new WeakSet,bt=function(e){return typeof e=="function"?e(this.utilities):e};function Gn(i=10){return Math.random().toString(36).substring(2,i+2)}function Kn(i){if(typeof i=="string"){const e=document.querySelector(i);if(!e)throw new Error(`Element with selector ${i} not found`);return e}return i}const Vs=["normal","light","dark","only light","only dark","light dark"];class ce{constructor(e,t,r){g(this,De);S(this,"iframe");S(this,"payload");g(this,re,Gn());g(this,ne,null);g(this,Ae);g(this,Xe,!1);g(this,Qe);m(this,Ae,e),this.iframe=document.createElement("iframe"),this.iframe.id=o(this,re),this.iframe.src=y(this,De,ti).call(this,t,r),this.iframe.dataset.evervault="component",this.iframe.style.height="0",this.iframe.style.border="none",this.iframe.style.width="100%",this.iframe.style.display="block",this.iframe.allow="payment",r!=null&&r.size&&this.setSize(r.size),this.iframe.setAttribute("ev-component",t),r!=null&&r.allow&&(this.iframe.allow=r.allow)}setSize(e){m(this,Qe,e),this.iframe.style.width=e.width,this.iframe.style.height=e.height}mount(e,t={}){if(this.isMounted)throw new Error("Evervault frame already mounted");const r=Kn(e);return m(this,ne,t.theme?new jn(this,t.theme):null),this.on("EV_FRAME_HANDSHAKE",()=>{var n;y(this,De,ri).call(this),this.send("EV_INIT",{theme:(n=o(this,ne))==null?void 0:n.compile(),config:t.config})}),this.on("EV_FRAME_READY",()=>{m(this,Xe,!0)}),this.iframe.onerror=t.onError??null,r.appendChild(this.iframe),this}unmount(){this.iframe.remove();const e=document.getElementById(`ev-modal-${o(this,re)}`);return e==null||e.remove(),this}createOverlay(){const e=document.createElement("div");return e.id=`ev-modal-${o(this,re)}`,e.style.position="fixed",e.style.inset="0px",e.style.zIndex="9999",document.body.appendChild(e),e}update(e){var t,r;return e!=null&&e.theme&&(o(this,ne)?(t=o(this,ne))==null||t.update(e.theme):m(this,ne,new jn(this,e.theme))),o(this,Xe)?(this.send("EV_UPDATE",{theme:(r=o(this,ne))==null?void 0:r.compile(),config:e==null?void 0:e.config}),this):this}on(e,t){const r=n=>{n.data.frame===o(this,re)&&n.data.type===e&&t(n.data.payload)};return window.addEventListener("message",r),()=>window.removeEventListener("message",r)}once(e,t){const r=n=>{n.data.frame===o(this,re)&&n.data.type===e&&(t(n.data.payload),window.removeEventListener("message",r))};return window.addEventListener("message",r),()=>window.removeEventListener("message",r)}send(e,t){var n;if(!this.iframe.contentWindow)return;const r={type:e,payload:t};(n=this.iframe.contentWindow)==null||n.postMessage(r,this.url)}get isMounted(){return!!this.iframe.parentNode}get url(){return o(this,Ae).config.components.url}}re=new WeakMap,ne=new WeakMap,Ae=new WeakMap,Xe=new WeakMap,Qe=new WeakMap,De=new WeakSet,ti=function(e,t){const r=new URL(this.url);return r.searchParams.set("id",o(this,re)),r.searchParams.set("app",o(this,Ae).config.appId),r.searchParams.set("team",o(this,Ae).config.teamId),r.searchParams.set("component",e),t!=null&&t.colorScheme&&Vs.includes(t==null?void 0:t.colorScheme)&&r.searchParams.set("colorScheme",t.colorScheme),r.toString()},ri=function(){this.on("EV_RESIZE",({height:e,width:t,minWidth:r,minHeight:n})=>{this.iframe&&(o(this,Qe)||(this.iframe.style.height=`${e}px`,t&&(this.iframe.style.width=`${t}px`)),r&&(this.iframe.style.minWidth=`${r}px`),n&&(this.iframe.style.minHeight=`${n}px`))})};class Ls{constructor(e,t){S(this,"values");g(this,C);g(this,V);g(this,O,new le);m(this,C,t??{}),m(this,V,new ce(e,"Card",{colorScheme:o(this,C).colorScheme})),o(this,V).on("EV_CHANGE",r=>{this.values=r,o(this,O).dispatch("change",r)}),o(this,V).on("EV_COMPLETE",r=>{o(this,O).dispatch("complete",r)}),o(this,V).on("EV_SWIPE",r=>{o(this,O).dispatch("swipe",r)}),o(this,V).on("EV_FRAME_READY",()=>{o(this,O).dispatch("ready")}),o(this,V).on("EV_FOCUS",r=>{o(this,O).dispatch("focus",{field:r,data:this.values})}),o(this,V).on("EV_BLUR",r=>{o(this,O).dispatch("blur",{field:r,data:this.values})}),o(this,V).on("EV_KEYDOWN",r=>{o(this,O).dispatch("keydown",{field:r,data:this.values})}),o(this,V).on("EV_KEYUP",r=>{o(this,O).dispatch("keyup",{field:r,data:this.values})}),this.values={card:{name:null,brand:null,localBrands:[],bin:null,lastFour:null,number:null,expiry:{month:null,year:null},cvc:null},isValid:!1,isComplete:!1,errors:null}}get config(){var e;return{theme:o(this,C).theme,config:{icons:o(this,C).icons,autoFocus:o(this,C).autoFocus,translations:o(this,C).translations,hiddenFields:(e=o(this,C).hiddenFields??[])==null?void 0:e.join(","),fields:o(this,C).fields,acceptedBrands:o(this,C).acceptedBrands,defaultValues:o(this,C).defaultValues,autoComplete:o(this,C).autoComplete,autoProgress:o(this,C).autoProgress,redactCVC:o(this,C).redactCVC,allow3DigitAmexCVC:o(this,C).allow3DigitAmexCVC,validation:o(this,C).validation}}}mount(e){return o(this,V).mount(e,{...this.config,onError:()=>{o(this,O).dispatch("error")}}),this}update(e){var t;return e&&m(this,C,{...o(this,C),...e}),(t=e==null?void 0:e.defaultValues)!=null&&t.name&&o(this,V).send("EV_UPDATE_NAME",e.defaultValues.name),o(this,V).update(this.config),this}unmount(){return o(this,V).unmount(),this}on(e,t){return o(this,O).on(e,t)}validate(){return o(this,V).send("EV_VALIDATE"),o(this,V).once("EV_VALIDATED",e=>{this.values=e,o(this,O).dispatch("validate",e)}),this}}C=new WeakMap,V=new WeakMap,O=new WeakMap;class Us{constructor(e,t){g(this,W);g(this,Z);g(this,fe,new le);m(this,W,t??{}),m(this,Z,new ce(e,"Form",{colorScheme:o(this,W).colorScheme})),o(this,Z).on("EV_FRAME_READY",()=>{o(this,fe).dispatch("ready")}),o(this,Z).on("EV_ERROR",()=>{o(this,fe).dispatch("error")}),o(this,Z).on("EV_SUBMITTED",()=>{o(this,fe).dispatch("submitted")})}get config(){return{theme:o(this,W).theme,config:{formSubmissionUrl:o(this,W).formSubmissionUrl,formUuid:o(this,W).formUuid}}}mount(e){return o(this,Z).mount(e,{...this.config,onError:()=>{o(this,fe).dispatch("error")}}),this}unmount(){return o(this,Z).unmount(),this}update(e){return e&&m(this,W,{...o(this,W),...e}),o(this,Z).update(this.config),this}on(e,t){return o(this,fe).on(e,t)}}W=new WeakMap,Z=new WeakMap,fe=new WeakMap;class Is{constructor(e,t){S(this,"values",{value:"",isComplete:!1});g(this,j);g(this,X);g(this,de,new le);m(this,j,t??{}),m(this,X,new ce(e,"Pin",{colorScheme:o(this,j).colorScheme})),o(this,X).on("EV_CHANGE",r=>{this.values=r,o(this,de).dispatch("change",r)}),o(this,X).on("EV_COMPLETE",r=>{this.values=r,o(this,de).dispatch("complete",r)}),o(this,X).on("EV_FRAME_READY",()=>{o(this,de).dispatch("ready")})}get config(){return{theme:o(this,j).theme,config:{length:Math.min(o(this,j).length??4,10),mode:o(this,j).mode??"numeric",autoFocus:o(this,j).autoFocus,inputType:o(this,j).inputType}}}mount(e){return o(this,X).mount(e,{...this.config,onError:()=>{o(this,de).dispatch("error")}}),this}unmount(){return o(this,X).unmount(),this}update(e){return e&&m(this,j,{...o(this,j),...e}),o(this,X).update(this.config),this}on(e,t){return o(this,de).on(e,t)}}j=new WeakMap,X=new WeakMap,de=new WeakMap;class Fs{constructor(e,t,r,n){S(this,"path");S(this,"ready",!1);S(this,"options");g(this,et);g(this,ge);g(this,tt,new le);this.path=r,m(this,et,e),this.options=n??{},m(this,ge,new ce(t,"RevealCopyButton",{allow:"clipboard-read; clipboard-write",colorScheme:this.options.colorScheme})),o(this,ge).on("EV_REVEAL_CONSUMER_READY",()=>{this.ready=!0,e.checkIfReady()}),o(this,ge).on("EV_COPY",()=>{o(this,tt).dispatch("copy")})}mount(e){return o(this,ge).mount(e,{theme:this.options.theme,config:{path:this.path,text:this.options.text,icon:this.options.icon,channel:o(this,et).channel,format:this.options.format}}),this}unmount(){return o(this,ge).unmount(),this}on(e,t){return o(this,tt).on(e,t)}}et=new WeakMap,ge=new WeakMap,tt=new WeakMap;class Rs{constructor(e,t,r,n){S(this,"path");S(this,"ready",!1);g(this,rt);g(this,ke);g(this,Se);this.path=r,m(this,rt,e),m(this,Se,n??{}),m(this,ke,new ce(t,"RevealText",{colorScheme:o(this,Se).colorScheme})),o(this,ke).on("EV_REVEAL_CONSUMER_READY",()=>{this.ready=!0,e.checkIfReady()})}mount(e){return o(this,ke).mount(e,{theme:o(this,Se).theme,config:{path:this.path,channel:o(this,rt).channel,format:o(this,Se).format}}),this}unmount(){return o(this,ke).unmount(),this}}rt=new WeakMap,ke=new WeakMap,Se=new WeakMap;class Ts{constructor(e,t){g(this,ie);S(this,"ready",!1);S(this,"channel");g(this,Me);g(this,F);g(this,J);S(this,"consumers",[]);g(this,He,new le);this.channel=Gn(),m(this,Me,e),m(this,F,t),m(this,J,new ce(e,"RevealRequest")),o(this,J).iframe.style.position="absolute",o(this,J).iframe.style.pointerEvents="none",o(this,J).iframe.style.opacity="0",y(this,ie,ni).call(this).catch(console.error),o(this,J).on("EV_REVEAL_REQUEST_READY",()=>{this.ready=!0,this.checkIfReady()}),o(this,J).on("EV_ERROR",()=>{y(this,ie,Kt).call(this)})}text(e,t){const r=new Rs(this,o(this,Me),e,t);return this.consumers.push(r),r}copyButton(e,t){const r=new Fs(this,o(this,Me),e,t);return this.consumers.push(r),r}unmount(){return this.consumers.forEach(e=>e.unmount()),o(this,J).unmount(),this}on(e,t){return o(this,He).on(e,t)}checkIfReady(){!this.ready||!this.consumers.every(t=>t.ready)||o(this,He).dispatch("ready")}}Me=new WeakMap,F=new WeakMap,J=new WeakMap,He=new WeakMap,ie=new WeakSet,ni=async function(){o(this,J).mount(document.body,{config:{channel:this.channel,request:await y(this,ie,ii).call(this)},onError:()=>{y(this,ie,Kt).call(this)}})},ii=async function(){return{cache:o(this,F).cache,credentials:o(this,F).credentials,destination:o(this,F).destination,integrity:o(this,F).integrity,keepalive:o(this,F).keepalive,method:o(this,F).method,mode:o(this,F).mode,referrer:o(this,F).referrer,referrerPolicy:o(this,F).referrerPolicy,url:o(this,F).url,body:await o(this,F).text(),headers:Object.fromEntries(o(this,F).headers.entries())}},Kt=function(){o(this,He).dispatch("error")};class Os{constructor(e,t,r){g(this,q);g(this,Pe);g(this,$e);g(this,$);g(this,je);g(this,U);g(this,pe,new le);m(this,Pe,t),m(this,$,r??{}),m(this,$e,!1),m(this,U,new ce(e,"ThreeDSecure",{colorScheme:o(this,$).colorScheme})),m(this,je,e),o(this,U).on("EV_SUCCESS",n=>{y(this,q,at).call(this,"success",n)}),o(this,U).on("EV_FAILURE",n=>{y(this,q,at).call(this,"failure",n)}),o(this,U).on("EV_FAILURE_FORCED_DUE_TO_CHALLENGE",n=>{y(this,q,at).call(this,"failure",n,!0)}),o(this,U).on("EV_FAIL_ON_CHALLENGE",async()=>{const n=await y(this,q,si).call(this);o(this,U).send("EV_FAIL_ON_CHALLENGE_RESULT",n)}),o(this,U).on("EV_CANCEL",()=>{y(this,q,at).call(this,"cancelled")}),o(this,U).on("EV_FRAME_READY",()=>{o(this,pe).dispatch("ready")}),o(this,U).on("EV_ERROR",n=>{this.unmount(),o(this,pe).dispatch("error",n),n&&console.error(n.message)})}get config(){return{theme:o(this,$).theme,config:{session:o(this,Pe),size:o(this,$).size,isOverlay:o(this,$e),failOnChallenge:!!o(this,$).failOnChallenge}}}mount(e){const t=e??o(this,U).createOverlay();return e||(m(this,$e,!0),o(this,U).setSize({width:"100%",height:"100%"})),o(this,U).mount(t,{...this.config,onError:()=>{o(this,pe).dispatch("error",{code:"frame-load-error",message:"The iframe required to mount this component failed to load"})}}),this}update(e){return e&&m(this,$,{...o(this,$),...e}),o(this,U).update(this.config),this}unmount(){return o(this,U).unmount(),this}on(e,t){return o(this,pe).on(e,t)}}Pe=new WeakMap,$e=new WeakMap,$=new WeakMap,je=new WeakMap,U=new WeakMap,pe=new WeakMap,q=new WeakSet,si=async function(){if(typeof o(this,$).failOnChallenge=="function"){const e=o(this,$).failOnChallenge();return e instanceof Promise?await e:e}return o(this,$).failOnChallenge??!1},at=async function(e,t,r=!1){await y(this,q,oi).call(this,e,t,r),o(this,pe).dispatch(e==="success"?"success":"failure"),this.unmount()},oi=async function(e,t,r){const n=o(this,je).config.http.apiUrl;let s=e;r&&e==="failure"&&(s="aborted-on-challenge"),await fetch(`${n}/frontend/3ds/browser-sessions/${o(this,Pe)}`,{method:"PATCH",headers:{"X-Evervault-App-Id":o(this,je).config.appId,"Content-Type":"application/json"},body:JSON.stringify({outcome:s,cres:t??null})})};class _s{constructor(e,t,r){g(this,nt);g(this,_);g(this,D);g(this,se,new le);var n,s;m(this,_,r),m(this,nt,t),m(this,D,new ce(e,"GooglePay",{size:{width:xn((n=r.size)==null?void 0:n.width,"250px"),height:xn((s=r.size)==null?void 0:s.height,"45px")},allow:"payment *",colorScheme:o(this,_).colorScheme})),o(this,D).on("EV_FRAME_READY",()=>{o(this,se).dispatch("ready")}),o(this,D).on("EV_GOOGLE_PAY_AUTH",async a=>{try{let l=!1;if(await o(this,_).process(a,{fail:c=>{l=!0,o(this,D).send("EV_GOOGLE_PAY_AUTH_ERROR",c)}}),l)return;o(this,D).send("EV_GOOGLE_PAY_AUTH_COMPLETE")}catch{o(this,D).send("EV_GOOGLE_PAY_AUTH_ERROR",{reason:"PAYMENT_DATA_INVALID",message:"Something went wrong, please try again",intent:"PAYMENT_AUTHORIZATION"})}}),o(this,D).on("EV_GOOGLE_PAY_CANCELLED",()=>{o(this,se).dispatch("cancel")}),o(this,D).on("EV_GOOGLE_PAY_ERROR",a=>{o(this,se).dispatch("error",a)}),o(this,D).on("EV_GOOGLE_PAY_SUCCESS",()=>{o(this,se).dispatch("success")})}get config(){return{config:{transaction:o(this,nt).details,type:o(this,_).type,color:o(this,_).color,locale:o(this,_).locale,borderRadius:o(this,_).borderRadius,allowedAuthMethods:o(this,_).allowedAuthMethods,allowedCardNetworks:o(this,_).allowedCardNetworks,billingAddress:o(this,_).billingAddress,emailRequired:o(this,_).emailRequired}}}mount(e){return o(this,D).mount(e,{...this.config,onError:()=>{o(this,se).dispatch("error")}}),this}unmount(){return o(this,D).unmount(),this}on(e,t){return o(this,se).on(e,t)}}nt=new WeakMap,_=new WeakMap,D=new WeakMap,se=new WeakMap;async function Ds(i,e){const{transaction:t}=e,r=await Ks(i,t.merchantId);if(!r)throw new Error("Merchant not found");let n;return t.type==="payment"?n=Ps(r,e,t):t.type==="recurring"?n=$s(r,e,t):n=js(r,e,t),n.onmerchantvalidation=async s=>{const a=await Gs(i,s.validationURL,t);s.complete(a.sessionData)},n.onshippingaddresschange=s=>{const a=s.target;if(a.shippingAddress)if(e.onShippingAddressChange){const l=Ms(a.shippingAddress,e,t,r);s.updateWith(l)}else{const l={};s.updateWith(l)}},n.onpaymentmethodchange=s=>{const a=s.methodDetails;if(e.onPaymentMethodChange){const l=Hs(a,e,t,r);return s.updateWith(l)}return s.updateWith({})},n}async function Jn(i,e,t){const r=(i.lineItems??[]).map(s=>({label:s.label,amount:{value:(s.amount/100).toFixed(2).toString(),currency:e.currency}})),n={label:e.priceLabel??t.name,amount:{currency:e.currency,value:(i.amount/100).toFixed(2)}};return{displayItems:r,total:n}}async function Ms(i,e,t,r){const n=await e.onShippingAddressChange(i);return Jn(n,t,r)}async function Hs(i,e,t,r){const n=await e.onPaymentMethodChange(i);return Jn(n,t,r)}function Ps(i,e,t){var u,d,h,p,B,k;const r=((u=t.lineItems)==null?void 0:u.map(L=>({label:L.label,amount:{value:(L.amount/100).toFixed(2).toString(),currency:t.currency}})))||[],n=[{supportedMethods:"https://apple.com/apple-pay",data:{version:3,merchantIdentifier:`merchant.com.evervault.${e.transaction.merchantId}`,merchantCapabilities:["supports3DS"],supportedNetworks:((d=e.allowedCardNetworks)==null?void 0:d.map(L=>L.toLowerCase()))||["visa","masterCard","amex","discover"],countryCode:t.country}}],s={total:{label:t.priceLabel??i.name,amount:{currency:t.currency,value:(t.amount/100).toFixed(2)}},displayItems:r},a={requestPayerName:((h=e.requestPayerDetails)==null?void 0:h.includes("name"))??!1,requestBillingAddress:e.requestBillingAddress??!1,requestPayerEmail:((p=e.requestPayerDetails)==null?void 0:p.includes("email"))??!1,requestPayerPhone:((B=e.requestPayerDetails)==null?void 0:B.includes("phone"))??!1,requestPostalAddress:((k=e.requestPayerDetails)==null?void 0:k.includes("postalAddress"))??!1,requestShipping:e.requestShipping??!1,shippingType:"shipping",onShippingAddressChange:e.onShippingAddressChange},l=e.paymentOverrides||{};return new PaymentRequest(l.paymentMethodData||n,l.paymentDetails||s,a)}function $s(i,e,t){var u,d,h,p,B;console.log("Building recurring session");const r=((u=t.lineItems)==null?void 0:u.map(k=>({label:k.label,amount:{value:(k.amount/100).toFixed(2).toString(),currency:t.currency}})))||[],n=[{supportedMethods:"https://apple.com/apple-pay",data:{version:3,merchantIdentifier:`merchant.com.evervault.${e.transaction.merchantId}`,merchantCapabilities:["supports3DS"],supportedNetworks:((d=e.allowedCardNetworks)==null?void 0:d.map(k=>k.toLowerCase()))||["visa","masterCard","amex","discover"],countryCode:t.country}}],s={total:{label:t.priceLabel??i.name,amount:{currency:t.currency,value:(t.amount/100).toFixed(2)}},displayItems:r,modifiers:[{supportedMethods:"https://apple.com/apple-pay",data:{recurringPaymentRequest:{paymentDescription:t.description,regularBilling:{label:t.regularBilling.label,amount:t.regularBilling.amount,paymentTiming:"recurring",recurringPaymentStartDate:t.regularBilling.recurringPaymentStartDate},trialBilling:t.trialBilling?{label:t.trialBilling.label,amount:t.trialBilling.amount,paymentTiming:"recurring",recurringPaymentStartDate:t.trialBilling.trialPaymentStartDate}:void 0,billingAgreement:t.billingAgreement,managementURL:t.managementURL}}}]},a={requestPayerName:((h=e.requestPayerDetails)==null?void 0:h.includes("name"))??!1,requestBillingAddress:e.requestBillingAddress??!1,requestPayerEmail:((p=e.requestPayerDetails)==null?void 0:p.includes("email"))??!1,requestPayerPhone:((B=e.requestPayerDetails)==null?void 0:B.includes("phone"))??!1,requestShipping:e.requestShipping??!1,shippingType:"shipping"},l=e.paymentOverrides||{};return new PaymentRequest(l.paymentMethodData||n,l.paymentDetails||s,a)}function js(i,e,t){var h;const r=((h=t.lineItems)==null?void 0:h.map(p=>({label:p.label,amount:{value:(p.amount/100).toFixed(2).toString(),currency:t.currency}})))||[],n=["supports3DS"];t.instantTransfer&&n.push("supportsInstantFundsOut");const s=[{supportedMethods:"https://apple.com/apple-pay",data:{version:3,merchantIdentifier:`merchant.com.evervault.${e.transaction.merchantId}`,merchantCapabilities:n,supportedNetworks:e.allowedCardNetworks,countryCode:t.country}}];let a=t.amount;t.instantTransfer&&(a=t.amount-t.instantTransfer.amount);const l={total:{label:t.priceLabel??i.name,amount:{value:a.toString(),currency:t.currency}},modifiers:[{supportedMethods:"https://apple.com/apple-pay",data:{disbursementRequest:t.requiredRecipientDetails?{requiredRecipientContactFields:t.requiredRecipientDetails.map(p=>p==="address"?"postalAddress":p)}:{},additionalLineItems:[{label:"Total Amount",amount:t.amount},...r||[],...t.instantTransfer?[{label:t.instantTransfer.label,amount:t.instantTransfer.amount,disbursementLineItemType:"instantFundsOutFee"}]:[],{label:"Apple Pay Demo",amount:a,disbursementLineItemType:"disbursement"}]}}]},c={},u=e.disbursementOverrides||{};return new PaymentRequest(s,u.disbursementDetails||l,c)}async function Gs(i,e,t){const r=i.client.config.appId,n=i.client.config.http.apiUrl;return(await fetch(`${n}/frontend/apple-pay/merchant-session`,{method:"POST",headers:{"Content-Type":"application/json","X-Evervault-App-Id":r},body:JSON.stringify({validationUrl:e,merchantUuid:t.merchantId,domain:t.domain})})).json()}async function Ks(i,e){const t=i.client.config.appId,r=i.client.config.http.apiUrl,n=await fetch(`${r}/frontend/merchants/${e}`,{method:"GET",headers:{"Content-Type":"application/json","X-Evervault-App-Id":t}});if(!n.ok){console.error(`Failed to fetch merchant details for ${e}`,n.status);return}return n.json()}function Ht(i){return typeof i=="number"?`${i}px`:i}async function qn(i){try{return[await i,null]}catch(e){return[null,e]}}const zn="https://applepay.cdn-apple.com/jsapi/1.latest/apple-pay-sdk.js";class Yn{constructor(e,t,r){g(this,Q);S(this,"client");S(this,"transaction");g(this,R,null);g(this,w);g(this,oe,new le);g(this,xe,!1);this.client=e,m(this,w,r),this.transaction=t,y(this,Q,ai).call(this)}on(e,t){return o(this,oe).on(e,t)}async availability(){if(typeof window.PaymentRequest>"u")return"unsupported";await y(this,Q,ui).call(this);const e=await ApplePaySession.applePayCapabilities(`merchant.com.evervault.${this.transaction.details.merchantId}`);return e.paymentCredentialStatus==="applePayUnsupported"?"unsupported":e.paymentCredentialStatus==="paymentCredentialsUnavailable"?"unavailable":"available"}async mount(e){const t=await this.availability();if(t==="unsupported"){console.info("Apple Pay is not supported on this device.");return}t==="unavailable"&&console.info("Apple Pay may be unavailable on this device.");const r=Kn(e);m(this,R,document.createElement("apple-pay-button")),o(this,w).type&&o(this,R).setAttribute("type",o(this,w).type),o(this,w).style&&o(this,R).setAttribute("buttonstyle",o(this,w).style),o(this,w).locale&&o(this,R).setAttribute("locale",o(this,w).locale),o(this,w).padding&&o(this,R).style.setProperty("--apple-pay-button-padding",o(this,w).padding),o(this,w).borderRadius&&o(this,R).style.setProperty("--apple-pay-button-border-radius",Ht(o(this,w).borderRadius)),o(this,w).size&&(o(this,R).style.setProperty("--apple-pay-button-width",Ht(o(this,w).size.width)),o(this,R).style.setProperty("--apple-pay-button-height",Ht(o(this,w).size.height))),o(this,R).addEventListener("click",()=>{y(this,Q,li).call(this)}),r.appendChild(o(this,R))}unmount(){o(this,R)&&o(this,R).remove()}}R=new WeakMap,w=new WeakMap,oe=new WeakMap,xe=new WeakMap,Q=new WeakSet,ai=function(){const e=`script[src="${zn}"]`;if(document.querySelector(e)){m(this,xe,!0);return}const r=document.createElement("script");r.src=zn,r.async=!0,r.crossOrigin="anonymous",r.onload=()=>{m(this,xe,!0)},document.body.appendChild(r)},li=async function(){var c,u,d;if(o(this,w).prepareTransaction){const{amount:h,lineItems:p}=await o(this,w).prepareTransaction();h&&(this.transaction.details.amount=h),p&&(this.transaction.details.lineItems=p)}const e=await Ds(this,{transaction:this.transaction.details,allowedCardNetworks:o(this,w).allowedCardNetworks,requestPayerDetails:o(this,w).requestPayerDetails,paymentOverrides:o(this,w).paymentOverrides,disbursementOverrides:o(this,w).disbursementOverrides,requestBillingAddress:o(this,w).requestBillingAddress,requestShipping:o(this,w).requestShipping,onPaymentMethodChange:o(this,w).onPaymentMethodChange,onShippingAddressChange:o(this,w).onShippingAddressChange,prepareTransaction:o(this,w).prepareTransaction}),[t,r]=await qn(e.show());if(r){if(r.name==="AbortError"){o(this,oe).dispatch("cancel");return}o(this,oe).dispatch("error",r.message);return}const n=(d=(u=(c=t.details)==null?void 0:c.token)==null?void 0:u.paymentMethod)==null?void 0:d.displayName,[s,a]=await qn(y(this,Q,ci).call(this,t));if(a){o(this,oe).dispatch("error",a.message);return}if(t.details.billingContact&&(s.billingContact=t.details.billingContact),t.details.shippingContact&&(s.shippingContact=t.details.shippingContact),s.card.displayName=n,n){const h=/(\d{4})$/,p=n.match(h);p&&(s.card.lastFour=p[0])}let l=!1;await o(this,w).process(s,{fail:h=>{o(this,oe).dispatch("error",h==null?void 0:h.message),l=!0}}),l?await t.complete("fail"):(o(this,oe).dispatch("success"),t.complete("success"))},ci=async function(e){const t={merchantId:this.transaction.details.merchantId,encryptedCredentials:e.details.token.paymentData},r=this.client.config.http.apiUrl;return(await fetch(`${r}/frontend/apple-pay/credentials`,{method:"POST",headers:{"x-Evervault-App-Id":this.client.config.appId,"Content-Type":"application/json"},body:JSON.stringify(t)})).json()},ui=async function(){if(o(this,xe))return;const e=1e4;return new Promise((t,r)=>{const n=Date.now(),s=setInterval(()=>{o(this,xe)&&(clearInterval(s),t(!0)),Date.now()-n>e&&(clearInterval(s),r(new Error("Apple Pay SDK script load timeout")))},100)})};class Js{constructor(e){S(this,"client");S(this,"themes",gs);this.client=e}card(e){return new Ls(this.client,e)}pin(e){return new Is(this.client,e)}reveal(e){return new Ts(this.client,e)}form(e){return new Us(this.client,e)}threeDSecure(e,t){return new Os(this.client,e,t)}googlePay(e,t){return new _s(this.client,e,t)}applePay(e,t){return new Yn(this.client,e,t)}applePayButton(e,t){return new Yn(this.client,e,t)}}class qs{constructor(e){S(this,"details");this.details={...e,type:e.type??"payment",domain:window.location.origin.replace(/https?:\/\//,"")}}}const $t=class $t{constructor(e,t,r={}){S(this,"forms");S(this,"config");S(this,"http");S(this,"input");g(this,it);g(this,st);S(this,"ui");var s;if(!me(e))throw new Ne("teamId must be a string");if(!me(t))throw new Ne("appId must be a string");m(this,it,r.isDebugMode===!0),this.config=qt(e,t,r==null?void 0:r.urls,r==null?void 0:r.publicKey);const n=Sn(((s=window==null?void 0:window.location)==null?void 0:s.origin)??"",this.config.input.inputsOrigin);this.http=Cn(this.config.http,this.config.teamId,this.config.appId,n),this.forms=as(this),this.forms.register(),this.input=cs(this.config),m(this,st,this.loadKeys(r.appKey)),this.ui=new Js(this)}static async init(e,t,r={}){var c;if(!me(e))throw new Ne("teamUuid must be a string");if(!me(t))throw new Ne("appUuid must be a string");const n=qt(e,t,r==null?void 0:r.urls,r==null?void 0:r.publicKey),s=Sn(((c=window==null?void 0:window.location)==null?void 0:c.origin)??"",n.input.inputsOrigin),l=await Cn(n.http,n.teamId,n.appId,s).getCageKey();return new $t(e,t,{...r,appKey:l})}getContext(e,t){return e===t?"inputs":"default"}async loadKeys(e){let t;this.config.encryption.publicKey?t=Vi(this.config.encryption.publicKey):this.isInDebugMode()?t=this.config.debugKey:e?t=e:t=await this.http.getCageKey();const r=await window.crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveBits","deriveKey"]),n=await Zi(r,t.ecdhP256KeyUncompressed,r.publicKey);return new Dt(ht(t.ecdhP256Key),r.publicKey,n,this.config.encryption,this.isInDebugMode())}async encrypt(e,t){return mi(e)?e:(await o(this,st)).encrypt(e,t)}inputs(e,t){return typeof t=="string"?this.input.generate(e,{theme:t}):this.input.generate(e,t??{})}reveal(e,t,r,n){return{isRevealLoaded:this.input.generate(e,{theme:"reveal",...r},!0,t,n).isInputsLoaded}}auto(e=[]){global.oldFetch||(global.oldFetch=global.fetch,global.fetch=async(t,r)=>{const{body:n}=r,s=er(t),a=er(window.location.hostname);if(s===a)try{const l=JSON.parse(n);for(const c of Object.keys(l))(e.length===0||e.includes(c))&&(l[c]=await this.encrypt(l[c]));r.body=JSON.stringify(l)}catch{}return global.oldFetch(t,r)})}decrypt(e,t){return this.http.decryptWithToken(e,t)}isInDebugMode(){return o(this,it)}get transactions(){return{create:e=>new qs(e)}}};it=new WeakMap,st=new WeakMap;let Pt=$t;return Pt});
