;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="d7867724-ea81-d096-07e5-e311913a55fd")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,784640,e=>{"use strict";function t(e,t){return new Promise(function(s,i){var n=setTimeout(function(){i(Error("Promise timed out"))},t);e.then(function(e){return clearTimeout(n),s(e)}).catch(i)})}function s(e,s,i){var n=function(){try{return Promise.resolve(s(e))}catch(e){return Promise.reject(e)}};return new Promise(function(e){return setTimeout(e,i)}).then(function(){return t(n(),1e3)}).catch(function(t){null==e||e.log("warn","Callback Error",{error:t}),null==e||e.stats.increment("callback_error")}).then(function(){return e})}e.s(["invokeCallback",()=>s,"pTimeout",()=>t])},461814,e=>{"use strict";e.s(["default",()=>e_],461814);class t{on(e,t){var s=this[e];s?s.push(t):this[e]=[t]}dispatch(e,t){var s=this[e];s&&s.forEach(e=>e(t))}}function s(e){e_.config.logging&&console.log(`Gist: ${e}`)}var i,n=new Uint8Array(16);let a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var o=[],r=0;r<256;++r)o.push((r+256).toString(16).substr(1));let u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=(o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]).toLowerCase();if(!("string"==typeof s&&a.test(s)))throw TypeError("Stringified UUID is invalid");return s},l=function(e,t,s){var a=(e=e||{}).random||(e.rng||function(){if(!i&&!(i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(n)})();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){s=s||0;for(var o=0;o<16;++o)t[s+o]=a[o];return t}return u(a)},d="gist.web.isPersistingSession";function c(e,t,s=null){var i=s;i||(i=new Date).setDate(i.getDate()+365);let n={value:t,expiry:i};p().setItem(e,JSON.stringify(n))}function g(e){let t=p().getItem(e);if(!t)return null;let s=JSON.parse(t);return new Date().getTime()>new Date(s.expiry).getTime()?(m(e),null):s.value}function m(e){p().removeItem(e)}function f(){let e=sessionStorage.getItem(d);return null===e?(sessionStorage.setItem(d,"true"),!0):"true"===e}function p(){return f()?localStorage:sessionStorage}let h="gist.web.userQueueVersion",v={prod:"https://engine.api.gist.build",dev:"https://engine.api.dev.gist.build",local:"http://engine.api.local.gist.build:82"},w={prod:"https://gist-queue-consumer-api.cloud.gist.build",dev:"https://gist-queue-consumer-api.cloud.dev.gist.build",local:"http://api.local.gist.build:86"},y={prod:"https://consumer.cloud.gist.build",dev:"https://consumer.cloud.dev.gist.build",local:"http://api.local.gist.build:86"},b={prod:"https://renderer.gist.build/3.0",dev:"https://renderer.gist.build/3.0",local:"http://app.local.gist.build:8080/web"},I=function(){return g(h)??"2"},$=function(e){c(h,e,new Date(new Date().getTime()+18e5)),s(`Set user queue version to "${e}"`)};function x(){let e="3"===I()?y[e_.config.env]:w[e_.config.env],t={"X-CIO-Site-Id":e_.config.siteId,"X-CIO-Client-Platform":"web"},s=g(E);async function i(s,n={}){let a=new AbortController,o=setTimeout(()=>a.abort(),5e3);try{let i=await fetch(e+s,{method:n.method||"GET",headers:{...t,...n.headers||{}},body:n.method&&"GET"!==n.method.toUpperCase()?n.body:void 0,signal:a.signal});clearTimeout(o);let r=i.headers.get("content-type")?.includes("application/json")?await i.json():await i.text(),u=Object.fromEntries(i.headers.entries());if(i.status<200||i.status>=400)throw{response:{status:i.status,data:r,headers:u}};return{status:i.status,headers:u,data:r}}catch(e){throw clearTimeout(o),e.response||(e.response={status:0,data:e.message||"Unknown error"}),e}}return null!=s&&(t["X-Gist-Encoded-User-Token"]=btoa(s)),i.post=(e,t={},s={})=>i(e,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json",...s.headers||{}}}),i}let k="gist.web.userLocale";var S=600,C=!1;let T="gist.web.userQueueNextPullCheck",M="gist.web.sessionId";async function D(){var e;try{if(!C){C=!0;var t,i={"X-Gist-User-Anonymous":R(),"Content-Language":null!==g(k)?g(k):navigator.language};if("3"===I()){e=await x().post(`/api/v3/users?sessionId=${((t=g(M))||(t=l()),c(M,t,new Date(new Date().getTime()+18e5)),t)}`,{},{headers:i})}else{var n=new Date().getTime();e=await x().post(`/api/v2/users?timestamp=${n}`,{},{headers:i})}}}catch(t){t.response?e=t.response:s(`Error getting user queue: ${t}`)}finally{C=!1,function(e){if(e&&e.headers){var t=e.headers["x-gist-queue-polling-interval"];t&&t>0&&(S=t)}var s=new Date(new Date().getTime()+1e3*S);c(T,S,s)}(e),function(e){if(e&&e.headers){var t=e.headers["x-cio-queue-version"];t&&$(t)}}(e)}return e}let E="gist.web.userToken",P="gist.web.usingGuestUserToken",q="gist.web.guestUserToken";function R(){return null!==g(P)}function L(){if(null===g(E)){var e=g(q);null==e&&(c(q,e=l()),s(`Set guest user token "${e}" with expiry date set to 1 year from today`)),c(E,e),c(P,!0),s(`Using anonymous session with token: "${e}"`)}}async function A(){var e=g(E);return null===e?null:await _(e)}async function _(e){let t=new TextEncoder().encode(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}async function U(e){try{return await x().post(`/api/v1/logs/queue/${e}`)}catch(e){return e.response}}async function W(e){try{return await x().post(`/api/v1/logs/message/${e}`)}catch(e){return e.response}}function j(e){let t={isEmbedded:!1,elementId:"",hasRouteRule:!1,routeRule:"",position:"",hasPosition:!1,shouldScale:!1,campaignId:null,messageWidth:414,overlayColor:"#00000033",persistent:!1,exitClick:!1,hasCustomWidth:!1},s=e?.properties?.gist;return s?{isEmbedded:!!s.elementId,elementId:s.elementId||"",hasRouteRule:!!s.routeRuleWeb,routeRule:s.routeRuleWeb||"",position:s.position||"",hasPosition:!!s.position,shouldScale:!!s.scale,campaignId:s.campaignId??null,messageWidth:s.messageWidth>0?s.messageWidth:t.messageWidth,hasCustomWidth:s.messageWidth>0,overlayColor:s.overlayColor||t.overlayColor,persistent:!!s.persistent,exitClick:!!s.exitClick}:t}var O=["x-gist-top","x-gist-floating-top","x-gist-bottom","x-gist-floating-bottom","x-gist-floating-bottom-left","x-gist-floating-bottom-right","x-gist-floating-top-left","x-gist-floating-top-right"];let V=["x-gist-top","x-gist-bottom","x-gist-floating-top","x-gist-floating-bottom"];function H(e){var t=J(e);if(t)return t.style&&t.style.height&&"0px"!=t.style.height}function N(e,t){let s=document.getElementById(e);s&&(s.onload=function(){var s,i;let n;s=e,i=t,(n=document.getElementById(s))&&n.contentWindow&&n.contentWindow.postMessage({options:i},"*")})}async function z(){var e=document.querySelector(".gist-message");e&&(e.classList.remove("visible"),await new Promise(e=>setTimeout(e,300))),B()}function B(){var e=document.querySelector("#gist-embed-message");e&&e.parentNode.removeChild(e)}function G(e){return`gist-${e}`}function X(){var e=document.querySelector(".gist-message");e&&e.classList.add("visible")}function J(e){try{var t=document.querySelector(`#${e}`);if(t)return t;return null}catch{return null}}async function Q(e){let t=await et();if(!t)return;let s=new Date;s.setDate(s.getDate()+30),c(t,e.filter(ee),s)}async function K(){let e=await et();return e?(g(e)??[]).filter(t=>{let{broadcast:s}=t.properties.gist,i=g(ei(e,t.queueId))??!0,n=g(es(e,t.queueId))||0,a=0===s.frequency.count;return i&&(a||n<s.frequency.count)}):[]}async function F(e){s(`Marking broadcast ${e} as seen.`);let t=await et();if(!t)return;let i=await Z(t,e);if(!i)return;let{broadcast:n}=i.properties.gist,a=es(t,e),o=ei(t,e),r=g(a)||0;if(c(a,r+1),1===n.frequency.count)c(o,!1),s(`Marked broadcast ${e} as seen.`);else{let t=new Date;t.setSeconds(t.getSeconds()+n.frequency.delay),c(o,!1,t),s(`Marked broadcast ${e} as seen, broadcast was seen ${r+1} times, next show date is ${t}.`)}}async function Y(e){s(`Marking broadcast ${e} as dismissed.`);let t=await et();if(!t)return;let i=await Z(t,e);if(!i)return;let{broadcast:n}=i.properties.gist;!0===n.frequency.ignoreDismiss?s(`Broadcast ${e} is set to ignore dismiss.`):(c(ei(t,e),!1),s(`Marked broadcast ${e} as dismissed and will not show again.`))}async function Z(e,t){return g(e).find(e=>e.queueId===t)}function ee(e){return e.properties&&e.properties.gist&&e.properties.gist.broadcast}async function et(){let e=await A();return e?`gist.web.message.broadcasts.${e}`:null}function es(e,t){return`${e}.${t}.numberOfTimesShown`}function ei(e,t){return`${e}.${t}.shouldShow`}let en="gist.web.message.user";async function ea(e){let t=await eg();t&&c(t,e.filter(e=>!(e.properties&&e.properties.gist&&e.properties.gist.broadcast)),new Date(Date.now()+36e5))}async function eo(){let e=await eg();if(!e)return[];let t=g(e)??[],s=await ec();return t.filter(e=>!s.includes(e.queueId))}async function er(e){let t=await em();if(!t)return;let s=g(t)??[];s.push(e),c(t,s)}async function eu(e){let t=await ef(e);return!!t&&null!==g(t)}async function el(e){let t=await ef(e);if(!t)return!1;c(t,!0,new Date(Date.now()+5e3))}async function ed(e){let t=await ef(e);if(!t)return!1;m(t)}async function ec(){let e=await em();return e?g(e)??[]:[]}async function eg(){let e=await A();return e?`${en}.${e}`:null}async function em(){let e=await A();return e?`${en}.${e}.seen`:null}async function ef(e){let t=await A();return t?`${en}.${t}.message.${e}.loading`:null}async function ep(e){if(!e_.isDocumentVisible)return s("Document hidden, not showing message now."),null;if(e_.overlayInstanceId)return s(`Message ${e_.overlayInstanceId} already showing.`),null;var t=j(e);return e.instanceId=l(),e.overlay=!0,e.firstLoad=!0,e.shouldResizeHeight=!0,e.shouldScale=t.shouldScale,e.renderStartTime=new Date().getTime(),e_.overlayInstanceId=e.instanceId,e_.currentMessages.push(e),eI(e)}async function eh(e,t){return e_.isDocumentVisible?(e.instanceId=l(),e.overlay=!1,e.firstLoad=!0,e.shouldScale=!1,e.elementId=t,e.shouldResizeHeight=!H(t),e.renderStartTime=new Date().getTime(),e_.currentMessages.push(e),eI(e,t)):(s("Document hidden, not showing message now."),null)}async function ev(e){e?(e_.messageDismissed(e),e.overlay?await eb(!0,e):ey(e)):s(`Message with instance id: ${e.instanceId} not found`)}async function ew(e){var t=j(e);e?t.persistent&&(s("Persistent message dismissed, logging view"),await eM(e),await e$(e)):s(`Message with instance id: ${e.instanceId} not found`)}function ey(e){var t;ek(e.instanceId),(t=J(e.elementId))&&(t.classList.remove("gist-visible"),t.style.removeProperty("height"),t.innerHTML="")}async function eb(e,t){ek(t.instanceId),e_.overlayInstanceId=null,e?await z():B(),0==e_.currentMessages.length&&(window.removeEventListener("message",eT),window.removeEventListener("touchstart",eC))}function eI(e,t=null){if(t&&(a=J(t))&&a.classList.contains("gist-visible"))return s(`Message ${e.messageId} already showing in element ${t}.`),null;var i={endpoint:v[e_.config.env],siteId:e_.config.siteId,dataCenter:e_.config.dataCenter,messageId:e.messageId,instanceId:e.instanceId,livePreview:!1,properties:e.properties},n=`${b[e_.config.env]}/index.html`;if(window.addEventListener("message",eT),window.addEventListener("touchstart",eC),t){let d;O.includes(t)&&((d=document.createElement("div")).id=t,"x-gist-top"===t?document.body.insertBefore(d,document.body.firstChild):document.body.insertAdjacentElement("beforeend",d),s("Top & bottom elements injected into page"));var a,o=J(t);if(o){var r=G(e.instanceId);o.classList.add(r);var u=j(e),l=u.messageWidth+"px";V.includes(t)&&!u.hasCustomWidth&&(l="100%"),O.includes(t)&&(o.style.width=l),H(t)||(o.style.height="0px"),o.innerHTML=function(e,t,s){var i,n;return i=G(t.instanceId),n=800,s.messageWidth>n&&(n=s.messageWidth),`
    <div id="gist-embed">
        <style>
            #x-gist-floating-top, #x-gist-floating-top-left, #x-gist-floating-top-right {
                position: fixed;
                top: 0px;
                z-index: 1000000;
            }
            #x-gist-floating-bottom, #x-gist-floating-bottom-left, #x-gist-floating-bottom-right {
                position: fixed;
                bottom: 0px;
                z-index: 1000000;
            }
            #x-gist-bottom, #x-gist-top, #x-gist-floating-top, #x-gist-floating-bottom {
                left: 50%;
                transform: translate(-50%, 0%);
            }
            #x-gist-floating-top-right, #x-gist-floating-bottom-right {
                right: 0px;
            }
            #gist-embed {
                position: relative;
                height: 100%;
                width: 100%;
            }
            #gist-embed-container {
                position: relative;
                height: 100%;
                width: 100%;
            }
            #gist-embed-container .gist-frame {
                height: 100%;
                width: 100%;
                border: none;
            }
            #x-gist-top.${i},
            #x-gist-bottom.${i},
            #x-gist-floating-top.${i},
            #x-gist-floating-bottom.${i},
            #x-gist-floating-top-left.${i},
            #x-gist-floating-top-right.${i},
            #x-gist-floating-bottom-left.${i},
            #x-gist-floating-bottom-right.${i} {
                transition: height 0.1s ease-in-out;
            }
            @media (max-width: ${n}px) {
                #x-gist-top.${i},
                #x-gist-bottom.${i},
                #x-gist-floating-top.${i},
                #x-gist-floating-bottom.${i},
                #x-gist-floating-top-left.${i},
                #x-gist-floating-top-right.${i},
                #x-gist-floating-bottom-left.${i},
                #x-gist-floating-bottom-right.${i} {
                    width: 100% !important;
                }
            }
        </style>
        <div id="gist-embed-container">
            <iframe id="${i}" class="gist-frame" src="${e}"></iframe>
        </div>
    </div>`}(n,e,u),N(r,i)}else s(`Message could not be embedded, elementId ${t} not found.`)}else document.body.insertAdjacentHTML("afterbegin",function(e,t){var s,i,n=j(t);return s=G(t.instanceId),i=600,n.messageWidth>i&&(i=n.messageWidth),`
    <div id="gist-embed-message">
        <style>
            #gist-overlay.background {
                position: fixed;
                z-index: 9999999998;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background-color: ${n.overlayColor};
                visibility: hidden;
            }
            #gist-overlay.background.visible {
                visibility: visible;
            }
            #gist-overlay.background.is-blacked-out {
                display: block;
            }
            .gist-message {
                width: ${n.messageWidth}px;
                position: absolute;
                border: none;
                opacity: 0;
                transition: opacity 0.3s ease-in-out, height 0.1s ease-in-out;
                z-index: 9999999999;
                left: 50%;
                transform: translateX(-50%);
            }
            .gist-message.visible {
                opacity: 1;
                pointer-events: auto;
            }
            .gist-message.center {
                transform: translate(-50%, -50%);
                top: 50%;
            }
            .gist-message.bottom {
                bottom: 0;
            }
            .gist-message.top {
                top: 0;
            }
            @media (max-width: ${i}px) {
                .gist-message {
                    width: 100%;
                }
            }
        </style>
        <div id="gist-overlay" class="background">
            <iframe id="${s}" class="gist-message" src="${e}"></iframe>
        </div>
    </div>`}(n,e)),N(G(e.instanceId),i);return e}async function e$(e){s(`Message shown, logging view for: ${e.messageId}`);var t={};null!=e.queueId?(await eM(e),t=await U(e.queueId)):t=await W(e.messageId),200===t.status?s("Message view logged"):s(`Problem logging message: ${t.status}`)}function ex(e){return e_.currentMessages.find(t=>t.instanceId===e)}function ek(e){e_.currentMessages=e_.currentMessages.filter(t=>t.instanceId!==e)}function eS(e,t){ek(e),e_.currentMessages.push(t)}function eC(){}async function eT(e){if(e.data.gist&&"https://code.gist.build"===e.origin){var t=e.data.gist.instanceId,i=ex(t);if(i){var n,a,o=j(i);switch(e.data.gist.method){case"routeLoaded":var r=(new Date().getTime()-i.renderStartTime)*.001;if(s(`Engine render for message: ${i.messageId} timer elapsed in ${r.toFixed(3)} seconds`),ed(i.queueId),i.currentRoute=e.data.gist.parameters.route,i.firstLoad){if(i.overlay){var u,l=j(i),d=document.querySelector("#gist-overlay");if(d){d.classList.add("visible");var c=document.querySelector(".gist-message");i.position?c.classList.add(i.position):c.classList.add("center"),setTimeout(X,100),l.exitClick&&setTimeout(()=>{var e,t;return e=i.instanceId,void((t=document.querySelector("#gist-overlay"))&&t.addEventListener("click",function(){e_.dismissMessage(e)}))},1e3)}else B()}else(u=J(i.elementId))&&u.classList.add("gist-visible");e_.messageShown(i),o.persistent?s("Persistent message shown, skipping logging view"):await e$(i),i.firstLoad=!1}eS(t,i);break;case"tap":var g=e.data.gist.parameters.action,m=e.data.gist.parameters.name;if(e_.messageAction(i,g,m),e.data.gist.parameters.system&&!o.persistent){await ev(i);break}try{var f=new URL(g);if(f&&"gist:"===f.protocol)switch(f.href.replace("gist://","").split("?")[0]){case"close":await ev(i),await ew(i),await eD(i),await eR();break;case"showMessage":var p=f.searchParams.get("messageId"),h=f.searchParams.get("properties");p&&(h&&(h=JSON.parse(atob(h))),await e_.showMessage({messageId:p,properties:h}));break;case"loadPage":(f=f.href.substring(f.href.indexOf("?url=")+5))&&(f.startsWith("mailto:")||f.startsWith("https://")||f.startsWith("http://")||f.startsWith("/")?window.location.href=f:window.location.href=window.location+f)}}catch{}break;case"routeChanged":i.currentRoute=e.data.gist.parameters.route,i.renderStartTime=new Date().getTime(),eS(t,i),s(`Route changed to: ${i.currentRoute}`);break;case"sizeChanged":s(`Size Changed Width: ${e.data.gist.parameters.width} - Height: ${e.data.gist.parameters.height}`),(!i.elementId||i.shouldResizeHeight)&&function(e,t){var s=J(e.elementId?e.elementId:G(e.instanceId));if(s){var i=s.style;if(t.height>0)if(t.height>window.innerHeight){var n=1-(t.height/window.innerHeight-1);e.shouldScale&&n>=.4?(i.height=`${t.height}px`,i.transform=`translateX(-50%) translateY(-50%) scale(${n})`):i.height=`${window.innerHeight}px`}else i.height=`${t.height}px`}}(i,e.data.gist.parameters);break;case"titleChanged":s(`Overlay title changed to: ${e.data.gist.parameters.title}`),n=e.data.gist.parameters.title,(a=J(G(t)))&&(a.title=n);break;case"eventDispatched":e_.events.dispatch("eventDispatched",{name:e.data.gist.parameters.name,payload:e.data.gist.parameters.payload});break;case"error":case"routeError":e_.messageError(i),e_.overlayInstanceId?eb(!1,i):ey(i)}}}}async function eM(e){s(`Logging user message view locally for: ${e.queueId}`),ee(e)?await F(e.queueId):await er(e.queueId)}async function eD(e){ee(e)&&(s(`Logging broadcast dismissed locally for: ${e.queueId}`),await Y(e.queueId))}var eE=(e,t)=>e().then(new Promise(e=>setTimeout(e,t)).then(()=>eE(e,t))),eP=!1;async function eq(){eP?eR():g(E)?(s("Queue watcher started"),eP=!0,eE(()=>new Promise(()=>eA()),1e3)):s("User token not setup, queue not started.")}async function eR(){var e=await K(),t=await eo(),i=e.concat(t);for(let e of(s(`Messages in local queue: ${i.length}`),i.sort((e,t)=>e.priority-t.priority)))await eL(e)}async function eL(e){var t=j(e);if(t.hasRouteRule){var i=e_.currentRoute;null==i&&(i=new URL(window.location.href).pathname);var n=t.routeRule;if(s(`Verifying route against rule: ${n}`),!new RegExp(n).test(i))return s(`Route ${i} does not match rule.`),!1}if(t.hasPosition&&(e.position=t.position),!t.persistent&&!function(e){if(!ee(e))return!1;let{broadcast:t}=e.properties.gist;return 0===t.frequency.delay&&0===t.frequency.count}(e)&&await eu(e.queueId))return s(`Not showing message with queueId ${e.queueId} because its already loading.`),!1;var a=!1;return(a=t.isEmbedded?await eh(e,t.elementId):await ep(e))&&el(e.queueId),a}async function eA(){if(g(E))if(e_.isDocumentVisible)if(null===g(T)){var e=await D(),t=[];e?(200===e.status||204===e.status?(s("200 response, updating local store."),ea(t=e.data),Q(t)):304===e.status&&s("304 response, using local store."),await eR()):s("There was an error while checking message queue.")}else s("Next queue pull scheduled for later.");else s("Document not visible, skipping queue check.");else s("User token reset, skipping queue check.")}class e_{static async setup(e){this.events=new t,this.config={useAnonymousSession:void 0!==e.useAnonymousSession&&e.useAnonymousSession,siteId:e.siteId,dataCenter:e.dataCenter,env:void 0===e.env?"prod":e.env,logging:void 0!==e.logging&&e.logging,experiments:void 0!==e.experiments&&e.experiments},this.currentMessages=[],this.overlayInstanceId=null,this.currentRoute=null,this.isDocumentVisible=!0,this.config.isPreviewSession=function(){let e=new URLSearchParams(window.location.search).get("cioPreviewId");e&&(sessionStorage.setItem(d,!1),e_.setUserToken(e),s(`Preview mode enabled with user token: ${e}`));return!f()}(),s(`Setup complete on ${this.config.env} environment.`),!this.config.isPreviewSession&&this.config.useAnonymousSession&&L(),await eq(),document.addEventListener("visibilitychange",async()=>{"hidden"===document.visibilityState?this.isDocumentVisible=!1:(this.isDocumentVisible=!0,await eR())},!1)}static async setCurrentRoute(e){this.currentRoute=e,s(`Current route set to: ${e}`),await eR()}static async setUserToken(e,t){if(!this.config.isPreviewSession){var i;void 0===(i=t)&&(i=new Date).setDate(i.getDate()+30),c(E,e,i),R()&&(m(T),m(P)),s(`Set user token "${e}" with expiry date set to ${i}`),await eq()}}static setUserLocale(e){c(k,e),s(`Set user locate to "${e}"`)}static async clearUserToken(){this.config.isPreviewSession||(m(E),s("Cleared user token"),this.config.useAnonymousSession&&L(),await eq())}static async dismissMessage(e){var t=ex(e);await ev(t),await ew(t),await eD(t),await eR()}static async embedMessage(e,t){var s=await eh(e,t);return s?s.instanceId:null}static async showMessage(e){var t=await ep(e);return t?t.instanceId:null}static messageShown(e){s(`Message shown: ${e.messageId}`),this.events.dispatch("messageShown",e)}static messageDismissed(e){null!==e&&(s(`Message dismissed: ${e.messageId}`),this.events.dispatch("messageDismissed",e))}static messageError(e){s(`Message error: ${e.messageId}`),this.events.dispatch("messageError",e)}static messageAction(e,t,i){s(`Message action: ${e.currentRoute}, ${t} with name ${i} on ${e.instanceId}`),this.events.dispatch("messageAction",{message:e,action:t,name:i})}}},351163,(e,t,s)=>{t.exports=e.r(461814).default},835175,e=>{"use strict";var t,s,i,n,a=e.i(274466);(t=i||(i={})).MessageOpened="in-app:message-opened",t.MessageDismissed="in-app:message-dismissed",t.MessageError="in-app:message-error",t.MessageAction="in-app:message-action";var o=Object.values(i);(s=n||(n={})).Metric="Report Delivery Event",s.Content="Report Content Event",s.Opened="opened",s.Clicked="clicked",s.ViewedContent="viewed_content",s.ClickedContent="clicked_content";var r="in_app_content";function u(e,t){return new CustomEvent(e,{detail:t})}var l=e.i(351163);function d(e){var t,s=this,d=!1,c=!1,g=new EventTarget;function m(e){return(0,a.__awaiter)(this,void 0,void 0,function(){return(0,a.__generator)(this,function(t){switch(t.label){case 0:return[4,l.default.clearUserToken()];case 1:return t.sent(),[2,e]}})})}function f(e){return(0,a.__awaiter)(this,void 0,void 0,function(){var s;return(0,a.__generator)(this,function(i){switch(i.label){case 0:if(!d)return[2,e];if(!("string"==typeof(s=t.user().id())&&s.length>0))return[3,2];return[4,l.default.setUserToken(s)];case 1:return i.sent(),[3,4];case 2:return[4,l.default.clearUserToken()];case 3:i.sent(),i.label=4;case 4:return[2,e]}})})}return{name:"Customer.io In-App Plugin",type:"before",version:"0.0.1",isLoaded:function(){return c},load:function(p,h){return(0,a.__awaiter)(s,void 0,void 0,function(){return(0,a.__generator)(this,function(s){switch(s.label){case 0:if(t=h,null==e.siteId||""==e.siteId)return console.error("[Customer.io In-App Plugin] ".concat("siteId is required. Can't initialize.")),[2,p];return[4,l.default.setup({siteId:e.siteId,env:e._env?e._env:"prod",logging:e._logging,useAnonymousSession:e.anonymousInApp})];case 1:return s.sent(),d=!0,[4,f(p)];case 2:return s.sent(),d&&!c&&(t.on("reset",m),e.events&&(o.forEach(function(t){g.addEventListener(t,null==e?void 0:e.events)}),["messageDismissed","messageError"].forEach(function(e){l.default.events.on(e,function(t){var s,n;g.dispatchEvent(u(function(e){switch(e){case"messageShown":return i.MessageOpened;case"messageDismissed":return i.MessageDismissed;case"messageError":return i.MessageError;case"messageAction":return i.MessageAction;default:return""}}(e),{messageId:t.messageId,deliveryId:null==(n=null==(s=t.properties)?void 0:s.gist)?void 0:n.campaignId}))})})),l.default.events.on("messageShown",function(s){var a,o,d,c,m,f,p,h,v=null==(o=null==(a=null==s?void 0:s.properties)?void 0:a.gist)?void 0:o.campaignId;if(e.events&&g.dispatchEvent(u(i.MessageOpened,{messageId:null==s?void 0:s.messageId,deliveryId:v,message:{dismiss:function(){l.default.dismissMessage(null==s?void 0:s.instanceId)}}})),void 0!==v&&""!=v)return void t.track(n.Metric,{deliveryId:v,metric:n.Opened});var w=null==(m=null==(c=null==(d=null==s?void 0:s.properties)?void 0:d.gist)?void 0:c.broadcast)?void 0:m.broadcastIdInt;if(w){var y=null==(h=null==(p=null==(f=null==s?void 0:s.properties)?void 0:f.gist)?void 0:p.broadcast)?void 0:h.templateId;t.track(n.Content,{actionType:n.ViewedContent,contentId:w,templateId:y,contentType:r})}}),l.default.events.on("messageAction",function(s){var a,o,d,c,m,f,p,h,v,w,y,b=null==(d=null==(o=null==(a=null==s?void 0:s.message)?void 0:a.properties)?void 0:o.gist)?void 0:d.campaignId;if(e.events&&g.dispatchEvent(u(i.MessageAction,{messageId:s.message.messageId,deliveryId:b,action:s.action,name:s.name,actionName:s.name,actionValue:s.action,message:{dismiss:function(){l.default.dismissMessage(s.message.instanceId)}}})),"gist://close"!=s.action){if(void 0!==b&&""!=b)return void t.track(n.Metric,{deliveryId:b,metric:n.Clicked,actionName:s.name,actionValue:s.action});var I=null==(p=null==(f=null==(m=null==(c=null==s?void 0:s.message)?void 0:c.properties)?void 0:m.gist)?void 0:f.broadcast)?void 0:p.broadcastIdInt;if(I){var $=null==(y=null==(w=null==(v=null==(h=null==s?void 0:s.message)?void 0:h.properties)?void 0:v.gist)?void 0:w.broadcast)?void 0:y.templateId;t.track(n.Content,{actionType:n.ClickedContent,contentId:I,templateId:$,contentType:r,actionName:s.name,actionValue:s.action})}}}),l.default.events.on("eventDispatched",function(e){var s,i,n;if("analytics:track"==e.name){var a=null==(s=e.payload)?void 0:s.event;if(void 0===a||""==a)return;t.track(a,null==(i=e.payload)?void 0:i.properties,null==(n=e.payload)?void 0:n.options)}})),c=!0,[2,Promise.resolve()]}})})},identify:f,page:function(e){var t,s,i,n,o;return(0,a.__awaiter)(this,void 0,void 0,function(){var r;return(0,a.__generator)(this,function(a){return c&&"string"==typeof(r=null!=(i=null==(s=null==(t=e.event)?void 0:t.properties)?void 0:s.name)?i:null==(o=null==(n=e.event)?void 0:n.properties)?void 0:o.url)&&r.length>0&&l.default.setCurrentRoute(r),[2,e]})})},unload:function(){return(0,a.__awaiter)(s,void 0,void 0,function(){return(0,a.__generator)(this,function(t){return e.events&&o.forEach(function(t){g.removeEventListener(t,null==e?void 0:e.events)}),[2]})})}}}e.s(["InAppPlugin",()=>d],51093),e.i(51093),e.s(["InAppEvents",()=>i,"InAppPlugin",()=>d],835175)},27318,e=>{e.v(t=>Promise.all(["static/chunks/01164b66db3f2707.js"].map(t=>e.l(t))).then(()=>t(647965)))},334734,e=>{e.v(e=>Promise.resolve().then(()=>e(644757)))},7181,e=>{e.v(t=>Promise.all(["static/chunks/9da0aedac5694cc5.js"].map(t=>e.l(t))).then(()=>t(438699)))},988217,e=>{e.v(t=>Promise.all(["static/chunks/2d0e8bc0904ff8dd.js"].map(t=>e.l(t))).then(()=>t(217955)))},817598,e=>{e.v(t=>Promise.all(["static/chunks/58a5bef7891c54b5.js"].map(t=>e.l(t))).then(()=>t(510725)))},125363,e=>{e.v(t=>Promise.all(["static/chunks/3de0ddf1e4339f6c.js"].map(t=>e.l(t))).then(()=>t(909036)))},871072,e=>{e.v(t=>Promise.all(["static/chunks/55af734218332674.js"].map(t=>e.l(t))).then(()=>t(346542)))},899859,e=>{e.v(e=>Promise.resolve().then(()=>e(835175)))},280869,e=>{e.v(t=>Promise.all(["static/chunks/92e072eaa864d240.js"].map(t=>e.l(t))).then(()=>t(866870)))}]);

//# debugId=d7867724-ea81-d096-07e5-e311913a55fd
//# sourceMappingURL=9dd740be4d1a3c00.js.map