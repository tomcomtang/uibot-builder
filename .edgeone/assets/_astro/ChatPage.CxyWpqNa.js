import{r as y}from"./index.WFquGv8Z.js";var M={exports:{}},S={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var k;function R(){if(k)return S;k=1;var l=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(a,t,o){var s=null;if(o!==void 0&&(s=""+o),t.key!==void 0&&(s=""+t.key),"key"in t){o={};for(var r in t)r!=="key"&&(o[r]=t[r])}else o=t;return t=o.ref,{$$typeof:l,type:a,key:s,ref:t!==void 0?t:null,props:o}}return S.Fragment=e,S.jsx=n,S.jsxs=n,S}var $;function U(){return $||($=1,M.exports=R()),M.exports}var b=U();function D(){const[l,e]=y.useState([]),[n,a]=y.useState("ready"),t=y.useRef(null),o=y.useCallback(async s=>{if(!s.text.trim())return;const r={id:`user-${Date.now()}`,role:"user",content:s.text,parts:[{type:"text",text:s.text}]};e(d=>[...d,r]),a("submitted");const i=`assistant-${Date.now()}`,c={id:i,role:"assistant",content:"",parts:[]};e(d=>[...d,c]),a("streaming");const u=new AbortController;t.current=u;try{const d=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[...l,r].map(p=>({id:p.id,role:p.role,parts:p.parts||[{type:"text",text:p.content}]}))}),signal:u.signal});if(!d.ok){let p=`HTTP error! status: ${d.status}`;try{const x=await d.json();p=x.message||x.error||p,x.details?.suggestion&&(p+=`

${x.details.suggestion}`)}catch{try{const C=await d.text();C&&(p=C)}catch{}}const v=new Error(p);throw v.status=d.status,v}if(!d.body)throw new Error("No response body");const g=d.body.getReader(),f=new TextDecoder;let h="",m="";for(;;){const{done:p,value:v}=await g.read();if(p)break;h+=f.decode(v,{stream:!0});const x=h.split(`
`);h=x.pop()||"";for(const C of x){if(!C.trim())continue;const N=C.indexOf(":");if(N!==-1)try{const E=JSON.parse(C.slice(N+1));E.type==="text-delta"&&E.textDelta?(m+=E.textDelta,e(A=>A.map(w=>w.id===i?{...w,content:m,parts:[{type:"text",text:m}]}:w))):E.type==="text"&&(E.text&&(m=E.text),e(A=>A.map(w=>w.id===i?{...w,content:m,parts:[{type:"text",text:m}]}:w)))}catch(E){console.warn("‚ö†Ô∏è Failed to parse stream chunk:",E,"Line:",C.substring(0,100))}}}a("ready")}catch(d){if(d.name==="AbortError"){a("ready");return}console.error("‚ùå Chat error:",d),e(g=>g.map(f=>f.id===i?{...f,content:`Error: ${d.message||"Failed to get response"}`,parts:[{type:"text",text:`Error: ${d.message||"Failed to get response"}`}]}:f)),a("ready")}finally{t.current=null}},[l]);return{messages:l.map(s=>({...s,parts:s.parts||[{type:"text",text:s.content}]})),status:n,sendMessage:o,isLoading:n==="streaming"||n==="submitted"}}class T{dataModels;constructor(e){this.dataModels=e}resolveValue(e,n){if(e)return typeof e=="string"?e:e.literalString!==void 0?e.literalString:e.literalNumber!==void 0?e.literalNumber:e.literalBoolean!==void 0?e.literalBoolean:e.literalStringList!==void 0?e.literalStringList:e.path!==void 0&&n?this.resolveDataBinding(e.path,n):e}resolveDataBinding(e,n){const a=this.dataModels.get(n);if(!a)return`[Data: ${e}]`;const t=e.replace(/^\//,"").split("/");let o=a;for(const s of t)if(o&&typeof o=="object")o=o[s];else return`[Data: ${e}]`;return o}setBindingValue(e,n,a){const t=this.dataModels.get(a);if(!t)return;const o=e.replace(/^\//,"").split("/");let s=t;for(let r=0;r<o.length-1;r++)s[o[r]]||(s[o[r]]={}),s=s[o[r]];s[o[o.length-1]]=n}}function j(l,e,n,a){const t=document.createElement("div");t.className="a2ui-text",t.setAttribute("data-component-id",l),e.text&&typeof e.text=="object"&&e.text.path&&(t.dataset.bindingTextPath=e.text.path);const o=a.resolveValue(e.text,n);t.textContent=(o??"").toString();const s=r=>{switch(r){case"h1":return"text-extraLarge";case"h2":return"text-large";case"h3":return"text-h3";case"h4":return"text-h4";case"h5":return"text-h5";case"body":return"text-medium";case"caption":return"text-small";default:return`text-${r}`}};if(e.variant){const r=s(e.variant);r&&t.classList.add(r)}else e.usageHint&&t.classList.add(`text-${e.usageHint}`);return e.style&&Object.entries(e.style).forEach(([r,i])=>{typeof i=="string"&&t.style.setProperty(r,i)}),t}function I(l=512,e=320){return"/image-404-placeholder.svg"}function H(l,e,n,a){const t=document.createElement("img");t.className="a2ui-image",t.setAttribute("data-component-id",l),e.url&&typeof e.url=="object"&&e.url.path&&(t.dataset.bindingUrlPath=e.url.path);const o=a.resolveValue(e.url,n);return o?(console.log(`üñºÔ∏è Loading image for component ${l}:`,o),t.src=o):console.warn(`‚ö†Ô∏è No URL found for image component ${l}`),e.usageHint&&t.classList.add(`image-${e.usageHint}`),e.fit&&(t.style.objectFit=e.fit),t.addEventListener("error",()=>{console.error(`‚ùå Image load failed for component ${l}, URL:`,t.src);const s=I(512,320);t.src=s,t.alt="Image not found (404)",!t.style.width&&!t.style.height&&(t.style.width="512px",t.style.height="320px",t.style.objectFit="contain")}),t}function V(l,e,n,a,t,o){const s=document.createElement("button");s.className="a2ui-button",s.setAttribute("data-component-id",l),e.primary&&s.classList.add("button-primary");const r=[];return e.children&&Array.isArray(e.children)?r.push(...e.children):e.child&&r.push(e.child),r.length>0&&(s.dataset.buttonChildren=JSON.stringify(r)),r.forEach(i=>{const c=n.get(i);c&&s.appendChild(c)}),e.action&&s.addEventListener("click",()=>{const i=s.dataset.listItemData;let c={...e.action};if(i)try{const p=JSON.parse(i);console.log("üì¶ Found List item data for button:",p),c.context?c.context={...p,...c.context}:c.context=p,console.log("üîò Final action with merged context:",c)}catch(p){console.error("‚ùå Failed to parse list item data:",p)}const u=s.closest("[data-surface-id]"),d=o||u?.getAttribute("data-surface-id")||"main",g=l,f=new Date().toISOString(),h={};if(c.context)for(const[p,v]of Object.entries(c.context))v&&typeof v=="object"&&!Array.isArray(v)&&"path"in v&&t&&d?(h[p]=t.resolveValue(v,d),console.log(`üîó Resolved context[${p}] from path ${v.path}:`,h[p])):h[p]=v;const m={action:{name:c.name,surfaceId:d,sourceComponentId:g,timestamp:f,context:h}};console.log("üì§ A2UI standard action message:",JSON.stringify(m,null,2)),a(m)}),s}function P(l,e){const n=l.dataset.buttonChildren;if(n)try{JSON.parse(n).forEach(t=>{const o=e.get(t);o&&!l.contains(o)&&(l.appendChild(o),console.log(`üîó Attached ${t} to button ${l.getAttribute("data-component-id")}`))})}catch(a){console.error("Failed to parse button children IDs:",a)}}function F(l,e){const n=document.createElement("div");return n.className="a2ui-card",n.setAttribute("data-component-id",l),n}function O(l,e){const n=document.createElement("div");if(n.className="a2ui-row",n.setAttribute("data-component-id",l),e.justify){const a=e.justify,o={start:"align-start",center:"align-center",end:"align-end",spaceBetween:"align-spaceBetween",spaceAround:"align-spaceAround",spaceEvenly:"align-spaceAround",stretch:"align-start"}[a];o&&n.classList.add(o)}if(e.align){const a=e.align,o={start:"align-start",center:"align-center",end:"align-end",stretch:"align-start"}[a];o&&n.classList.add(o)}return e.alignment&&n.classList.add(`align-${e.alignment}`),n}function B(l,e){const n=document.createElement("div");if(n.className="a2ui-column",n.setAttribute("data-component-id",l),e.justify){const a=e.justify,o={start:"align-start",center:"align-center",end:"align-end",spaceBetween:"align-spaceBetween",spaceAround:"align-spaceAround",spaceEvenly:"align-spaceAround",stretch:"align-start"}[a];o&&n.classList.add(o)}if(e.align){const a=e.align,o={start:"align-start",center:"align-center",end:"align-end",stretch:"align-start"}[a];o&&n.classList.add(o)}return e.alignment&&n.classList.add(`align-${e.alignment}`),n}function J(l,e,n){const a=document.createElement("div");if(a.className="a2ui-list",a.setAttribute("data-component-id",l),e.direction&&a.classList.add(`list-${e.direction}`),e.children&&!Array.isArray(e.children)){const t=e.children;t.componentId&&t.path&&(a.dataset.bindingListPath=t.path,a.dataset.templateComponentId=t.componentId)}return a}function _(l,e){const n=document.createElement("hr");return n.className="a2ui-divider",n.setAttribute("data-component-id",l),e.axis==="vertical"&&n.classList.add("divider-vertical"),n}function W(l,e,n,a){const t=document.createElement("div");t.className="a2ui-icon",t.setAttribute("data-component-id",l),e.name&&typeof e.name=="object"&&e.name.path&&(t.dataset.bindingIconNamePath=e.name.path);const o=a.resolveValue(e.name,n);return o&&(t.textContent=o,t.setAttribute("data-icon-name",o.toString())),t}function z(l){const e=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/,/youtube\.com\/watch\?.*v=([^&\n?#]+)/];for(const n of e){const a=l.match(n);if(a&&a[1])return a[1]}return null}function q(l){return/youtube\.com|youtu\.be/.test(l)}function Y(l){const e=z(l);return e?`https://www.youtube.com/embed/${e}`:l}function G(l,e,n,a){const t=a.resolveValue(e.url,n);if(!t){console.warn(`‚ö†Ô∏è No URL found for video component ${l}`);const r=document.createElement("div");return r.className="a2ui-video-error",r.textContent="No video URL provided",r}const o=String(t);if(console.log(`üé• Loading video for component ${l}:`,o),q(o)){const r=Y(o);console.log("üì∫ YouTube video detected, converting to embed URL:",r);const i=document.createElement("div");i.className="a2ui-video-container a2ui-video-youtube",i.setAttribute("data-component-id",l),e.url&&typeof e.url=="object"&&e.url.path&&(i.dataset.bindingUrlPath=e.url.path);const c=document.createElement("iframe");return c.className="a2ui-video-iframe",c.src=r,c.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",c.allowFullscreen=!0,c.setAttribute("frameborder","0"),c.style.width="100%",c.style.height="100%",c.style.minHeight="400px",c.style.borderRadius="12px",i.appendChild(c),i}const s=document.createElement("video");return s.className="a2ui-video",s.setAttribute("data-component-id",l),s.controls=!0,e.url&&typeof e.url=="object"&&e.url.path&&(s.dataset.bindingUrlPath=e.url.path),s.src=o,s.addEventListener("error",()=>{console.error(`‚ùå Video load failed for component ${l}, URL:`,s.src)}),s}function Z(l,e,n,a){const t=document.createElement("div");t.className="a2ui-audio-container",t.setAttribute("data-component-id",l);const o=document.createElement("audio");o.className="a2ui-audio",o.controls=!0,e.url&&typeof e.url=="object"&&e.url.path&&(o.dataset.bindingUrlPath=e.url.path);const s=a.resolveValue(e.url,n);if(s?(console.log(`üéµ Loading audio for component ${l}:`,s),o.src=s):console.warn(`‚ö†Ô∏è No URL found for audio component ${l}`),e.description){const r=a.resolveValue(e.description,n);if(r){const i=document.createElement("div");i.className="a2ui-audio-description",i.textContent=String(r),t.appendChild(i)}}return t.appendChild(o),o.addEventListener("error",()=>{console.error(`‚ùå Audio load failed for component ${l}, URL:`,o.src)}),t}function Q(l,e,n,a){const t=document.createElement("div");t.className="a2ui-textfield-container",t.setAttribute("data-component-id",l);const o=a.resolveValue(e.label,n);if(o){const i=document.createElement("label");i.className="a2ui-textfield-label",i.textContent=String(o),t.appendChild(i)}const s=document.createElement(e.variant==="longText"?"textarea":"input");s.className="a2ui-textfield-input",e.value&&typeof e.value=="object"&&e.value.path&&(s.dataset.bindingValuePath=e.value.path);const r=a.resolveValue(e.value,n);return r!=null&&(s instanceof HTMLInputElement||s instanceof HTMLTextAreaElement)&&(s.value=String(r)),s instanceof HTMLInputElement&&(e.variant==="number"?s.type="number":e.variant==="obscured"?s.type="password":s.type="text"),s.addEventListener("input",()=>{console.log(`TextField ${l} value changed:`,s.value)}),t.appendChild(s),t}function X(l,e,n,a){const t=document.createElement("div");t.className="a2ui-checkbox-container",t.setAttribute("data-component-id",l);const o=document.createElement("input");o.type="checkbox",o.className="a2ui-checkbox-input",e.value&&typeof e.value=="object"&&e.value.path&&(o.dataset.bindingValuePath=e.value.path);const s=a.resolveValue(e.value,n);typeof s=="boolean"&&(o.checked=s);const r=a.resolveValue(e.label,n);if(r){const i=document.createElement("label");i.className="a2ui-checkbox-label",i.textContent=String(r),i.appendChild(o),t.appendChild(i)}else t.appendChild(o);return o.addEventListener("change",()=>{console.log(`CheckBox ${l} value changed:`,o.checked)}),t}function K(l,e,n,a){const t=document.createElement("div");t.className="a2ui-slider-container",t.setAttribute("data-component-id",l);const o=a.resolveValue(e.label,n);if(o){const u=document.createElement("div");u.className="a2ui-slider-label",u.textContent=String(o),t.appendChild(u)}const s=document.createElement("div");s.style.display="flex",s.style.alignItems="center",s.style.gap="14px",s.style.width="100%";const r=document.createElement("input");r.type="range",r.className="a2ui-slider-input",r.min=String(e.min??0),r.max=String(e.max??100),e.value&&typeof e.value=="object"&&e.value.path&&(r.dataset.bindingValuePath=e.value.path);const i=a.resolveValue(e.value,n);i!=null&&(r.value=String(i));const c=document.createElement("span");return c.className="a2ui-slider-value",c.textContent=r.value,r.addEventListener("input",()=>{c.textContent=r.value,console.log(`Slider ${l} value changed:`,r.value)}),s.appendChild(r),s.appendChild(c),t.appendChild(s),t}function ee(l,e,n,a){const t=document.createElement("div");t.className="a2ui-datetime-container",t.setAttribute("data-component-id",l);const o=e.enableDate!==!1,s=e.enableTime!==!1;e.value&&typeof e.value=="object"&&e.value.path&&(t.dataset.bindingValuePath=e.value.path);const r=a.resolveValue(e.value,n);if(o&&s){const c=document.createElement("input");c.type="datetime-local",c.className="a2ui-datetime-input",r&&(c.value=String(r)),t.appendChild(c)}else if(o){const c=document.createElement("input");c.type="date",c.className="a2ui-datetime-input",r&&(c.value=String(r)),t.appendChild(c)}else if(s){const c=document.createElement("input");c.type="time",c.className="a2ui-datetime-input",r&&(c.value=String(r)),t.appendChild(c)}const i=t.querySelector("input");return i&&i.addEventListener("change",()=>{console.log(`DateTimeInput ${l} value changed:`,i.value)}),t}function te(l,e,n,a){const t=document.createElement("div");t.className="a2ui-choicepicker-container",t.setAttribute("data-component-id",l);const o=a.resolveValue(e.label,n);if(o){const d=document.createElement("div");d.className="a2ui-choicepicker-label",d.textContent=String(o),t.appendChild(d)}const r=(e.variant||"mutuallyExclusive")==="multipleSelection";e.value&&typeof e.value=="object"&&e.value.path&&(t.dataset.bindingValuePath=e.value.path);const i=a.resolveValue(e.value,n),c=new Set(Array.isArray(i)?i:[]);return(e.options||[]).forEach(d=>{const g=a.resolveValue(d.label,n),f=d.value,h=document.createElement("div");h.className="a2ui-choicepicker-option";const m=document.createElement("input");m.type=r?"checkbox":"radio",r||(m.name=`choicepicker-${l}`),m.value=f,m.checked=c.has(f);const p=document.createElement("label");p.className="a2ui-choicepicker-option-label",p.textContent=String(g||f),p.appendChild(m),h.appendChild(p),t.appendChild(h),m.addEventListener("change",()=>{console.log(`ChoicePicker ${l} value changed:`,f,m.checked)})}),t}const ne=()=>new Promise((l,e)=>{if(window.Chart){l();return}const n=document.createElement("script");n.src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js",n.onload=()=>l(),n.onerror=()=>e(new Error("Failed to load Chart.js")),document.head.appendChild(n)});async function ae(l,e,n,a){const t=document.createElement("div");t.className="a2ui-chart-container",t.setAttribute("data-component-id",l);try{await ne()}catch(h){console.error("‚ùå Failed to load Chart.js:",h);const m=document.createElement("div");return m.className="a2ui-chart-error",m.textContent="Failed to load chart library",t.appendChild(m),t}const o=window.Chart;if(!o){console.error("‚ùå Chart.js not available");const h=document.createElement("div");return h.className="a2ui-chart-error",h.textContent="Chart library not available",t.appendChild(h),t}const s=document.createElement("canvas");s.className="a2ui-chart-canvas",t.appendChild(s);const r=e.type||"bar",i=a.resolveValue(e.title,n),c=a.resolveValue(e.xLabel,n),u=a.resolveValue(e.yLabel,n),d=e.data||[];let g,f;if(r==="pie"||r==="doughnut")g={labels:d.map(h=>h.label||h.x||""),datasets:[{data:d.map(h=>h.value||h.y||0),backgroundColor:["rgba(102, 51, 238, 0.8)","rgba(59, 130, 246, 0.8)","rgba(16, 185, 129, 0.8)","rgba(245, 158, 11, 0.8)","rgba(239, 68, 68, 0.8)","rgba(139, 92, 246, 0.8)","rgba(236, 72, 153, 0.8)","rgba(14, 165, 233, 0.8)"],borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1}]},f={responsive:!0,maintainAspectRatio:!0,plugins:{legend:{position:"bottom",labels:{color:"rgba(255, 255, 255, 0.9)",padding:15,font:{size:12}}},title:i?{display:!0,text:String(i),color:"rgba(255, 255, 255, 0.9)",font:{size:16,weight:"bold"},padding:{bottom:20}}:void 0}};else if(r==="radar"||r==="polarArea")g={labels:d.map(h=>h.label||h.x||""),datasets:[{label:i?String(i):"Data",data:d.map(h=>h.value||h.y||0),backgroundColor:"rgba(102, 51, 238, 0.2)",borderColor:"rgba(102, 51, 238, 0.8)",borderWidth:2,pointBackgroundColor:"rgba(102, 51, 238, 0.8)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgba(102, 51, 238, 0.8)"}]},f={responsive:!0,maintainAspectRatio:!0,plugins:{legend:{position:"bottom",labels:{color:"rgba(255, 255, 255, 0.9)"}}},scales:r==="radar"?{r:{beginAtZero:!0,ticks:{color:"rgba(255, 255, 255, 0.7)"},grid:{color:"rgba(255, 255, 255, 0.1)"},pointLabels:{color:"rgba(255, 255, 255, 0.9)"}}}:void 0};else{const h=d.map(p=>p.x||p.label||""),m=d.map(p=>p.y||p.value||0);g={labels:h,datasets:[{label:i?String(i):"Data",data:m,backgroundColor:r==="bar"?"rgba(102, 51, 238, 0.8)":"rgba(102, 51, 238, 0.1)",borderColor:"rgba(102, 51, 238, 0.8)",borderWidth:2,fill:r==="line",tension:r==="line"?.4:0,pointBackgroundColor:"rgba(102, 51, 238, 0.8)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgba(102, 51, 238, 0.8)"}]},f={responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!!i,position:"top",labels:{color:"rgba(255, 255, 255, 0.9)"}},title:i?{display:!0,text:String(i),color:"rgba(255, 255, 255, 0.9)",font:{size:16,weight:"bold"},padding:{bottom:20}}:void 0},scales:{x:{title:{display:!!c,text:c?String(c):"",color:"rgba(255, 255, 255, 0.7)"},ticks:{color:"rgba(255, 255, 255, 0.7)"},grid:{color:"rgba(255, 255, 255, 0.1)"}},y:{beginAtZero:!0,title:{display:!!u,text:u?String(u):"",color:"rgba(255, 255, 255, 0.7)"},ticks:{color:"rgba(255, 255, 255, 0.7)"},grid:{color:"rgba(255, 255, 255, 0.1)"}}}}}try{const h=new o(s,{type:r,data:g,options:f});t.chartInstance=h,console.log(`üìä Chart created: ${l} (${r})`)}catch(h){console.error(`‚ùå Failed to create chart ${l}:`,h);const m=document.createElement("div");m.className="a2ui-chart-error",m.textContent=`Chart error: ${h?.message||h}`,t.innerHTML="",t.appendChild(m)}return t}class re{propertyResolver;componentElements;actionHandler;constructor(e,n,a){this.propertyResolver=e,this.componentElements=n,this.actionHandler=a}createComponent(e,n){const{id:a,component:t,weight:o,...s}=e;let r;switch(t){case"Text":r=j(a,s,n,this.propertyResolver);break;case"Image":r=H(a,s,n,this.propertyResolver);break;case"Button":r=V(a,s,this.componentElements,this.actionHandler,this.propertyResolver,n);break;case"Card":r=F(a);break;case"Row":r=O(a,s);break;case"Column":r=B(a,s);break;case"List":r=J(a,s);break;case"Divider":r=_(a,s);break;case"Icon":r=W(a,s,n,this.propertyResolver);break;case"Video":r=G(a,s,n,this.propertyResolver);break;case"AudioPlayer":r=Z(a,s,n,this.propertyResolver);break;case"TextField":r=Q(a,s,n,this.propertyResolver);break;case"CheckBox":r=X(a,s,n,this.propertyResolver);break;case"Slider":r=K(a,s,n,this.propertyResolver);break;case"DateTimeInput":r=ee(a,s,n,this.propertyResolver);break;case"ChoicePicker":r=te(a,s,n,this.propertyResolver);break;case"Chart":r=document.createElement("div"),r.className="a2ui-chart-loading",r.textContent="Loading chart...",ae(a,s,n,this.propertyResolver).then(i=>{r.replaceWith(i),this.componentElements.set(a,i)}).catch(i=>{console.error(`‚ùå Failed to create chart ${a}:`,i),r.className="a2ui-chart-error",r.textContent=`Chart error: ${i}`});break;default:console.warn(`Unknown component type: ${t}`),r=j(a,{text:`Unknown component: ${t}`},n,this.propertyResolver)}return o!==void 0&&(r.style.flexGrow=o.toString()),r}}class oe{container;surfaces;dataModels;componentElements;rootComponents;componentFactory;propertyResolver;constructor(e,n,a,t,o,s,r){this.container=e,this.surfaces=n,this.dataModels=a,this.componentElements=t,this.rootComponents=o,this.componentFactory=s,this.propertyResolver=r}handleCreateSurface(e){const{surfaceId:n,catalogId:a}=e,t=document.createElement("div");t.className="a2ui-surface",t.setAttribute("data-surface-id",n),t.setAttribute("data-catalog-id",a),this.container.appendChild(t),this.surfaces.set(n,t),this.dataModels.has(n)||this.dataModels.set(n,{}),console.log(`‚úÖ Created surface: ${n} with catalog: ${a}`)}handleUpdateComponents(e){const{surfaceId:n,components:a}=e,t=this.surfaces.get(n);if(!t){console.error(`‚ùå Surface not found: ${n}`);return}this.clearSurfaceComponents(n);const o=[];if(a.forEach(r=>{r.component==="Button"&&r.children&&Array.isArray(r.children)&&r.children.forEach((i,c)=>{typeof i=="object"&&i.id&&i.component&&(console.log(`üîß Found inline component in Button ${r.id}:`,i),o.push(i),r.children[c]=i.id)})}),o.length>0&&(a.push(...o),console.log(`üì¶ Added ${o.length} inline components from Button children`)),a.forEach(r=>{try{const i=this.componentFactory.createComponent(r,n);this.componentElements.set(r.id,i),console.log(`‚úÖ Created component: ${r.id} (${r.component})`)}catch(i){console.error(`‚ùå Failed to create component ${r.id}:`,i)}}),a.forEach(r=>{const i=this.componentElements.get(r.id);i&&r.children&&Array.isArray(r.children)&&r.children.forEach(c=>{const u=this.componentElements.get(c);u?r.component==="Button"||(i.appendChild(u),console.log(`üîó Connected ${c} to parent ${r.id}`)):console.warn(`‚ö†Ô∏è Child component not found: ${c}`)})}),a.forEach(r=>{if(r.component==="Button"){const i=this.componentElements.get(r.id);i&&P(i,this.componentElements)}}),a.find(r=>r.id==="root")){const r=this.componentElements.get("root");r&&(t.appendChild(r),this.rootComponents.set(n,"root"),console.log(`üå≥ Added root component to surface: ${n}`))}else a.forEach(r=>{if(!a.some(c=>c.children&&Array.isArray(c.children)&&c.children.includes(r.id))){const c=this.componentElements.get(r.id);c&&(t.appendChild(c),console.log(`üå± Added top-level component: ${r.id}`))}});console.log(`‚úÖ Updated ${a.length} components for surface: ${n}`)}handleUpdateDataModel(e){const{surfaceId:n,updates:a,versions:t}=e;let o=this.dataModels.get(n);o||(o={},this.dataModels.set(n,o)),a.forEach(s=>{try{this.applyDataUpdate(o,s)}catch(r){console.error(`‚ùå Failed to apply data update at ${s.path}:`,r)}}),this.storeVersionVector(n,t),this.updateComponentsWithData(n),console.log(`‚úÖ Updated data model for surface: ${n} (${a.length} updates)`)}handleDeleteSurface(e){const{surfaceId:n}=e,a=this.surfaces.get(n);a&&(a.remove(),this.surfaces.delete(n)),this.dataModels.delete(n),this.rootComponents.delete(n),this.componentElements.forEach((t,o)=>{t&&t.closest&&t.closest(`[data-surface-id="${n}"]`)&&this.componentElements.delete(o)}),console.log(`‚úÖ Deleted surface: ${n}`)}handleBeginRendering(e){console.warn("‚ö†Ô∏è beginRendering is deprecated, use createSurface instead"),this.handleCreateSurface({surfaceId:e.surfaceId,catalogId:"legacy-catalog"})}handleSurfaceUpdate(e){console.warn("‚ö†Ô∏è surfaceUpdate is deprecated, use updateComponents instead"),this.handleUpdateComponents({surfaceId:e.surfaceId,components:e.components})}clearSurfaceComponents(e){const n=this.surfaces.get(e);n&&(n.innerHTML=""),this.componentElements.forEach((a,t)=>{a&&a.closest&&a.closest(`[data-surface-id="${e}"]`)&&this.componentElements.delete(t)})}applyDataUpdate(e,n){const{path:a,value:t,hlc:o,pos:s}=n,r=a.split("/").filter(Boolean);let i=e;for(let u=0;u<r.length-1;u++){const d=r[u];d in i||(i[d]={}),i=i[d]}const c=r[r.length-1];t===null?delete i[c]:i[c]=t,o&&(i[`__hlc_${c}`]=o),s&&(i[`__pos_${c}`]=s)}storeVersionVector(e,n){const a=this.dataModels.get(e);a&&(a.__versions=n)}updateComponentsWithData(e){const n=this.surfaces.get(e);if(!n){console.warn(`‚ö†Ô∏è Cannot update components with data, surface not found: ${e}`);return}if(!this.dataModels.get(e)){console.warn(`‚ö†Ô∏è No data model found for surface: ${e}`);return}console.log(`üîÑ Updating data-bound components for surface: ${e}`),n.querySelectorAll("[data-binding-text-path]").forEach(i=>{const c=i.dataset.bindingTextPath;if(c)try{const u=this.propertyResolver.resolveValue({path:c},e);i.textContent=(u??"").toString()}catch(u){console.error(`‚ùå Failed to update text binding for path ${c}:`,u)}}),n.querySelectorAll("[data-binding-url-path]").forEach(i=>{const c=i.dataset.bindingUrlPath;if(c)try{const u=this.propertyResolver.resolveValue({path:c},e);typeof u=="string"&&(i.src=u)}catch(u){console.error(`‚ùå Failed to update image url binding for path ${c}:`,u)}}),n.querySelectorAll("[data-binding-icon-name-path]").forEach(i=>{const c=i.dataset.bindingIconNamePath;if(c)try{const u=this.propertyResolver.resolveValue({path:c},e);typeof u=="string"&&(i.classList.forEach(d=>{d.startsWith("icon-")&&i.classList.remove(d)}),i.classList.add(`icon-${u}`))}catch(u){console.error(`‚ùå Failed to update icon name binding for path ${c}:`,u)}}),n.querySelectorAll("[data-binding-list-path][data-template-component-id]").forEach(i=>{const c=i.dataset.bindingListPath,u=i.dataset.templateComponentId;if(!c||!u)return;const d=this.componentElements.get(u);if(!d){console.warn(`‚ö†Ô∏è Template component not found for List: ${u}`);return}const g=this.propertyResolver.resolveValue({path:c},e);Array.isArray(g)&&(i.innerHTML="",g.forEach((f,h)=>{const m=d.cloneNode(!0);m.setAttribute("data-template-index",h.toString()),m.setAttribute("data-list-item",JSON.stringify(f)),m.querySelectorAll("[data-component-id]").forEach(v=>{v.classList.contains("a2ui-button")&&(v.dataset.listItemData=JSON.stringify(f),console.log(`üì¶ Injected item data into button at index ${h}:`,f))}),i.appendChild(m)}))})}}class L{container;surfaces=new Map;dataModels=new Map;componentElements=new Map;rootComponents=new Map;propertyResolver;componentFactory;messageHandlers;actionHandler;constructor(e,n){this.container=e,this.actionHandler=n,this.propertyResolver=new T(this.dataModels),this.componentFactory=new re(this.propertyResolver,this.componentElements,this.handleAction.bind(this)),this.messageHandlers=new oe(this.container,this.surfaces,this.dataModels,this.componentElements,this.rootComponents,this.componentFactory,this.propertyResolver)}handleAction(e){if(this.actionHandler)this.actionHandler(e);else{const n=new CustomEvent("a2ui:action",{detail:e});document.dispatchEvent(n)}}processMessage(e){if("createSurface"in e)this.messageHandlers.handleCreateSurface(e.createSurface);else if("updateComponents"in e)this.messageHandlers.handleUpdateComponents(e.updateComponents);else if("updateDataModel"in e)this.messageHandlers.handleUpdateDataModel(e.updateDataModel);else if("deleteSurface"in e)this.messageHandlers.handleDeleteSurface(e.deleteSurface);else if("beginRendering"in e)console.warn("‚ö†Ô∏è Using deprecated beginRendering, consider upgrading to createSurface"),this.messageHandlers.handleBeginRendering(e.beginRendering);else if("surfaceUpdate"in e)console.warn("‚ö†Ô∏è Using deprecated surfaceUpdate, consider upgrading to updateComponents"),this.messageHandlers.handleSurfaceUpdate(e.surfaceUpdate);else if("dataModelUpdate"in e){console.warn("‚ö†Ô∏è Using legacy dataModelUpdate format");const n=e.dataModelUpdate,a={surfaceId:n.surfaceId,actorId:"legacy-agent",updates:[{path:n.path||"/",value:n.contents,hlc:new Date().toISOString()+":1:legacy-agent"}],versions:{"legacy-agent":new Date().toISOString()+":1:legacy-agent"}};this.messageHandlers.handleUpdateDataModel(a)}}processMessages(e){e.forEach(n=>{try{this.processMessage(n)}catch(a){console.error("‚ùå Failed to process A2UI message:",a,n)}})}clear(){this.container.innerHTML="",this.surfaces.clear(),this.dataModels.clear(),this.componentElements.clear(),this.rootComponents.clear()}getSurfaces(){return this.surfaces}getDataModels(){return this.dataModels}static validateMessage(e){if(!e||typeof e!="object")return!1;const n=["createSurface","updateComponents","updateDataModel","deleteSurface"],a=Object.keys(e);if(a.length!==1)return!1;const t=a[0];return n.includes(t)?!0:["beginRendering","surfaceUpdate","dataModelUpdate"].includes(t)}static generateHLC(e="client"){const n=new Date().toISOString(),a=Math.floor(Math.random()*1e3);return`${n}:${a}:${e}`}}const se=({messages:l,status:e,onSendMessage:n})=>{const a=y.useRef(null),t=y.useRef(null),o=()=>{t.current&&(t.current.scrollTop=t.current.scrollHeight)};return y.useEffect(()=>{o()},[l.length]),y.useEffect(()=>{e==="ready"&&setTimeout(()=>{o()},100)},[e]),b.jsx("div",{ref:t,className:"chat-container",children:b.jsxs("div",{className:"chat-messages",children:[l.length===0&&b.jsxs("div",{className:"welcome-message",children:[b.jsx("h2",{children:"üëã Welcome to A2UI Chat"}),b.jsx("p",{children:`Hi! I'm your AI assistant. Ask me anything or try typing keywords like "profile", "products" to see UI components.`})]}),l.map((s,r)=>{const i=r===l.length-1,c=e==="streaming"&&i&&s.role==="assistant";return b.jsxs("div",{className:`message ${s.role==="user"?"user":"ai"}-message`,children:[b.jsx("div",{className:"message-avatar",children:s.role==="user"?b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[b.jsx("circle",{cx:"12",cy:"12",r:"11",fill:"rgba(255, 255, 255, 0.1)",stroke:"currentColor",strokeWidth:"1"}),b.jsx("path",{d:"M12 5c1.8 0 3.2 1.4 3.2 3.2S13.8 11.4 12 11.4s-3.2-1.4-3.2-3.2S10.2 5 12 5zm0 7.2c2.4 0 7.2 1.2 7.2 3.6v1.4c0 0.4-0.4 0.8-0.8 0.8H5.6c-0.4 0-0.8-0.4-0.8-0.8v-1.4c0-2.4 4.8-3.6 7.2-3.6z"})]}):b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[b.jsx("circle",{cx:"12",cy:"12",r:"11",fill:"rgba(255, 255, 255, 0.1)",stroke:"currentColor",strokeWidth:"1"}),b.jsx("path",{d:"M12 3.5l2.32 4.69L20 9.27l-4 3.9 0.94 5.48L12 16.23l-4.94 2.42L8 13.17 4 9.27l5.68-1.08L12 3.5z"})]})}),b.jsx("div",{className:"message-content a2ui-message-content",style:{flex:"1 1 auto",minWidth:0,maxWidth:"100%",padding:0,lineHeight:1.5,wordWrap:"break-word",overflowWrap:"break-word",display:"block",background:"transparent",border:"none"},children:b.jsx(ie,{message:s,isStreaming:c,onSendMessage:n})})]},s.id)}),b.jsx("div",{ref:a})]})})},ie=({message:l,isStreaming:e,onSendMessage:n})=>{const a=y.useRef(null),t=y.useRef(null),o=l.parts?l.parts.filter(u=>u.type==="text").map(u=>u.text).join(""):l.content||"",s=u=>{const d=u.match(/\[\s*\{[\s\S]*\}\s*\]/);if(d){const f=d[0];try{const h=JSON.parse(f);if(Array.isArray(h)&&h.length>0)return h.some(p=>p.createSurface||p.updateComponents||p.updateDataModel||p.beginRendering||p.surfaceUpdate||p.dataModelUpdate)}catch{}}const g=u.trim();if(g.startsWith("[")&&g.endsWith("]"))try{const f=JSON.parse(g);if(Array.isArray(f)&&f.length>0)return f.some(m=>m.createSurface||m.updateComponents||m.updateDataModel||m.beginRendering||m.surfaceUpdate||m.dataModelUpdate)}catch{}if(g.startsWith("{")&&g.endsWith("}"))try{const f=JSON.parse(g);if(f.createSurface||f.updateComponents||f.updateDataModel)return console.warn("‚ö†Ô∏è Detected A2UI-like structure but in wrong format (single object instead of array)"),!0}catch{}return!!u.includes("---a2ui_JSON---")},r=u=>{const d=u.match(/\[\s*\{[\s\S]*\}\s*\]/);if(d){const f=d[0];try{const h=JSON.parse(f),m=u.substring(0,u.indexOf(f)).trim(),p=m.length>0?m:"";return{textPart:p.length>100?p.substring(0,100)+"...":p,a2uiMessages:Array.isArray(h)?h:[],error:null}}catch(h){return console.error("‚ùå Failed to parse JSON array:",h),{textPart:"Failed to parse UI data",a2uiMessages:[],error:"parse_error"}}}const g=u.trim();if(g.startsWith("[")&&g.endsWith("]"))return i(g,"");if(g.startsWith("{")&&g.endsWith("}"))try{const f=JSON.parse(g);if(f.createSurface||f.updateComponents||f.updateDataModel)return console.warn("‚ö†Ô∏è AI returned wrong format: single object instead of message array"),{textPart:"",a2uiMessages:[],error:"wrong_format",originalContent:u}}catch{}if(u.includes("---a2ui_JSON---")){const f=u.split("---a2ui_JSON---");if(f.length!==2)return{textPart:u,a2uiMessages:[],error:null};let h=f[0].trim(),m=f[1].trim();const p=h.split(`
`).filter(C=>C.trim());p.length>0&&(h=p[0]);const v=m.indexOf("["),x=m.lastIndexOf("]");return v===-1||x===-1||v>=x?(console.error("‚ùå No valid JSON array found"),{textPart:h||"UI generated!",a2uiMessages:[],error:null}):(m=m.substring(v,x+1),i(m,h))}return{textPart:u,a2uiMessages:[],error:null}},i=(u,d="")=>{try{const g=JSON.parse(u);return{textPart:d.length>100?d.substring(0,100)+"...":d,a2uiMessages:Array.isArray(g)?g:[],error:null}}catch(g){console.error("‚ùå Failed to parse A2UI JSON:",g),console.error("üìÑ Problematic JSON:",u);try{let f=u.replace(/,\s*}/g,"}").replace(/,\s*]/g,"]").replace(/'/g,'"').replace(/(\w+):/g,'"$1":');const h=JSON.parse(f);return{textPart:d||"UI generated!",a2uiMessages:Array.isArray(h)?h:[],error:null}}catch(f){return console.error("‚ùå JSON fix attempt failed:",f),{textPart:d||"UI generated!",a2uiMessages:[],error:"parse_error"}}}},c=y.useCallback(u=>{if(!n){console.warn("‚ö†Ô∏è onSendMessage not available, action will be ignored");return}if(!u.action){console.warn("‚ö†Ô∏è Invalid A2UI action message format");return}const d=JSON.stringify(u);n({text:d}).catch(g=>{console.error("‚ùå Failed to send action message:",g)})},[n]);return y.useEffect(()=>{a.current&&!t.current&&(t.current=new L(a.current,c))},[a.current,c]),y.useEffect(()=>{if(a.current&&!t.current&&(t.current=new L(a.current,c)),t.current&&o&&!e)if(a.current&&(a.current.innerHTML=""),s(o)){const{textPart:d,a2uiMessages:g,error:f,originalContent:h}=r(o);if(f==="wrong_format"){console.error("‚ùå AI returned wrong A2UI format (single object instead of message array)"),a.current&&(a.current.innerHTML=`
              <div style="padding: 16px; background: rgba(255,165,0,0.15); border: 1px solid rgba(255,165,0,0.3); border-radius: 8px; color: white; margin-bottom: 12px;">
                <div style="font-weight: 600; margin-bottom: 8px; color: #ffa500;">‚ö†Ô∏è Format Error</div>
                <div style="font-size: 0.9em; margin-bottom: 12px; opacity: 0.9;">
                  AI returned A2UI-like content but in wrong format. Expected message array format, got single object.
                </div>
                <details style="margin-top: 12px;">
                  <summary style="cursor: pointer; font-size: 0.85em; opacity: 0.8;">Show raw response</summary>
                  <pre style="margin-top: 8px; padding: 12px; background: rgba(0,0,0,0.3); border-radius: 6px; overflow-x: auto; font-size: 0.75em; line-height: 1.4;">${JSON.stringify(h?JSON.parse(h):o,null,2)}</pre>
                </details>
              </div>
            `);return}if(d&&d.trim()&&a.current){const m=document.createElement("div");m?(m.style.cssText="padding: 8px 12px; background: rgba(255,255,255,0.05); border-radius: 6px; color: rgba(255,255,255,0.7); margin-bottom: 12px; font-size: 0.9em;",typeof m.textContent<"u"?m.textContent=d:console.error("‚ùå textDiv.textContent is undefined"),a.current.appendChild(m)):console.error("‚ùå Failed to create textDiv element")}if(g.length>0)try{g.forEach(m=>{t.current?.processMessage(m)})}catch(m){console.error("‚ùå Error processing A2UI messages:",m),a.current&&(a.current.innerHTML=`<div style="padding: 12px; background: rgba(255,0,0,0.1); border-radius: 8px; color: white;">‚ùå Error rendering UI: ${m}</div>`)}else console.warn("‚ö†Ô∏è No A2UI messages found in parsed content"),a.current&&(a.current.innerHTML=`<div style="padding: 12px; background: rgba(255,255,255,0.1); border-radius: 8px; color: white;">${o}</div>`)}else a.current&&(a.current.innerHTML=`<div style="padding: 12px; background: rgba(255,255,255,0.1); border-radius: 8px; color: white;">${o}</div>`);else!e&&o&&a.current&&(a.current.innerHTML=`<div style="padding: 12px; background: rgba(255,255,255,0.1); border-radius: 8px; color: white;">${o}</div>`)},[o,l.id,e]),e?b.jsx("div",{style:{padding:"12px",background:"rgba(255,255,255,0.1)",borderRadius:"8px",color:"white",display:"flex",alignItems:"center",gap:"8px"},children:b.jsx(le,{})}):b.jsx("div",{ref:a})},le=()=>b.jsx("div",{className:"loading-dots",style:{display:"flex",gap:"4px",alignItems:"center"},children:[0,1,2].map(l=>b.jsx("div",{className:"loading-dot",style:{width:"6px",height:"6px",borderRadius:"50%",backgroundColor:"rgba(255, 255, 255, 0.8)",animation:`loadingDot 1.4s ease-in-out ${l*.16}s infinite both`}},l))}),ce=({onSendMessage:l,disabled:e=!1})=>{const[n,a]=y.useState(""),t=y.useRef(null),o=y.useRef(null),s=y.useRef(!1),r=()=>{t.current&&(t.current.style.height="auto",t.current.style.height=Math.min(t.current.scrollHeight,200)+"px")};y.useEffect(()=>{r()},[n]);const i=()=>{const d=n.trim();!d||e||s.current||(s.current=!0,l(d),a(""),t.current&&(t.current.style.height="auto"),setTimeout(()=>{s.current=!1},1e3))},c=d=>{d.key==="Enter"&&!d.shiftKey&&(d.preventDefault(),i())},u=d=>{d.target===d.currentTarget&&t.current?.focus()};return b.jsx("div",{className:"chat-input-wrapper",children:b.jsxs("div",{ref:o,className:"chat-input-container",onClick:u,children:[b.jsx("textarea",{ref:t,className:"chat-input",placeholder:"Type your message here...",value:n,onChange:d=>a(d.target.value),onKeyDown:c,disabled:e||s.current,rows:1}),b.jsx("button",{className:"send-button",onClick:i,disabled:e||!n.trim()||s.current,children:b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:b.jsx("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"})})})]})})},ue=()=>{const{messages:l,sendMessage:e,status:n}=D(),a=async t=>{await e({text:t})};return b.jsxs("main",{className:"chat-section",children:[b.jsx("div",{className:"chat-background"}),b.jsx(se,{messages:l,status:n,onSendMessage:e}),b.jsx(ce,{onSendMessage:a,disabled:n!=="ready"})]})};export{ue as default};
