---
/**
 * AI å¯¹è¯é¡µé¢
 * åœ†è§’å¡ç‰‡èƒŒæ™¯åè½¬ï¼Œæ—  Canvas åŠ¨ç”»
 */

import EvervaultHead from '../components/EvervaultHead.astro';
import OriginalHeader from '../components/OriginalHeader.astro';
---

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>A2UI - AI Chat</title>
  
  <!-- EdgeOne åŸå§‹èµ„æºï¼ˆåªåŠ è½½ CSSï¼‰ -->
  <EvervaultHead />
  
  <!-- A2UI æ ·å¼ -->
  <link rel="stylesheet" href="/src/styles/a2ui.css">
  
  <style is:global>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* å¼ºåˆ¶è¦†ç›–å…¨å±€ svg vertical-align: middle */
    .message-avatar svg {
      vertical-align: top !important;
    }

    /* ç¡®ä¿ a2ui-message-content å†…çš„ç¬¬ä¸€ä¸ªå­å…ƒç´ æ²¡æœ‰ margin-top */
    .a2ui-message-content > *:first-child {
      margin-top: 0 !important;
    }

    /* ä¿®å¤ A2UI æ–‡æœ¬ç»„ä»¶çš„é¡¶éƒ¨å¯¹é½é—®é¢˜ - æ¶ˆé™¤ line-height äº§ç”Ÿçš„ä¸Šæ–¹é—´éš™ */
    .a2ui-message-content .a2ui-text {
      /* é‡ç½® line-height ä¸º 1ï¼Œæ¶ˆé™¤ä¸Šä¸‹é—´éš™ */
      line-height: 1 !important;
      /* ç¡®ä¿æ²¡æœ‰é¢å¤–çš„ margin å’Œ padding */
      margin: 0 !important;
      padding: 0 !important;
      /* ä½¿ç”¨ flex å¸ƒå±€ç¡®ä¿å†…å®¹ç´§è´´é¡¶éƒ¨ */
      display: flex !important;
      align-items: flex-start !important;
    }

    /* é’ˆå¯¹ä¸åŒå¤§å°çš„æ–‡æœ¬ï¼Œä¿æŒ line-height: 1 */
    .a2ui-message-content .a2ui-text.text-extraLarge {
      line-height: 1 !important;
    }

    .a2ui-message-content .a2ui-text.text-large {
      line-height: 1 !important;
    }

    .a2ui-message-content .a2ui-text.text-medium {
      line-height: 1 !important;
    }

    .a2ui-message-content .a2ui-text.text-small {
      line-height: 1 !important;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: #0a0a0a;
      color: #ffffff;
      overflow-x: hidden;
    }

    /* éšè— Next.js åŠ¨æ€æ¸²æŸ“çš„å†…å®¹ */
    #__next {
      display: none !important;
    }

    /* éšè—ä¸éœ€è¦çš„å…ƒç´  */
    [class*="styles-module__uOGawG__wrapper"],
    [class*="styles-module__Rkd4lW__banner"],
    [class*="styles-module__1H6L9a__navigation"],
    footer[class*="Footer-module"] {
      display: none !important;
    }
  </style>
</head>

<body>
  <!-- åŸå§‹å¯¼èˆªæ  -->
  <OriginalHeader />

  <!-- AI å¯¹è¯åŒºåŸŸ -->
  <main class="chat-section">
    <!-- å›ºå®šçš„å¡ç‰‡èƒŒæ™¯ - ç‹¬ç«‹å±‚ -->
    <div class="chat-background"></div>
    
    <!-- èŠå¤©å†…å®¹åŒºåŸŸ - ç‹¬ç«‹å±‚ -->
    <div class="chat-container">
      <!-- å¯¹è¯å†…å®¹åŒºåŸŸ -->
      <div class="chat-messages" id="chatMessages">
        <div class="welcome-message">
          <h2>ğŸ‘‹ Welcome to A2UI Chat</h2>
          <p>Hi! I'm your AI assistant. Ask me anything or try typing keywords like "profile", "products" to see UI components.</p>
        </div>
      </div>
    </div>
    
    <!-- å›ºå®šçš„è¾“å…¥æ¡† - ç‹¬ç«‹å±‚ -->
    <div class="chat-input-wrapper">
      <div class="chat-input-container">
        <textarea 
          id="chatInput" 
          class="chat-input" 
          placeholder="Type your message here..."
          rows="1"
        ></textarea>
        <button id="sendBtn" class="send-button">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
          </svg>
        </button>
      </div>
    </div>
  </main>
</body>

<script>
  import { A2UIRenderer } from '../lib/a2ui-renderer';
  import { allMockExamples } from '../lib/a2ui-mock-data';

  // è‡ªåŠ¨è°ƒæ•´ textarea é«˜åº¦
  const chatInput = document.getElementById('chatInput') as HTMLTextAreaElement;
  const sendBtn = document.getElementById('sendBtn');
  const chatMessages = document.getElementById('chatMessages');
  const chatInputContainer = document.querySelector('.chat-input-container') as HTMLElement;

  // ç‚¹å‡»è¾“å…¥å®¹å™¨æ—¶ï¼Œèšç„¦åˆ°è¾“å…¥æ¡†
  if (chatInputContainer && chatInput) {
    chatInputContainer.addEventListener('click', (e) => {
      // å¦‚æœç‚¹å‡»çš„ä¸æ˜¯æŒ‰é’®ï¼Œå°±èšç„¦è¾“å…¥æ¡†
      if (e.target !== sendBtn && !sendBtn?.contains(e.target as Node)) {
        chatInput.focus();
      }
    });
  }

  if (chatInput) {
    chatInput.addEventListener('input', () => {
      chatInput.style.height = 'auto';
      chatInput.style.height = Math.min(chatInput.scrollHeight, 200) + 'px';
    });

    // æŒ‰ Enter å‘é€ï¼ŒShift+Enter æ¢è¡Œ
    chatInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });
  }

  if (sendBtn) {
    sendBtn.addEventListener('click', sendMessage);
  }

  function sendMessage() {
    const message = chatInput?.value.trim();
    if (!message) return;

    console.log('Sending message:', message); // è°ƒè¯•æ—¥å¿—

    // æ£€æŸ¥æ˜¯å¦æ˜¯ A2UI å‘½ä»¤
    const commandMap: Record<string, keyof typeof allMockExamples> = {
      '1': 'userProfile',
      'ç”¨æˆ·èµ„æ–™': 'userProfile',
      'user profile': 'userProfile',
      'ä¸ªäººèµ„æ–™': 'userProfile',
      
      '2': 'contactForm',
      'è”ç³»è¡¨å•': 'contactForm',
      'contact form': 'contactForm',
      'è¡¨å•': 'contactForm',
      
      '3': 'productList',
      'äº§å“åˆ—è¡¨': 'productList',
      'product list': 'productList',
      'å•†å“åˆ—è¡¨': 'productList',
      
      '4': 'settingsPanel',
      'è®¾ç½®é¢æ¿': 'settingsPanel',
      'settings panel': 'settingsPanel',
      'è®¾ç½®': 'settingsPanel',

      '5': 'table',
      'æ•°æ®è¡¨æ ¼': 'table',
      'table': 'table',
      'è¡¨æ ¼': 'table',

      '6': 'dataVisualization',
      'æ•°æ®å±•ç¤º': 'dataVisualization',
      'data visualization': 'dataVisualization',
      'å›¾è¡¨': 'dataVisualization',
      'chart': 'dataVisualization',

      '7': 'media',
      'åª’ä½“ç»„ä»¶': 'media',
      'media': 'media',
      'è§†é¢‘': 'media',
      'video': 'media',

      '8': 'advanced',
      'é«˜çº§ç»„ä»¶': 'advanced',
      'advanced': 'advanced',
      'æ—¥å†': 'advanced',
      'calendar': 'advanced'
    };

    const demoType = commandMap[message.toLowerCase()];
    console.log('Demo type:', demoType); // è°ƒè¯•æ—¥å¿—

    // æ£€æŸ¥æ˜¯å¦æœ‰æ¬¢è¿æ¶ˆæ¯
    const welcomeMsg = chatMessages?.querySelector('.welcome-message');
    
    if (welcomeMsg) {
      // å¦‚æœæœ‰æ¬¢è¿æ¶ˆæ¯ï¼Œå…ˆå¼€å§‹æ¶ˆå¤±åŠ¨ç”»
      welcomeMsg.style.transition = 'opacity 0.5s ease, transform 0.5s ease, max-height 0.5s ease, margin 0.5s ease, padding 0.5s ease';
      welcomeMsg.style.opacity = '0';
      welcomeMsg.style.transform = 'translateY(-20px)';
      welcomeMsg.style.maxHeight = '0';
      welcomeMsg.style.marginBottom = '0';
      welcomeMsg.style.paddingTop = '0';
      welcomeMsg.style.paddingBottom = '0';
      welcomeMsg.style.overflow = 'hidden';
      
      // ç«‹å³æ·»åŠ ç”¨æˆ·æ¶ˆæ¯ï¼ˆéšè—çŠ¶æ€ï¼‰
      addMessage(message, 'user', true);
      
      // 0.5ç§’åï¼ˆæ¬¢è¿æ¶ˆæ¯æ¶ˆå¤±å®Œæˆï¼‰
      setTimeout(() => {
        welcomeMsg.remove();
        
        // æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
        const userMsg = chatMessages?.lastElementChild;
        if (userMsg) {
          requestAnimationFrame(() => {
            userMsg.style.opacity = '1';
            userMsg.style.maxHeight = '200px';
          });
        }
        
        // åˆ¤æ–­æ˜¯å¦æ¸²æŸ“ A2UI æˆ–æ™®é€šå›å¤
        setTimeout(() => {
          if (demoType) {
            renderA2UIDemo(demoType);
          } else {
            addMessage('This is a placeholder response. AI integration coming soon!', 'ai', false);
          }
        }, 800);
      }, 500);
    } else {
      // æ²¡æœ‰æ¬¢è¿æ¶ˆæ¯ï¼Œæ­£å¸¸æ·»åŠ 
      addMessage(message, 'user', false);
      
      // åˆ¤æ–­æ˜¯å¦æ¸²æŸ“ A2UI æˆ–æ™®é€šå›å¤
      setTimeout(() => {
        if (demoType) {
          renderA2UIDemo(demoType);
        } else {
          addMessage('This is a placeholder response. AI integration coming soon!', 'ai', false);
        }
      }, 1000);
    }

    // æ¸…ç©ºè¾“å…¥æ¡†
    if (chatInput) {
      chatInput.value = '';
      chatInput.style.height = 'auto';
    }
  }

  function addMessage(text: string, sender: 'user' | 'ai', keepHidden: boolean = false) {
    if (!chatMessages) return;

    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${sender}-message`;
    // åˆå§‹çŠ¶æ€ï¼šä¸å ç”¨å¸ƒå±€ç©ºé—´
    messageDiv.style.cssText = 'display: flex !important; flex-direction: row !important; flex-wrap: nowrap !important; gap: 0.75rem; align-items: flex-start !important; opacity: 0; max-height: 0; overflow: hidden; transition: opacity 0.3s ease, max-height 0.3s ease;';
    
    const avatar = document.createElement('div');
    avatar.className = 'message-avatar';
    // ä¸éœ€è¦è®¾ç½®å†…è”æ ·å¼ï¼Œè®© CSS æ§åˆ¶
    
    // æ·»åŠ  SVG å›¾æ ‡
    if (sender === 'user') {
      avatar.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <circle cx="12" cy="12" r="11" fill="rgba(255, 255, 255, 0.1)" stroke="currentColor" stroke-width="1"/>
          <path d="M12 5c1.8 0 3.2 1.4 3.2 3.2S13.8 11.4 12 11.4s-3.2-1.4-3.2-3.2S10.2 5 12 5zm0 7.2c2.4 0 7.2 1.2 7.2 3.6v1.4c0 0.4-0.4 0.8-0.8 0.8H5.6c-0.4 0-0.8-0.4-0.8-0.8v-1.4c0-2.4 4.8-3.6 7.2-3.6z"/>
        </svg>
      `;
    } else {
      avatar.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <circle cx="12" cy="12" r="11" fill="rgba(255, 255, 255, 0.1)" stroke="currentColor" stroke-width="1"/>
          <path d="M12 3.5l2.32 4.69L20 9.27l-4 3.9 0.94 5.48L12 16.23l-4.94 2.42L8 13.17 4 9.27l5.68-1.08L12 3.5z"/>
        </svg>
      `;
    }
    
    const content = document.createElement('div');
    content.className = 'message-content a2ui-message-content';
    content.style.cssText = 'flex: 1 1 auto !important; min-width: 0 !important; max-width: 100% !important; padding: 0; line-height: 1.5; word-wrap: break-word; overflow-wrap: break-word; display: block !important; background: transparent; border: none;';
    
    // æ·»åŠ å…ƒç´ åˆ°æ¶ˆæ¯å®¹å™¨
    messageDiv.appendChild(avatar);
    messageDiv.appendChild(content);
    
    // ä½¿ç”¨ A2UI æ¸²æŸ“å™¨æ¥æ¸²æŸ“æ–‡æœ¬
    const renderer = new A2UIRenderer(content);
    
    // åˆ›å»ºä¸€ä¸ªæ ‡å‡†çš„A2UIæ¶ˆæ¯ï¼ŒåŒ…è£¹åœ¨Cardä¸­
    const textMessage = {
      type: 'createSurface',
      surfaceId: `text-${Date.now()}`,
      components: [
        {
          type: 'Card',
          id: 'message-card',
          elevation: 1,
          children: [
            {
              type: 'Text',
              text: text,
              size: 'medium'
            }
          ]
        }
      ]
    };
    
    renderer.processMessage(textMessage);
    
    // æ·»åŠ åˆ°å®¹å™¨
    chatMessages.appendChild(messageDiv);
    
    // å¦‚æœä¸éœ€è¦ä¿æŒéšè—ï¼Œç«‹å³æ˜¾ç¤ºå¹¶æ»šåŠ¨
    if (!keepHidden) {
      // å…ˆæ»šåŠ¨åˆ°åº•éƒ¨ï¼Œç¡®ä¿æ–°æ¶ˆæ¯åœ¨å¯è§†åŒºåŸŸ
      const chatContainer = document.querySelector('.chat-container');
      if (chatContainer) {
        // ç«‹å³æ»šåŠ¨ï¼Œé¿å…æ¶ˆæ¯æ˜¾ç¤ºåœ¨é”™è¯¯ä½ç½®
        chatContainer.scrollTop = chatContainer.scrollHeight;
      }
      
      requestAnimationFrame(() => {
        messageDiv.style.opacity = '1';
        messageDiv.style.maxHeight = '200px';
        
        // å†æ¬¡ç¡®ä¿æ»šåŠ¨åˆ°åº•éƒ¨
        if (chatContainer) {
          setTimeout(() => {
            chatContainer.scrollTop = chatContainer.scrollHeight;
          }, 50); // ç»™åŠ¨ç”»ä¸€ç‚¹æ—¶é—´
        }
      });
    }
  }

  // ============= A2UI Demo åŠŸèƒ½ =============

  function renderA2UIDemo(demoType: keyof typeof allMockExamples) {
    console.log('Rendering A2UI demo:', demoType); // è°ƒè¯•æ—¥å¿—
    if (!chatMessages) return;
    
    // æ·»åŠ  AI æ¶ˆæ¯å®¹å™¨
    const aiMessageDiv = document.createElement('div');
    aiMessageDiv.className = 'message ai-message';
    aiMessageDiv.style.cssText = 'display: flex !important; flex-direction: row !important; flex-wrap: nowrap !important; gap: 0.75rem; align-items: flex-start !important; opacity: 0; max-height: 0; overflow: hidden; transition: opacity 0.3s ease, max-height 0.3s ease; width: 100% !important; max-width: 100% !important;';
    
    const avatar = document.createElement('div');
    avatar.className = 'message-avatar';
    avatar.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
        <circle cx="12" cy="12" r="11" fill="rgba(255, 255, 255, 0.1)" stroke="currentColor" stroke-width="1"/>
        <path d="M12 3.5l2.32 4.69L20 9.27l-4 3.9 0.94 5.48L12 16.23l-4.94 2.42L8 13.17 4 9.27l5.68-1.08L12 3.5z"/>
      </svg>
    `;
    
    const content = document.createElement('div');
    content.className = 'message-content a2ui-message-content';
    content.style.cssText = 'flex: 1 1 auto !important; min-width: 0 !important; max-width: 100% !important; padding: 0; line-height: 1.5; word-wrap: break-word; overflow-wrap: break-word; display: block !important; background: transparent; border: none;';
    
    aiMessageDiv.appendChild(avatar);
    aiMessageDiv.appendChild(content);
    chatMessages.appendChild(aiMessageDiv);
    
    // æ¯æ¬¡éƒ½åˆ›å»ºæ–°çš„æ¸²æŸ“å™¨å®ä¾‹ï¼Œç¡®ä¿æ¯æ¡æ¶ˆæ¯ç‹¬ç«‹
    const renderer = new A2UIRenderer(content);
    console.log('Renderer created'); // è°ƒè¯•æ—¥å¿—
    
    // ç›‘å¬ action äº‹ä»¶
    content.addEventListener('a2ui:action', ((e: CustomEvent) => {
      console.log('A2UI Action:', e.detail);
      alert(`Action: ${e.detail.actionName}\nData: ${JSON.stringify(e.detail.dataModel, null, 2)}`);
    }) as EventListener);
    
    // å¤„ç†æ‰€æœ‰æ¶ˆæ¯
    const messages = allMockExamples[demoType];
    console.log('Messages to render:', messages); // è°ƒè¯•æ—¥å¿—
    
    try {
      messages.forEach((msg: any, index: number) => {
        console.log(`Processing message ${index}:`, msg); // è°ƒè¯•æ—¥å¿—
        renderer.processMessage(msg);
      });
      console.log('All messages processed successfully'); // è°ƒè¯•æ—¥å¿—
    } catch (error) {
      console.error('Error processing messages:', error); // é”™è¯¯æ—¥å¿—
    }
    
    // å…ˆæ»šåŠ¨åˆ°åº•éƒ¨ï¼Œç¡®ä¿æ–°æ¶ˆæ¯åœ¨å¯è§†åŒºåŸŸ
    const chatContainer = document.querySelector('.chat-container');
    if (chatContainer) {
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }
    
    // æ˜¾ç¤ºæ¶ˆæ¯
    requestAnimationFrame(() => {
      aiMessageDiv.style.opacity = '1';
      aiMessageDiv.style.maxHeight = 'none';
      aiMessageDiv.style.overflow = 'visible';
      
      // å†æ¬¡ç¡®ä¿æ»šåŠ¨åˆ°åº•éƒ¨
      if (chatContainer) {
        setTimeout(() => {
          chatContainer.scrollTop = chatContainer.scrollHeight;
        }, 100); // ç»™A2UIç»„ä»¶æ¸²æŸ“ä¸€ç‚¹æ—¶é—´
      }
    });
  }
</script>

<style>
  /* ç§»é™¤è¿‡äºæ¿€è¿›çš„æ ·å¼é‡ç½®ï¼Œæ”¹ä¸ºæ›´ç²¾ç¡®çš„æ§åˆ¶ */

  .chat-section {
    position: fixed; /* å›ºå®šæ•´ä¸ªåŒºåŸŸ */
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    overflow: hidden; /* ä¸åœ¨è¿™é‡Œæ»šåŠ¨ */
    /* é¡µé¢åŠ è½½åŠ¨ç”» */
    animation: pageLoadFadeIn 0.5s ease-out;
  }

  @keyframes pageLoadFadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  .chat-background {
    position: fixed; /* å›ºå®šå¡ç‰‡èƒŒæ™¯ */
    top: 80px; /* å¯¼èˆªæ ä¸‹æ–¹ + é—´éš™ */
    left: 0.75rem;
    right: 0.75rem;
    bottom: 0;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    padding: 2rem;
    pointer-events: none; /* è®©ç‚¹å‡»ç©¿é€åˆ°ä¸‹å±‚ */
    z-index: 1; /* æœ€åº•å±‚ */
    
    /* åœ†è§’æ¸å˜èƒŒæ™¯å¡ç‰‡ - ä¿æŒåŸæ ·å¼ */
    border-radius: 56px 56px 0 0; /* åªæœ‰é¡¶éƒ¨åœ†è§’ï¼Œæ›´åœ†æ¶¦ */
    background: radial-gradient(140% 107.13% at 50% 90%, transparent 37.41%, #6633ee 69.27%, #ffffff 100%);
    /* å¡ç‰‡å‡ºç°åŠ¨ç”» */
    animation: cardSlideUp 0.6s ease-out;
  }

  @keyframes cardSlideUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .chat-container {
    position: fixed; /* å›ºå®šå®šä½ */
    top: 80px; /* å’Œå¡ç‰‡èƒŒæ™¯é¡¶éƒ¨å¯¹é½ */
    left: 0;
    right: 0;
    bottom: 120px; /* ä¸ºè¾“å…¥æ¡†ç•™å‡ºç©ºé—´ï¼Œä¸å»¶ä¼¸åˆ°åº•éƒ¨ */
    display: flex;
    flex-direction: column;
    align-items: center;
    overflow-y: auto; /* å¯æ»šåŠ¨ */
    overflow-x: hidden;
    z-index: 50; /* åœ¨èƒŒæ™¯ä¹‹ä¸Šï¼Œåœ¨è¾“å…¥æ¡†ä¹‹ä¸‹ */
    /* å†…å®¹å»¶è¿Ÿæ·¡å…¥ */
    animation: contentFadeIn 0.5s ease-out 0.3s both;
    /* åº•éƒ¨æ¸å˜é®ç½© - å¹³æ»‘æ·¡å‡ºæ•ˆæœ */
    -webkit-mask-image: linear-gradient(to bottom, black 0%, black calc(100% - 60px), transparent 100%);
    mask-image: linear-gradient(to bottom, black 0%, black calc(100% - 60px), transparent 100%);
  }

  @keyframes contentFadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .chat-messages {
    width: 100%;
    max-width: 1000px; /* å†…å®¹åŒºåŸŸå®½åº¦ */
    padding: 2rem 1rem;
    padding-bottom: 2rem; /* æ¢å¤æ­£å¸¸çš„åº•éƒ¨å†…è¾¹è· */
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ - åº”ç”¨åˆ°èŠå¤©å®¹å™¨ */
  .chat-container::-webkit-scrollbar {
    width: 8px;
  }

  .chat-container::-webkit-scrollbar-track {
    background: transparent;
  }

  .chat-container::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.2);
    border-radius: 6px;
  }

  .chat-container::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.3);
  }

  .welcome-message {
    text-align: center;
    padding: 3rem 2rem;
    opacity: 0.8;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: calc(100vh - 300px);
  }

  .welcome-message h2 {
    font-size: 2rem;
    margin-bottom: 1rem;
    background: linear-gradient(135deg, #ffffff 0%, #e0e0e0 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .welcome-message p {
    font-size: 1.125rem;
    color: rgba(255, 255, 255, 0.7);
    max-width: 500px;
    margin: 0 auto;
    line-height: 1.6;
  }

  .message {
    display: flex !important;
    flex-direction: row !important;
    flex-wrap: nowrap !important;
    gap: 0.75rem;
    align-items: center !important; /* æ‰€æœ‰æ¶ˆæ¯éƒ½å±…ä¸­å¯¹é½ */
    width: auto !important;
    animation: messageSlideIn 0.3s ease;
  }

  @keyframes messageSlideIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .message-avatar {
    flex: 0 0 36px !important;
    width: 36px !important;
    height: 36px !important;
    border-radius: 50%;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.15);
    margin: 0 !important;
    padding: 0 !important;
    align-self: flex-start !important;
    /* ç§»é™¤avatarå®¹å™¨å†…éƒ¨é—´éš™ */
    line-height: 0 !important;
    font-size: 0 !important;
    overflow: hidden; /* ç¡®ä¿å†…å®¹ä¸ä¼šæº¢å‡º */
  }

  .message-avatar svg,
  .chat-messages .message .message-avatar svg {
    width: 24px !important;
    height: 24px !important;
    display: block !important;
    margin: 0 !important;
    padding: 0 !important;
    flex: 0 0 auto !important;
    vertical-align: top !important;
    /* ç§»é™¤SVGå†…éƒ¨é—´éš™ */
    line-height: 0 !important;
    font-size: 0 !important;
  }

  .user-message {
    display: flex !important;
    flex-direction: row-reverse !important;
    flex-wrap: nowrap !important;
    justify-content: flex-start;
    margin-left: auto;
    width: auto !important;
    max-width: calc(100% - 2rem);
  }

  .user-message .message-avatar {
    background: linear-gradient(135deg, #6633ee 0%, #8b5cf6 100%);
    border: 1px solid rgba(102, 51, 238, 0.5);
    box-shadow: 0 2px 8px rgba(102, 51, 238, 0.3);
    color: white;
  }

  .ai-message {
    display: flex !important;
    flex-direction: row !important;
    flex-wrap: nowrap !important;
    justify-content: flex-start;
    margin-right: auto;
    width: auto !important;
    max-width: calc(100% - 1rem); /* å¢åŠ å¯ç”¨å®½åº¦ */
  }

  .ai-message .message-avatar {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.08) 100%);
    border: 1px solid rgba(255, 255, 255, 0.25);
    box-shadow: 0 2px 8px rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.95);
  }

  .user-message .message-content,
  .ai-message .message-content {
    /* ç§»é™¤èƒŒæ™¯æ ·å¼ï¼Œè®©å¡ç‰‡è‡ªå·±å¤„ç† */
    background: transparent;
    border: none;
    padding: 0;
  }

  /* ç”¨æˆ·æ¶ˆæ¯çš„å¡ç‰‡æ ·å¼ */
  .user-message .a2ui-card {
    background: rgba(102, 51, 238, 0.35) !important;
    border: 1px solid rgba(102, 51, 238, 0.5) !important;
    box-shadow: 0 2px 12px rgba(102, 51, 238, 0.2) !important;
  }

  /* AIæ¶ˆæ¯çš„å¡ç‰‡æ ·å¼ */
  .ai-message .a2ui-card {
    background: rgba(255, 255, 255, 0.1) !important;
    backdrop-filter: blur(10px) !important;
    border: 1px solid rgba(255, 255, 255, 0.15) !important;
  }

  .chat-input-wrapper {
    position: fixed;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%);
    width: calc(100% - 2rem); /* é¡µé¢ä¸¤ä¾§é—´è· */
    max-width: calc(1000px - 2rem); /* chat-messages å®½åº¦ - å·¦å³ padding (1rem * 2) */
    padding-left: 36px; /* åªä¿ç•™å¤´åƒå®½åº¦ */
    padding-right: 0;
    box-sizing: border-box;
    z-index: 100;
  }

  .chat-input-container {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.5rem 0.75rem 0.5rem 1rem;
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(20px);
    border-radius: 24px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    width: 100%;
  }

  .chat-input {
    flex: 1;
    background: transparent;
    border: none;
    outline: none;
    color: #ffffff;
    font-size: 0.95rem;
    line-height: 1.4;
    resize: none;
    font-family: inherit;
    height: 24px;
    min-height: 24px;
    max-height: 24px;
    overflow: hidden;
  }

  .chat-input::placeholder {
    color: rgba(255, 255, 255, 0.4);
  }

  .send-button {
    flex-shrink: 0;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: linear-gradient(135deg, #6633ee 0%, #8b5cf6 100%);
    border: none;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
  }

  .send-button:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(102, 51, 238, 0.4);
  }

  .send-button:active {
    transform: scale(0.95);
  }

  .send-button svg {
    width: 16px;
    height: 16px;
  }

  @media (max-width: 768px) {
    .chat-section {
      padding-bottom: 0.75rem;
      padding-top: 30px; /* ç§»åŠ¨ç«¯å‡å°é¡¶éƒ¨é—´éš™ */
    }

    .chat-background {
      width: calc(100% - 0.5rem);
      height: calc(85vh - 30px); /* å‡å»é¡¶éƒ¨é—´éš™ */
      margin: 0 0.25rem;
      padding: 1rem;
      border-radius: 36px;
    }

    .chat-container {
      gap: 1rem;
      bottom: 100px; /* ç§»åŠ¨ç«¯ä¸ºè¾“å…¥æ¡†ç•™å‡ºç©ºé—´ */
    }

    .chat-messages {
      padding-bottom: 1.5rem; /* ç§»åŠ¨ç«¯æ­£å¸¸çš„åº•éƒ¨å†…è¾¹è· */
    }

    .welcome-message {
      padding: 2rem 1rem;
    }

    .welcome-message h2 {
      font-size: 1.5rem;
    }

    .welcome-message p {
      font-size: 1rem;
    }

    .user-message,
    .ai-message {
      max-width: 90%;
    }
  }

  @media (max-width: 480px) {
    .chat-section {
      padding-top: 25px; /* å°å±å¹•æ›´å°çš„é¡¶éƒ¨é—´éš™ */
    }

    .chat-background {
      height: calc(80vh - 25px); /* å‡å»é¡¶éƒ¨é—´éš™ */
      border-radius: 28px;
    }

    .chat-container {
      bottom: 90px; /* å°å±å¹•ä¸ºè¾“å…¥æ¡†ç•™å‡ºç©ºé—´ */
    }

    .chat-messages {
      padding-bottom: 1rem; /* å°å±å¹•æ­£å¸¸çš„åº•éƒ¨å†…è¾¹è· */
    }

    .chat-input-container {
      padding: 0.75rem;
    }
  }
</style>
</html>
